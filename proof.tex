\documentclass{article}
\usepackage[utf8]{inputenc}
% \usepackage[margin=2.5cm]{geometry}
% \pagestyle{plain}
\include{preamble.tex}
\usepackage{amsmath, amssymb, amsthm}

\begin{document}

\section*{Confirmation Rule: Safety}

See:
% \begin{itemize}
%     \item \href{https://github.com/mkalinin/confirmation-rule}{https://github.com/mkalinin/confirmation-rule}
%     \item \href{https://arxiv.org/abs/2405.00549}{https://arxiv.org/abs/2405.00549}
% \end{itemize}

\begin{definition}[LMD-GHOST Safety condition for a single block]
    Given $C \in AU(b):$
    \[
    \isOneConfirmed_v(b, C, t) := Q^{\slot(t)-1,\ v,\ t,\ C}_{b} > \frac{1}{2}\left(1 + \frac{W^C_p}{W^{\slot(t)-1,\ C}_b}\right)
    \]
\end{definition}

Let $\viewattime[val=v,time=\slotstart(s)]$ be the view of a validator $v$ at the start of slot $s$ to which all the votes cast and observed by $v$ before $\slotstart(s)$ are applied.

\begin{algorithm}[H]
\caption{Highest LMD-GHOST confirmed descendant}
\SetAlgoNoLine
\Fn{\isOneConfirmed$_v(b, s)$}{
    \Return{$\isOneConfirmed_v(b, GJ(\viewattime[val=v, time=\slotstart(s-1)]), \slotstart(s))$}\;
}

\Fn{\highestLMDConfirmedDesc$_v(\bconfirmed, s)$}{
    $descs \gets \left\{b' \in \chain(\LMDGHOSTHFC(\viewattime[time=\slotstart(s),val=v])): b' \succ \bconfirmed\right\}$\\
    $confirmed\_descs \gets \left\{b' \in descs : \forall b'' \in descs, b'' \preceq b' \Rightarrow \isOneConfirmed_v(b'', s)\right\}$\\
    \uIf{$confirmed\_descs \ne \emptyset$}{
        \Return{$\argmax_{b' \in confirmed\_descs}\slot(b')$}\;
    }
    \uElse{
        \Return{$\bconfirmed$}\;
    }    
}
\end{algorithm}


\begin{lemma}
If $t$ and $t'$ are any two times, $b := \highestLMDConfirmedDesc_v(\banchor, t)$, $t \leq t'$ and the following holds:
\begin{enumerate}
    \item $\slotstart(\slot(t) - 1) \geq \GST,$
    \item $\banchor$ is canonical in the view of any honest validator $v'$ at time $t,$
    \item $\gjattime[time=t',val=v] \succeq \gjattime[time=\slotstart(\slot(t) - 1),val=v],$
    \item $b \in \filtered[time=t',val=v']$
\end{enumerate}

then $b$ is canonical in the view of any honest validator $v'$ at time $t'$.
\end{lemma}

\begin{proof}
    TBD..
\end{proof}

Let $\viewattime[val=v,time=\slotstart(s)]$ be the view of a validator $v$ at the start of slot $s$ to which all the votes cast and observed by $v$ before $\slotstart(s)$ are applied.

\begin{algorithm}[H]
\caption{Highest confirmed descendant}
% \SetAlgoLined
\SetAlgoNoLine
\Fn{willNotBeFilteredOut$_v(b, s)$}{
    $\head \gets \LMDGHOSTHFC(\viewattime[val=v,time=\slotstart(s)])$\;
    $\phead \gets \LMDGHOSTHFC(\viewattime[val=v,time=\slotstart(s-1)])$\;

    \uIf{epoch(s) = epoch(b)}{
        \Return{$b \preceq \head \wedge \epoch(\gu(head)) \geq \epoch(s)-1$}\;
    }
    \uElseIf{$s = \firstslot(\epoch(s))$}{
        \Return{$\votsource[blck=b, time=\epoch(s)] \geq \epoch(s)-2 \lor
                (b \preceq \phead \wedge \votsource[blck=\phead, time=\epoch(s)] \geq \epoch(s)-2)$}\;
    }
    \uElse {
        \uIf{$b \preceq \head \wedge \epoch(\gu(\head)) \geq \epoch(s) - 1$} {
            \Return{$\votsource[blck=b, time=\epoch(s)] \geq \epoch(s)-2 \lor
                (b \preceq \phead \wedge \votsource[blck=\phead, time=\epoch(s)] \geq \epoch(s)-2)$}\;
        }
        \uElse{
            \Return{$b \preceq \phead \wedge 
                    \epoch(\gu(\phead)) \geq \epoch(s) - 1 \wedge
                    \votsource[blck=\phead, time=\epoch(s)] \geq \epoch(s)-2$}\;
        }
    }
}
\Fn{highestConfirmedDesc$_v(\bconfirmed, s)$}{
    $\blmdconfirmed \gets \highestLMDConfirmedDesc_v(\bconfirmed, s)$\;

    \uIf{$\epoch(\blmdconfirmed) > \epoch(\bconfirmed)$ \textbf{and}
        $\neg \willChkpBeJustified_v(\chkp(\head), s)$} {
        $\mathit{candidates} \gets \{b' \in \chain(\blmdconfirmed), b' \succ \bconfirmed :
            \willNotBeFilteredOut_v(b', s) \wedge \epoch(b') = \epoch(s)-1\}$
    }
    \uElse {
        $\mathit{candidates} \gets \{b' \in \chain(\blmdconfirmed), b' \succ \bconfirmed :
            \willNotBeFilteredOut_v(b', s)\}$
    }

    \uIf{$\mathit{candidates} = \emptyset$}{
        \Return{$\bconfirmed$}\;
    }

    $\bcand \gets \argmax_{b' \in candidates}\slot(b')$\;
    \uIf{$\epoch(s) > \epoch(\bcand)$ \textbf{and}
        $s > \firstslot(epoch(s))$ \textbf{and}
        $\neg \willNoConflictingChkpBeJustified_v(\chkp(\head, \epoch(s), s))$} {
        \Return{$\bconfirmed$}\;
    }
    \uElse {
        \Return{$\bcand$}\;
    }
}
\end{algorithm}

\begin{lemma}
If $t$ and $t'$ are any two times such that $t' \geq t \wedge \epoch(t') = \epoch(t)$, $b := \text{highestConfirmedDesc}_v(\banchor, t)$, $\epoch(b) = \epoch(t) - 1$ and the following holds:

\begin{enumerate}
    \item $\slotstart(\epoch(t) - 1) \geq \GST,$
    \item $\banchor, \epoch(\banchor) = \epoch(t) - 1$ is canonical in the view of any validator $v'$ at time $\slotstart(\slot(t) - 1),$
    \item At the time $t'' \leq \slotstart(\lastslot(\epoch(t) - 1))$ in the view of validator $v$ exists block $b' \preceq b : \epoch(b') = \epoch(t) - 1$ such that $\willChkpBeJustified^{t''}_v(\chkp(b')) = \True,$
    \item At the time $\slotstart(\slot(t) - 1)$ $\exists b'' \succeq \banchor : \epoch(b'') = \epoch(t) - 1 \wedge \epoch(\gu(b'')) \geq \epoch(t) - 2,$
    \item $\gjattime[time=\slotstart(\lastslot(\epoch(t) - 1)),val=v] = \chkp(b, *)$
\end{enumerate}

then $b$ is canonical in the view of any honest validator $v'$ at time $t' < \slotstart(\epoch(b) + 2)$.
\end{lemma}

\begin{proof}
    TBD...
\end{proof}



\begin{lemma}
   If $t$ and $t'$ are any two times such that $t' \geq t$, $b := \text{highestConfirmedDesc}_v(\banchor, t)$, $\epoch(b) = \epoch(t)$ and the following holds:
    
    \begin{enumerate}
        \item $\slotstart(\epoch(t') - 1) \geq \GST,$
        \item $\banchor$ is canonical in the view of any validator $v'$ at time $t,$
        \item At the time $t'' \leq \slotstart(\lastslot(\epoch(t)))$ in the view of validator $v$ exists block $b' \preceq b : \epoch(b') = \epoch(t)$ such that:
        \begin{enumerate}
            \item $willChkpBeJustified^{t''}_v(\chkp(b')),$
            \item $\exists b'' \succeq b' : \epoch(b'') = \epoch(t) \wedge \epoch(\gu(b'')) \geq \epoch(t) - 1,$
        \end{enumerate}
        \item $\guattime[time=\slotstart(\lastslot(\epoch(t) - 1)),val=v] \succeq \chkp(b, \epoch(t) - 2),$
        \item $\gjattime[time=\slotstart(\lastslot(\epoch(t) - 1)),val=v] = \chkp(b, *),$
    \end{enumerate}
    
    then $b$ is canonical in the view of any honest validator $v'$ at time $t' < \slotstart(\epoch(b) + 2)$.
\end{lemma}

\begin{proof}
    TBD...
\end{proof}

% \section*{Algorithm 102}
% \textbf{(Highest confirmed)}

Let $\viewattime[val=v,time=\slotstart(s)]$ be the view of a validator $v$ at the start of slot $s$ to which all the votes cast and observed by $v$ before $\slotstart(s)$ are applied.

\begin{algorithm}[H]
\SetAlgoNoLine
\Fn{$\text{highestConfirmed}_v(s)$}{
    $\varforvalattime[val=v]{\bconfirmed} \gets \text{highestConfirmed}_v(s-1)$\\
    \uIf{
        $\epoch(\varforvalattime[val=v]{\bconfirmed}) \geq \epoch(s) - 1$ \textbf{and}\\
        $\varforvalattime[val=v]{\bconfirmed} \preceq \LMDGHOSTHFC(\viewattime[val=v,time=\slotstart(s)])$}{
        \Return{$\text{highestConfirmedDesc}_v(\varforvalattime[val=v]{\bconfirmed}, s)$}\;
    }
    \uElseIf{
        $s = \firstslot(\epoch(s))$ \textbf{and} \\
        $\epoch(\gu(\viewattime[val=v,time=\slotstart(s-1)])) = \epoch(s) - 1$
    }{
        \Return{$\text{highestConfirmedDesc}_v(\text{block}(\gu(\viewattime[val=v,time=\slotstart(s-1)]), s)$}\;
    }
    \uElse{
        \Return{$b_{\text{fin}}$}\;
    }
}
\caption{Highest Confirmed Block Selection}
\label{alg:highestconfirmed}
\end{algorithm}

\begin{lemma}
    If $t$ and $t'$ are any two times such that $t' \geq t$, $b := \text{highestConfirmed}(\viewatstslottime[val=v,time=t])$ and the following holds:
    
    \begin{enumerate}
        \item $\slotstart(\epoch(t) - 1) \geq \GST,$
    \end{enumerate}
    
    then $b$ is canonical in the view of any honest validator $v'$ at time $t'$.
\end{lemma}

\begin{proof}
    TBD...
\end{proof}


\begin{lemma}
    If $t$ and $t'$ are any two times such that $t' \geq t$ and the following holds:
    
    \begin{enumerate}
        \item $\slotstart(\epoch(t')) \geq \GST,$
        \item $\epoch(\guattime[time=t,val=v]) = \epoch(t),$
        \item $\epoch(\gjattime[time=\slotstart(\slot(t)-1),val=v]) = \epoch(t) - 1,$
        \item $\guattime[time=t,val=v] \succeq \gjattime[time=\slotstart(\slot(t)-1),val=v],$
    \end{enumerate}
    
then $\guattime[time=t,val=v]$ is canonical in the view of any honest validator $v'$ at any time $t'$.
\end{lemma}

\begin{proof}
    TBD...

    \begin{description}
        \item[Case 1: $\epoch(t') = \epoch(t)$.]
        \item[Case 2: $\epoch(t') > \epoch(t)$.]  
    \end{description}
\end{proof}

\subsection*{Roberto's suggested Lemmas}

\SetKw{KwStateK}{State}
\SetKwBlock{KwState}{State:}{}
\SetKwFor{While}{while}{}{}%
\SetKw{Break}{break}
\SetKw{Const}{const}

\begin{algorithm}[H]
\caption{Find latest confirmed descendant}
\label{alg:findlatestconf}
\SetAlgoNoLine
\Fn{$\varforvalattime[val=v]{\mathit{next\_child}}(b,head)$}{
    $extension = \{ b' \in \viewattime[time={\varforvalattime[val=v]{t}},val=v], b \prec b' \preceq head \}$\\
    \uIf{$|extension| > 0$}
    {
        \Return{$\argmin_{b' \in extension} \slot(b')$}
    }
    \uElse{
        \Return{$\bot$}
    }
}

\Fn{$\varforvalattime[val=v]{\mathit{find\_latest\_confirmed\_descendant}}(b_c)$}
{
    $\bcand \gets b_c$\label{ln:bcand-set-beginning-of-find-latest}\\
    \Const $head \gets \LMDGHOSTHFC(\viewattime[time={\varforvalattime[val=v]{t}},val=v])$\\
    \Const $phead \gets \LMDGHOSTHFC(\viewattime[time={\slotstart(\slot(\varforvalattime[val=v]{t})-1)},val=v])$\\
    \uIf{$\slot(\varforvalattime[val=v]{t}) = \firstslot(\epoch(\varforvalattime[val=v]{t}))$} {
        $\chkp_{EBA} \gets \guattime[val=v,time={\slotstart(\slot(\varforvalattime[val=v]{t})-1)}]$
    }
    \uElse {
        $\chkp_{EBA} \gets \gjattime[val=v,time={\slotstart(\slot(\varforvalattime[val=v]{t})-1)}]$
    }
    


    \uIf{$\epoch(\bcand) = \epoch(\varforvalattime[val=v]{t}) - 1$ {\bf and}
        $\votsource[blck=phead, time={\varforvalattime[val=v]{t}}] \geq \epoch(\varforvalattime[val=v]{t}) - 2$ {\bf and}
        $(\slot(\varforvalattime[val=v]{t}) = \firstslot(\epoch(\varforvalattime[val=v]{t}))$ {\bf or}
        $(\willNoConflictingChkpBeJustified_v(\chkp(head, \epoch(\varforvalattime[val=v]{t})))$ {\bf and}
        $(\gu(phead) \geq \epoch(\varforvalattime[val=v]{t}) - 1$ {\bf or}
        $\gu(head) \geq \epoch(\varforvalattime[val=v]{t}) - 1)))$\label{ln:if-prev-epoch}}
    {
        \While{$\varforvalattime[val=v]{\mathit{next\_child}}(\bcand,head) \neq \bot$}
        {
            $\btemp \gets \varforvalattime[val=v]{\mathit{next\_child}}(\bcand,head)$\\
            \uIf{$\epoch(\btemp) < \epoch(\varforvalattime[val=v]{t})$ {\bf and}
                $\btemp \preceq phead$ {\bf and}
                $\isOneConfirmed_v(\btemp, \chkp_W)$}
            {
                $\bcand \gets \btemp$\label{ln:set-bcand-in-prev-epoch-loop}
            }
            \uElse { 
                \Break 
            }
        }
    }

    \uIf{$\slot(\varforvalattime[val=v]{t}) = \firstslot(\epoch(\varforvalattime[val=v]{t}))$ {\bf or}
        $\gu(head) \geq \epoch(\varforvalattime[val=v]{t}) - 1$\nllabel{ln:second-if}}
    {
        $\btcand \gets \bcand$\;
        \While{$\varforvalattime[val=v]{\mathit{next\_child}}(\btcand,head) \neq \bot$}
        {
            $\btemp \gets \varforvalattime[val=v]{\mathit{next\_child}}(\btcand,head)$\\
            \uIf{$\epoch(\btemp) > \epoch(\btcand)$ {\bf and}
                $\neg \willChkpBeJustified_v(\chkp(\btemp))$\label{ln:check-will-chkp-be-justified}}
            {
                \Break
            }
            \uIf{$\isOneConfirmed_v(\btemp, \chkp_{EBA})$\label{ln:if-is-one-confirmed-second-loop}} {
                $\btcand \gets \btemp$\label{set-btcand-to-btemp}
            }
            \uElse { 
                \Break 
            }
        }

        \uIf{$\epoch(\btcand) = \epoch(\varforvalattime[val=v]{t})$ {\bf or}
            $(\votsource[blck=\btcand, time={\varforvalattime[val=v]{t}}] \geq \epoch(\varforvalattime[val=v]{t}) - 2$ {\bf and}
            $(\slot(\varforvalattime[val=v]{t}) = \firstslot(\epoch(\varforvalattime[val=v]{t}))$ {\bf or}
            $\willNoConflictingChkpBeJustified_v(\chkp(head, \epoch(\varforvalattime[val=v]{t})))))$\label{ln:if-to-set-bcand-to-btcand}}
        {
            $\bcand \gets \btcand$\label{ln:set-bcand-to-btcand}
        }
    }

    \Return{$\bcand$}
    \marklastline{lastline}
}
\end{algorithm}

% \setcounter{algocf}{10}
\addtocounter{algocf}{-1}

\begin{algorithm}[H]
\caption{Full Algo}
\label{alg:conffull}
\SetAlgoNoLine
\continuefrom{lastline}
% \DontPrintSemicolon
% \KwStateK{$x \in \mathbb{R}$\\ $y \in \mathbb{R}$}\\
\KwState{
    $\varforvalattime[val=v]{\bconfirmed}$
}
\Upon{$\varforvalattime[val=v]{t} = \varforvalattime[val=v]{\tinit}$}{
    $\varforvalattime[val=v]{\bconfirmed}   \gets \block(\gfattime[time={\varforvalattime[val=v]{t}},val=v])$
}
\Upon{$\varforvalattime[val=v]{t} = \slotstartslot{\varforvalattime[val=v]{t}} \land \varforvalattime[val=v]{t} \geq \varforvalattime[val=v]{\tinit}$}{
    $\varforvalattime[val=v]{\bconfirmed} \gets \varforvalattime[val=v]{\mathit{get\_latest\_confirmed}}(\varforvalattime[val=v]{\bconfirmed})$
}
\Fn{$\varforvalattime[val=v]{\mathit{is\_chain\_one\_confirmed}}(b_c, C)$}{
    $b \gets b_c$\\
    \While{$b \neq \block(C) \land \isOneConfirmed_v(b_c, C)$}{
        $b \gets \parent(b)$
    }

    \Return{$b = \block(C)$}
}
\Fn{$\willNoConflictingChkpBeJustified_v(C)$}
{
    \Return{$\ffgvalsettoslotweight[target={C},to={\slot(\varforvalattime[val=v]{t})-1},time={\varforvalattime[val=v]{t}},val=v,weight chkp={C}]
    + (1-\beta)\commweightfromslot[from={\slot(\varforvalattime[val=v]{t})},to=\lastslot(\epoch(C)),chkp={C},when={\varforvalattime[val=v]{t}},val=v]{\allvals}
    \geq
    \frac{1}{3}\totvalsetweight[chkp={C}] {\allvals}
    % +
    % \min\left(
    %     \ffgequivweight,
    %     \beta \commweightfromslot[from=\slotstart(\epoch(C)),to={\slot(\varforvalattime[val=v]{t})}-1,chkp={C},when={\varforvalattime[val=v]{t}},val=v]{\allvals}
    % \right)
    $}
}
\Proc{$\varforvalattime[val=v]{\mathit{get\_latest\_confirmed}}(b_c)$}{
    $\bcand \gets b_c$\label{ln:set-bcand-beginning-of-get-latest-confirmed}\\
    \Const $\head \gets \LMDGHOSTHFC(\viewattime[time={\varforvalattime[val=v]{t}},val=v])$\\

    \uIf{$\epoch(\bcand) < \epoch(\varforvalattime[val=v]{t}) - 1$ {\bf or}
        $\bcand \npreceq \head$ {\bf or}
        $(\slot(\varforvalattime[val=v]{t}) = \firstslot(\epoch(\varforvalattime[val=v]{t}))$ 
        % {\bf and}
        % $\epoch(\bcand) \geq \epoch(t)-1$  
        {\bf and}
        $\neg (\varforvalattime[val=v]{\mathit{is\_chain\_one\_confirmed}}(b_c, \guattime[val=v,time=\slotstart(\slot(t)-1)]))$ {\bf and} $b_c \succeq \guattime[val=v,time=\slotstart(\slot(t)-1)]$\label{ln:if-bcand-npreceq-head}}{
        $\bcand \gets \block(\gfattime[val=v,time={\varforvalattime[val=v]{t}}])$\label{ln:set-bcand-to-fin}
    }

    \uIf{$\slot(\varforvalattime[val=v]{t}) = \firstslot(\epoch(\varforvalattime[val=v]{t}))$ {\bf and}
        $\epoch(\guattime[val=v,time={\slotstart(\slot(\varforvalattime[val=v]{t})-1)}]) = \epoch(\varforvalattime[val=v]{t})-1$ {\bf and}
        $\gu(\LMDGHOSTHFC(\viewattime[time={\varforvalattime[val=v]{t}},val=v])) = \guattime[val=v,time={\slotstart(\slot(\varforvalattime[val=v]{t})-1)}]$ {\bf and}
        $\slot(\bcand) < \slot(\block(\guattime[val=v,time={\slotstart(\slot(\varforvalattime[val=v]{t})-1)}]))$
        \label{ln:start-conf-chain}}
    {
        $\bcand \gets \block(\guattime[val=v,time={\slotstart(\slot(\varforvalattime[val=v]{t})-1)}])$\label{ln:set-bcan-on-start-conf-chain}
    }

    \uIf{$\epoch(\bcand) \geq \epoch(\varforvalattime[val=v]{t}) - 1$\label{ln:if-bcand-e-1}}
    {
        $\bcand \gets \varforvalattime[val=v]{\mathit{find\_latest\_confirmed\_descendant}}(\bcand)$\label{ln:set-bcand-to-output-find-latest}
    }

    \Return{$\bcand$}
}
\end{algorithm}

\begin{definition}[Notation]\leavevmode\label{def:b-cand-is-b-conf}
    \begin{enumerate}
        \item Let $\varforvalattime[time=t,val=v]{\bconfirmed}$ be the value of $\varforvalattime[val=v]{\bconfirmed}$ after the execution of any code that should be executed at timer $t$ as per \Cref{alg:conffull}.
        If $t < \varforvalattime[val=v]{\tinit}$, then $\varforvalattime[time=t,val=v]{\bconfirmed}$ corresponds to the value of $\varforvalattime[val=v]{\bconfirmed}$ after executing any code that should be executed at time $\varforvalattime[val=v]{\tinit}$.
        With this convention, we have the property that $\varforvalattime[val=v,time=\slotstart(\slot(t))]{get\_latest\_confirmed}(b_c)$ implies that $b_c = \varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}$.
        \item Let $\varforvalattime[val=v,time=\slotstartslot{t}]{\bcands}$ be the set of all the values assumed by $\bcand$ during the execution of \Cref{alg:conffull} by validator $v$ at time $\slotstartslot{t}$
        \item $\canonical[time=t,blck=b,to=t_f]$ means that any time time $t'\in [t,t_f]$ block $b$ is canonical in the view of any honest validator.
        \item $\canonical[time=t,blck=b] := \canonical[time=t,blck=b,to=\infty]$.
    \end{enumerate}
\end{definition}

\begin{lemma}[This Lemma is used in the following proofs without explicitly calling it (this is not standard practice though!)]
    \leavevmode
    $\bconfirmed[val=v,time=\slotstart(\slot(t))] \in \varforvalattime[val=v,time=\slotstart(\slot(t))]{\bcands}$
\end{lemma}
\begin{proof}
    Obvious.
\end{proof}

\begin{lemma}\label{lem:conf-current-epoch-then-gu-curr-epoch}
    Pick any $b_c \in  \varforvalattime[val=v,time=\slotstart(\slot(t))]{\bcands}$.
    If
    \begin{enumerate}
        \item $\epoch(b_c) = \epoch(t)$
    \end{enumerate},
    then
    \begin{enumerate}
        \item $\exists b' \in \viewattime[val=v,time=\slotstartslot{t}], b' \succeq b_c \land \epoch(\gu(b')) \geq \epoch(t)-1$
        % \item $\banchor^{v,\slotstart(\slot(t))} \succeq GJ^{v,t}$
    \end{enumerate}
\end{lemma}

\begin{proof}
    % Assume we start executing the algorithm at time $t_0 = \slotstartslot{t_0}$.
    By induction on $\slot(t)$.
    Let $s := \slot(t)$.
    \begin{description}
        \item[Base Case: {$s = \slot(\varforvalattime[val=v]{\tinit})$}.] The Lemma is vacuously true.
        \item[Inductive Case: {$s \geq \slot(\varforvalattime[val=v]{\tinit})$}.] We assume that the Lemma holds for $s$ and prove that it also holds for $s+1$.
        Pick any $b_c \in  \varforvalattime[val=v,time=\slotstart(s+1)]{\bcands}$ such that $\epoch(b_c) = \epoch(s+1)$.
        This implies that slot $s+1 \neq \firstslot(\epoch(s+1))$ as, if so, it could not be that  $\epoch(b_c) = \epoch(s+1)$.
        This then implies that  $\epoch(s+1) = \epoch(s)$.
        \begin{description}
            \item[Case 1: {$b_c = \varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}$}.]
            Just apply the inductive hypothesis.
            \item[Case 2: {$b_c \neq \varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}$}.]
            Given that we assume $\epoch(s+1) = \epoch(b_c)$, it must be that the \KwSty{if} condition at \Cref{ln:second-if} is true.
            Given that  $s+1 \neq \firstslot(\epoch(s+1))$, then $\gu(\head) \geq \epoch(s+1)-1$.
            The \KwSty{if} block at \Cref{ln:if-bcand-npreceq-head} ensures that $b_c \preceq \head$.
        \end{description}
    \end{description}
\end{proof}

% \begin{lemma}[Old. Now reaplced by \Cref{lem:conf-current-epoch-then-gu-curr-epoch}]
%     If
%     \begin{enumerate}
%         \item $\epoch(\bconfirmed[val=v,time=\slotstart(\slot(t))]) = \epoch(t)$
%     \end{enumerate},
%     then
%     \begin{enumerate}
%         \item $\exists b' \in \viewattime[val=v,time=\slotstartslot{t}], \epoch(\gu(b')) \geq \epoch(t)-1$
%         % \item $\banchor^{v,\slotstart(\slot(t))} \succeq GJ^{v,t}$
%     \end{enumerate}
% \end{lemma}

% \begin{proof}
%     % Assume we start executing the algorithm at time $t_0 = \slotstartslot{t_0}$.
%     By induction on $\slot(t)$.
%     Let $s := \slot(t)$.
%     \begin{description}
%         \item[Base Case: {$s = \slot(\varforvalattime[val=v]{\tinit})$}.] The Lemma is vacuously true.
%         \item[Inductive Case: {$s \geq \slot(\varforvalattime[val=v]{\tinit})$}.] We assume that the Lemma holds for $s$ and prove that it also holds for $s+1$.
%         We also assume that $\epoch(\varforvalattime[val=v,time=\slotstart(s+1)]{\bconfirmed}) = \epoch(s+1)$ as the Lemma holds vacuously otherwise.
%         This implies that slot $s+1 \neq \firstslot(\epoch(s+1))$ as, if so, it could not be that  $\epoch(\varforvalattime[val=v,time=\slotstart(s+1)]{\bconfirmed}) = \epoch(s+1)$.
%         This then implies that  $\epoch(s+1) = \epoch(s)$.
%         % This implies that $\epoch(s+1) = \epoch(s)$ as, otherwise, it would mean that we are the beginning of epoch $\epoch(s)+1$ and, therefore, it cannot be that $\epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}) = \epoch(s+1)$ reaching a contradiction.
%         \begin{description}
%             \item[Case 1: {$\epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}) = \epoch(s)$}.] Given that $\epoch(s+1) = \epoch(s)$, the proof for this case follows directly from the inductive hypothesis.
%             \item[Case 2: {$\epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}) \neq \epoch(s)$}.] 
%             Given that $\epoch(\varforvalattime[val=v,time=\slotstart(s+1)]{\bconfirmed}) = \epoch(s+1) = \epoch(s)$, it must be that condition at Line XXX is true which implies that the Lemma holds.
%         \end{description}
%     \end{description}
% \end{proof}

% \begin{lemma}\label{lem:current-epoch-then-gu-prev-epoch}
%     If
%     \begin{enumerate}
%         \item $\epoch(\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}) = \epoch(t)$
%     \end{enumerate},
%     then
%     \begin{enumerate}
%         \item $\exists b' \in \viewattime[val=v,time=\slotstartslot{t}], b' \succeq \varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed} \land \epoch(\gu(b')) \geq \epoch(t)-1$
%         % \item $\banchor^{v,\slotstart(\slot(t))} \succeq GJ^{v,t}$
%     \end{enumerate}
% \end{lemma}

% \begin{proof}
%     % Assume we start executing the algorithm at time $t_0 = \slotstartslot{t_0}$.
%     By induction on $\slot(t)$.
%     Let $s := \slot(t)$.
%     \begin{description}
%         \item[Base Case: {$s = \slot(\varforvalattime[val=v]{\tinit})$}.] The Lemma is vacuously true.
%         \item[Inductive Case: {$s \geq \slot(\varforvalattime[val=v]{\tinit})$}.] We assume that the Lemma holds for $s$ and prove that it also holds for $s+1$.
%         We also assume that $\epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}) = \epoch(s+1)$ as the Lemma holds vacuously otherwise.
%         This implies that $\epoch(s+1) = \epoch(s)$ as, otherwise, it would mean that we are the beginning of epoch $\epoch(s)+1$ and, therefore, it cannot be that $\epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}) = \epoch(s+1)$ reaching a contradiction.
%         \begin{description}
%             \item[Case 1: {$\epoch(\varforvalattime[val=v,time=\slotstart(s-1)]{\bconfirmed}) = \epoch(s)$}.] 
%             Given that $\epoch(s+1) = \epoch(s)$, the proof for this case follows directly from the inductive hypothesis.
%             \item[Case 2: {$\epoch(\varforvalattime[val=v,time=\slotstart(s-1)]{\bconfirmed}) \neq \epoch(s)$}.] 
%             Given that $\epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}) = \epoch(s+1) = \epoch(s)$, it must be that condition at Line XXX is true which implies that the Lemma holds.
%         \end{description}
%     \end{description}
% \end{proof}

\begin{lemma}\label{lem:output-find-latest-different-to-input}
    Let $b_o := \varforvalattime[val=v]{\mathit{find\_latest\_confirmed\_descendant}}(b_c)$.
    If 
    \begin{enumerate}
        \item $b_o \neq b_c$
        \item $\epoch(b_o) = \epoch(\varforvalattime[val=v]{t}) - 1$
    \end{enumerate},
    then, there exists an honest validator $v'$ such that 
    \begin{enumerate}
        \item $\exists b' \in \left(\viewattime[time=\votingtime(\slot({\varforvalattime[val=v]{t}})-1),val=v'] \cap \viewattime[time=\slotstart(\slot({\varforvalattime[val=v]{t}})),val=v]\right), b' \succeq b_o \land \epoch(\votsource[blck=b',time=\slotstartslot{{\varforvalattime[val=v]{t}}}])\geq \epoch({\varforvalattime[val=v]{t}})-2$
    \end{enumerate}    
\end{lemma}

\begin{proof}
    It must be that $\bcand \gets b_o$ at some point during the execution of   $\mathit{find\_latest\_confirmed\_descendant}$.
    Below by cases on the line  of $\mathit{find\_latest\_confirmed\_descendant}$ where this occurs.
    \begin{description}
        \item[\Cref{ln:bcand-set-beginning-of-find-latest}.]  Impossible as this lines sets $\bcand$ to $b_c \neq b_o$.
        \item[\Cref{ln:set-bcand-in-prev-epoch-loop}.] 
        If $\bcand$ is set to $b_o$ here, then it must be that $b_o \preceq phead$ which also implies $phead \in \viewattime[time=\slotstart({\varforvalattime[val=v]{t}}-1),val=v] \subseteq \viewattime[time=\votingtime({\varforvalattime[val=v]{t}}-1),val=v] \subseteq \viewattime[time=\slotstart({\varforvalattime[val=v]{t}}),val=v]$.
        Then, given \Cref{ln:if-prev-epoch} and the Lemma statement, $phead \succeq b_o \land \epoch(\votsource[blck=phead, time={\slotstartslot{\varforvalattime[val=v]{t}}}]) \geq \epoch({\varforvalattime[val=v]{t}}) - 2$.
        \item[\Cref{ln:set-bcand-to-btcand}] If $\bcand$ is set to $b_o$ here, then, due to \Cref{ln:if-to-set-bcand-to-btcand}, $\epoch(\votsource[blck=b_o, time={\slotstartslot{\varforvalattime[val=v]{t}}}]) \geq \epoch(\varforvalattime[val=v]{t}) - 2$.
        Due to \Cref{ln:if-is-one-confirmed-second-loop,set-btcand-to-btemp}, $\isOneConfirmed(b_o, \cdot)$ which implies\RSfn{We should probably have a Lemma proving such an implication} that there exists an honest validator $v'$ such that
        $b_o \in \left(\viewattime[time=\votingtime({\varforvalattime[val=v]{t}}-1),val=v']\cap \viewattime[time=\slotstart({\varforvalattime[val=v]{t}}),val=v]\right)$.
    \end{description}
\end{proof}

% \begin{lemma}\label{lem:output-find-latest-different-to-input}
%     Let $b_o := \varforvalattime[val=v]{\mathit{find\_latest\_confirmed\_descendant}}(b_c)$.
%     If $b_o \neq b_c$, then
%     then, 
%     \begin{enumerate}
%         \item $\exists b' \in \viewattime[time=\slotstart(\slot({\varforvalattime[val=v]{t}})),val=v'], b' \succeq b_o \land \epoch(\votsource[blck=b',time=\slotstartslot{{\varforvalattime[val=v]{t}}}])\geq \epoch({\varforvalattime[val=v]{t}})-2$
%     \end{enumerate}    
% \end{lemma}

% \begin{proof}
%     It must be that $\bcand \gets b_o$ at some point during the execution of   $\mathit{find\_latest\_confirmed\_descendant}$.
%     Below by cases on the line  of $\mathit{find\_latest\_confirmed\_descendant}$ where this occurs.
%     \begin{description}
%         \item[\Cref{ln:bcand-set-beginning-of-find-latest}.]  Impossible as this lines sets $\bcand$ to $b_c \neq b_o$.
%         \item[\Cref{ln:set-bcand-in-prev-epoch-loop}.] 
%         If $\bcand$ is set here, then it must be that $\bcand \preceq phead$ which also implies $\bcand \in \viewattime[time=\slotstart({\varforvalattime[val=v]{t}}),val=v]$.
%         Then, given \Cref{ln:if-prev-epoch}, $\votsource[blck=phead, time=\slotstart({\varforvalattime[val=v]{t}})] \geq \epoch({\varforvalattime[val=v]{t}}) - 2$.
%         \item[\Cref{ln:set-bcand-to-btcand}] If $\bcand$ is set here, then, due to \Cref{ln:if-to-set-bcand-to-btcand}, $\votsource[blck=\bcand, time={\varforvalattime[val=v]{t}}] \geq \epoch(\varforvalattime[val=v]{t}) - 2$ and clearly $\bcand \in \viewattime[time=\slotstart({\varforvalattime[val=v]{t}}),val=v]$.
%         % Due to \Cref{ln:if-is-one-confirmed-second-loop,set-btcand-to-btemp}, $\isOneConfirmed(\bcand, \cdot)$ which implies\RSfn{We should probably have a Lemma proving such an implication} that there exists an honest validator $v'$ such that
%         % $\bcand \in \viewattime[time=\slotstart({\varforvalattime[val=v]{t}}-1),val=v']$.
%     \end{description}    
% \end{proof}

\begin{lemma}\label{lem:when-restarting-vs-from-prev-epoch}
    Pick any $b_c \in  \varforvalattime[val=v,time=\slotstart(\slot(t))]{\bcands}$.
    If
    \begin{enumerate}
        \item $\epoch(\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}) < \epoch(t)-1$
        \item $\epoch(b_c) \geq \epoch(t)-1$
    \end{enumerate},
    then, there exists an honest validator $v'$ such that 
    \begin{enumerate}
        \item $\exists b' \in \viewattime[time=\votingtime(\slot(t)-1),val=v'], b' \succeq b_c \land \epoch(\votsource[blck=b',time=\slotstartslot{t}])\geq \epoch(t)-2$
    \end{enumerate}
\end{lemma}
\begin{proof}
    Let $s:= \slot(t)$.
    It must be that we restart the ``confirmation chain'' at time $\slotstart(s)$ as there is no other way to satisfy the conditions in the Lemma's statement.
    This means that conditions at \Cref{ln:start-conf-chain} are true.

    Now, we prove the statement by induction on the lines, in order of execution, where $\bcand$ might be set.
    
    Given the above, we know that the first time it is set is at \Cref{ln:set-bcan-on-start-conf-chain}

    \begin{description}
        \item[\Cref{ln:set-bcan-on-start-conf-chain}.] Obvious. \RSfn{Perhaps explain a bit more why in the future.} 
        \item[\Cref{ln:set-bcand-to-output-find-latest}.] Given $\slot(t) = \firstslot(\epoch(t))$ and the assumption in the Lemma statement, we know that $\epoch(b_c) = \epoch(t) - 1$ and thus can apply \Cref{lem:output-find-latest-different-to-input} to conclude the proof.
    \end{description}
\end{proof}

% \begin{lemma}\label{lem:when-restarting-vs-from-prev-epoch}
%     Pick any $b_c \in  \varforvalattime[val=v,time=\slotstart(\slot(t))]{\bcands}$..
%     If
%     \begin{enumerate}
%         \item $\epoch(\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}) < \epoch(t)-1$
%         \item $\epoch(b_c) \geq \epoch(t)-1$
%     \end{enumerate},
%     then,
%     \begin{enumerate}
%         \item $\exists b' \in \viewattime[time=\slotstart(\slot(t)),val=v], b' \succeq b_c \land \epoch(\votsource[blck=b',time=\slotstartslot{t}])\geq \epoch(t)-2$
%     \end{enumerate}
% \end{lemma}
% \begin{proof}
%     Let $s:= \slot(t)$.
%     It must be that we restart the ``confirmation chain'' at time $\slotstart(s)$ as there is no other way to satisfy the conditions in the Lemma's statement.
%     This means that conditions at \Cref{ln:start-conf-chain} are true.

%     Now, we prove the statement by induction on the lines, in order of execution, where $\bcand$ might be set.
    
%     Given the above, we know that the first time it is set is at \Cref{ln:set-bcan-on-start-conf-chain}

%     \begin{description}
%         \item[\Cref{ln:set-bcan-on-start-conf-chain}.] Obvious. \RSfn{Perhaps explain a bit more why in the future.} 
%         \item[\Cref{ln:set-bcand-to-output-find-latest}.] Obvious from \Cref{lem:output-find-latest-different-to-input}.
%     \end{description}
% \end{proof}



% \begin{lemma}\label{lem:when-restarting-vs-from-prev-epoch}
%     Pick any $b_c \in  \varforvalattime[val=v,time=\slotstart(\slot(t))]{\bcands}$..
%     If
%     \begin{enumerate}
%         \item $\epoch(\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}) < \epoch(t)-1$
%         \item $\epoch(b_c) \geq \epoch(t)-1$
%     \end{enumerate},
%     then,
%     \begin{enumerate}
%         \item $\exists b' \in \viewattime[time=\slotstart(\slot(t)),val=v], b' \succeq b_c \land \epoch(\votsource[blck=b',time=\slotstartslot{t}])\geq \epoch(t)-2$
%     \end{enumerate}
% \end{lemma}
% \begin{proof}
%     Let $s:= \slot(t)$.
%     It must be that we restart the ``confirmation chain'' at time $\slotstart(s)$ as there is no other way to satisfy the conditions in the Lemma's statement.
%     This means that conditions at \Cref{ln:start-conf-chain} are true.

%     Now, we prove the statement by induction on the lines, in order of execution, where $\bcand$ might be set.
    
%     Given the above, we know that the first time it is set is at \Cref{ln:set-bcan-on-start-conf-chain}

%     \begin{description}
%         \item[\Cref{ln:set-bcan-on-start-conf-chain}.] Obvious. \RSfn{Perhaps explain a bit more why in the future.} 
%         \item[\Cref{ln:set-bcand-to-output-find-latest}.] Obvious from \Cref{lem:output-find-latest-different-to-input}.
%     \end{description}
% \end{proof}

% \begin{lemma}\label{lem:conf-prev-epoch-then-vs-two-epochs-ago-old}
%     If
%     \begin{enumerate}
%         \item $\epoch(\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}) \geq \epoch(t)-1$
%     \end{enumerate},
%     then
%     \begin{enumerate}
%         \item $\exists b' \in \viewattime[time=\slotstart(\slot(t)-1),val=v], \epoch(\votsource[blck=b',time=\slotstartslot{t}])\geq \epoch(t)-2$
%         % \item $\banchor^{v,\slotstart(\slot(t))} \succeq GJ^{v,t}$
%     \end{enumerate}
% \end{lemma}

% \begin{lemma}%[Replacement for \Cref{lem:conf-prev-epoch-then-vs-two-epochs-ago-old}]
%     % \label{lem:conf-prev-epoch-then-vs-two-epochs-ago}
%     %  \label{lem:vs-at-least-e-2}
%     Pick any $b_c \in  \varforvalattime[val=v,time=\slotstart(\slot(t))]{\bcands}$.
%     If
%     \begin{enumerate}
%         \item $\epoch(b_c) \geq \epoch(t)-1$
%         \item $\epoch(\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}) \geq \epoch(t)-1$
%     \end{enumerate},
%     then, 
%     \begin{enumerate}
%         \item $\exists b' \in \viewattime[time=\slotstart(\slot(t)-1),val=v], b' \succeq  b_c \land \epoch(\votsource[blck=b',time=\slotstartslot{t}])\geq \epoch(t)-2$
%         % \item $\banchor^{v,\slotstart(\slot(t))} \succeq GJ^{v,t}$
%     \end{enumerate}
% \end{lemma}

% \begin{proof}
%     By induction on $\slot(t)$.
%     Let $s := \slot(t)$.
%     \begin{description}
%         \item[Base Case: {$s = \slot(\varforvalattime[val=v]{\tinit})$}.] The Lemma is vacuously true.
%         \item[Inductive Case: {$s \geq \slot(\varforvalattime[val=v]{\tinit})$}.] We assume that the Lemma holds for $s$ and prove that it also holds for $s+1$.
%         So let $b_c \in  \varforvalattime[val=v,time=\slotstart(s+1)]{\bcands}$.
%         We also assume that $\epoch(b_c) \geq \epoch(s+1)-1$ and $\epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}) \geq \epoch(s+1)-1$ as the Lemma holds vacuously otherwise.
%         Note that this implies that $\epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}) \geq \epoch(s)-1$.
%         By case.
%         \begin{description}
%             \item[Case 1: {$b_c = \varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}$}.] 
%             By sub cases again.
%             \begin{description}
%                 \item[Case 1.1: $\epoch(s+1) = \epoch(s).$] 
%                 Given that $\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed} \in \varforvalattime[val=v,time=\slotstart(s)]{\bcands}$,
%                 we can apply the inductive hypothesis to conclude that $\exists b' \in \viewattime[time=\slotstart(s-1),val=v], b' \succeq b_c \land \epoch(\votsource[blck=b',time=\slotstart(s)])\geq \epoch(s)-2 = \epoch(s+1)-2$.
%                 So, given that $\viewattime[time=\slotstart(s-1),val=v'] \subseteq \viewattime[time=\slotstart(s),val=v']$, the proof for this case is concluded.
%                 \item[Case 1.2: $\epoch(s+1) = \epoch(s) + 1.$]
%                 This Case implies that $\epoch(b_c) = \epoch(s)$ as 
%                 $\epoch(s) = \epoch(s+1) -1 \leq \epoch(b_c) < \epoch(s+1) = \epoch(s) + 1$.
%                 Note also that  $\epoch(s+1) = \epoch(s) + 1$ implies that $s+1 = \firstslot(\epoch(s+1))$.
%                 All of this together with  \Cref{lem:conf-current-epoch-then-gu-curr-epoch} implies that $\exists b' \in \viewattime[time=\slotstart(s),val=v], \epoch(\votsource[blck=b',time=\slotstart(s+1)])\geq \epoch(\gu(b')) \geq \epoch(s)-1\geq\epoch(s+1)-2$.
%             \end{description}
%             \item[Case 2.2: {$b_c \neq \varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}$}.]
%             Now by cases on the first line, in order of execution of the Fast Confirmation Rule algorithm at time $\slotstart(s+1)$, where $\bcand = b_c$. 
%             \begin{description}
%                 \item[\Cref{ln:set-bcand-beginning-of-get-latest-confirmed}.] 
%                 Impossible, as at this line $\bcand = b_c$, but $b_c \neq \varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}$.
%                 \item[\Cref{ln:set-bcand-to-fin}.] Impossible, as at this line $\epoch(\bcand) < \epoch(s+1)-1$, but we assume $\epoch(b_c) \geq \epoch(s+1)-1$.
%                 \item[\Cref{ln:set-bcan-on-start-conf-chain}.] Obvious. \RSfn{Perhaps explain a bit more why in the future.} 
%                 \item[\Cref{ln:set-bcand-to-output-find-latest}.] Obvious from \Cref{lem:output-find-latest-different-to-input}.
%             \end{description}
%         \end{description}
%     \end{description}
% \end{proof}

\begin{lemma}\label{lem:output-find-latest-different-to-input-then-output-older-than-current-slot}
    Let $b_o := \varforvalattime[val=v]{\mathit{find\_latest\_confirmed\_descendant}}(b_c)$.
    If 
    \begin{enumerate}
        \item $b_o \neq b_c$
    \end{enumerate},
    then, 
    \begin{enumerate}
        \item $\slot(b_o) < \slot(\varforvalattime[val=v]{t})$
    \end{enumerate}    
\end{lemma}

\begin{proof}(Sketch)
    Every time that we set $\bcand$, we set it to a block that has received at least a vote from an honest node and honest nodes never vote for blocks in the future.
\end{proof}

\begin{lemma}\label{lem:bcand-less-than-current-slot}
    Pick any $b_c \in  \varforvalattime[val=v,time=\slotstart(\slot(t))]{\bcands}$.
    Then, $\slot(b_c) < \slot(t)$
\end{lemma}

\begin{proof}
    By induction on $\slot(t)$.
    Let $s := \slot(t)$.
    \begin{description}
        \item[Base Case: {$s = \slot(\varforvalattime[val=v]{\tinit})$}.] Obvious.
        \item[Inductive Case: {$s \geq \slot(\varforvalattime[val=v]{\tinit})$}.]
            We assume that the Lemma holds for $s$ and prove that it also holds for $s+1$.
            Pick any $b_c \in \varforvalattime[val=v,time=\slotstart(s+1)]{\bcands}$.
            By cases.
            \begin{description}
                \item[Case 1: {$b_c = \varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}$}.] Then, we can apply the inductive hypothesis and conclude that $\slot(b_c) < s < s+1$.
                \item[Case 2: {$b_c \neq \varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}$}.]
                Now by cases on the first line, in order of execution of the Fast Confirmation Rule algorithm at time $\slotstart(s+1)$, where $\bcand = b_c$. 
                \begin{description}
                    \item[\Cref{ln:set-bcand-beginning-of-get-latest-confirmed}.] 
                    Impossible, as at this line $\bcand = b_c$, but $b_c \neq \varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}$.
                    \item[\Cref{ln:set-bcand-to-fin}.] $\epoch(\bcand) < \epoch(s+1)-1 < \epoch(s+1)$.
                    \item[\Cref{ln:set-bcan-on-start-conf-chain}.] $\epoch(\bcand) = \epoch(s+1)-1 < \epoch(s+1)$. 
                    \item[\Cref{ln:set-bcand-to-output-find-latest}.] Apply \Cref{lem:output-find-latest-different-to-input-then-output-older-than-current-slot}.
                \end{description}
            \end{description}
    \end{description}
\end{proof}


\begin{lemma}\label{lem:bcand-current-epoch-then-no-first-slot}
    Pick any $b_c \in  \varforvalattime[val=v,time=\slotstart(\slot(t))]{\bcands}$.
    If
    \begin{enumerate}
        \item $\epoch(b_c) = \epoch(t)$
    \end{enumerate}
    , then
    \begin{enumerate}
        \item  $\slot(t) > \text{\firstslot}(\epoch(t))$
    \end{enumerate}
\end{lemma}

\begin{proof}(under-construction)\\
    By induction on $\slot(t)$.
    Let $s := \slot(t)$.
    \begin{description}
        \item[Base Case: {$s = \slot(\varforvalattime[val=v]{\tinit})$}.] The Lemma is vacuously true.
        \item[Inductive Case: {$s \geq \slot(\varforvalattime[val=v]{\tinit})$}.]
            We assume that the Lemma holds for $s$ and prove that it also holds for $s+1$.
            Pick any $b_c \in \varforvalattime[val=v,time=\slotstart(s+1)]{\bcands}$ such that $\epoch(b_c) = \epoch(s+1)$.
            By cases.
            \begin{description}
                \item[Case 1: {$b_c = \varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}$}.] From \Cref{lem:bcand-less-than-current-slot} we have that $\slot(b_c) < s$.
                Given that $\firstslot(\epoch(s+1)) \leq \slot(b_c)$, this implies that $\epoch(s) = \epoch(s+1)$.
                By applying the inductive hypothesis, we get $s  \geq \firstslot(\epoch(s)) = \firstslot(\epoch(s+1))$.
                Therefore, $s+1 > s \geq \firstslot(\epoch(s+1))$.
                \item[Case 2: {$b_c \neq \varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}$}.]
                Now by cases on the first line, in order of execution of the Fast Confirmation Rule algorithm at time $\slotstart(s+1)$, where $\bcand = b_c$. 
                \begin{description}
                    \item[\Cref{ln:set-bcand-beginning-of-get-latest-confirmed}.] 
                    Impossible, as at this line $\bcand = b_c$, but $b_c \neq \varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}$.
                    \item[\Cref{ln:set-bcand-to-fin}.] Impossible, as at this line $\epoch(\bcand) < \epoch(s+1)-1$, but we assume $\epoch(b_c) = \epoch(s+1)$.
                    \item[\Cref{ln:set-bcan-on-start-conf-chain}.] Impossible, as at this line $\epoch(\bcand) = \epoch(s+1)-1$. 
                    \item[\Cref{ln:set-bcand-to-output-find-latest}.] From \Cref{lem:bcand-less-than-current-slot}, we have that $\slot(b_c) < \slot(s+1)$. Then, $\slot(s+1) > \slot(b_c) \geq \firstslot(\epoch(s+1))$.
                \end{description}
            \end{description}
    \end{description}
\end{proof}

\begin{lemma}\label{lem:out-find-latest-conf-prec-head}
    Let $b_o := \varforvalattime[val=v]{\mathit{find\_latest\_confirmed\_descendant}}(b_c)$.
    If 
    \begin{enumerate}
        \item $b_o \neq b_c$
    \end{enumerate},
    then, 
    \begin{enumerate}
        \item $b_o \preceq \LMDGHOSTHFC(\viewatstslottime[val=v,time=t])$
    \end{enumerate}
\end{lemma}
\begin{proof}
    Obvious.
\end{proof}

\begin{lemma}
    $\bconfirmed[val=v,time=\slotstart(\slot(t))] \preceq \LMDGHOSTHFC(\viewatstslottime[val=v,time=t])$\label{lem:bconf-always-canonical}
\end{lemma}
\begin{proof}\RSfn{I know that this looks like a very complicated proof to establish something obvious. It's because reasoningon program executions in a manual way is very pedantic in nature.}
    By contradiction, assume that $\bconfirmed[val=v,time=\slotstart(\slot(t))] \npreceq \LMDGHOSTHFC(\viewatstslottime[val=v,time=t])$.
    Note that must be that $\bcand \gets \bconfirmed[val=v,time=\slotstart(\slot(t))]$ at some point during the execution of  $\mathit{find\_latest\_confirmed\_descendant}$ and $\bcand$ is not set any other value (expect for potentially setting it to $\bconfirmed[val=v,time=\slotstart(\slot(t))]$ again) until the \KwSty{return} statement.
    Below by cases on the line  of $\mathit{find\_latest\_confirmed\_descendant}$ where this occurs.
    \begin{description}
        \item[\Cref{ln:set-bcand-beginning-of-get-latest-confirmed}.] 
        If $\bcand = \bconfirmed[val=v,time=\slotstart(\slot(t))] \npreceq \LMDGHOSTHFC(\viewatstslottime[val=v,time=t])$, then \Cref{ln:set-bcand-to-fin} is also executed.
        This line sets $\bcand$ to $\block(\gfattime[val=v,time={\varforvalattime[val=v]{t}}]) \preceq \LMDGHOSTHFC(\viewatstslottime[val=v,time=t])$. 
        Given the above, this implies that \Cref{ln:set-bcand-to-fin} sets $\bcand$ to a value different from $\bconfirmed[val=v,time=\slotstart(\slot(t))]$.
        Therefore \Cref{ln:set-bcand-beginning-of-get-latest-confirmed} is not the last line where $\bcand$ is set $\bconfirmed[val=v,time=\slotstart(\slot(t))]$ and any successive line setting $\bcand$ sets it to $\bconfirmed[val=v,time=\slotstart(\slot(t))]$.\RSfn{Perhaps improve the English here :)}
        \item[\Cref{ln:set-bcand-to-fin}.] Obvious\RSfn{Pehaps explain a bit more why}.
        \item[\Cref{ln:set-bcan-on-start-conf-chain}.] In this case $\bcand = \gjattime[val=v,time=\slot(t)]$ which implies $\bconfirmed[val=v,time=\slotstart(\slot(t))] \preceq \LMDGHOSTHFC(\viewatstslottime[val=v,time=t])$ reaching a contradiction.
        \item[\Cref{ln:set-bcand-to-output-find-latest}.]  \Cref{lem:out-find-latest-conf-prec-head} implies that if this line is executed, then the value of $\bcand$ is not updated which means that there exists a previous line where $\bcand \gets \bconfirmed[val=v,time=\slotstart(\slot(t))]$ reaching a contradiction.
    \end{description}
\end{proof}


\begin{lemma}\label{lem:out-find-latest-conf-descendant-output}
    $\varforvalattime[val=v]{\mathit{find\_latest\_confirmed\_descendant}}(b_c) \succeq b_c$
\end{lemma}
\begin{proof}
    Obvious.
\end{proof}

\begin{lemma}\label{lem:prev-conf-at-least-e-1}
    Pick any $b_c \in  \varforvalattime[val=v,time=\slotstart(\slot(t))]{\bcands}$.
    If
    \begin{enumerate}
        \item $\slot(t) > \text{\firstslot}(\epoch(t))$
        \item $\epoch(b_c) \geq \epoch(t)-1$
    \end{enumerate},
    then
    \begin{enumerate}
        \item $\epoch(\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}) \geq \epoch(t)-1$
        \item $\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed} \preceq \LMDGHOSTHFC(\viewatstslottime[val=v,time=t])$
        \item $\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed} \preceq b_c$
    \end{enumerate}
\end{lemma}

\begin{proof}\RSfn{I think that the structure of this proof should be improved}
By \Cref{def:b-cand-is-b-conf} algorithm execution at $\slotstartslot{t}$ starts with
$b_c = \varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}$.
Given Condition 1 of the Lemma's statement, condition at \Cref{ln:start-conf-chain}
does not hold making code at \Cref{ln:set-bcan-on-start-conf-chain} unreachable.
We also know that condition at \Cref{ln:if-bcand-npreceq-head} does not hold, otherwise,
$b_c = \gfattime[time=\slotstartslot{t},val=v]$
and $\epoch(b_c) \leq \epoch(t) - 2$
which contradicts Condition 2 of the Lemma's statement.

Let's now move to proving Conclusion 3.
By cases.
\begin{description}
    \item[Case 1: {$b_c = \varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bcands}$}.]  Obvious.
    \item[Case 2: {$b_c \neq \varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bcands}$}.]
    Now by cases on the first line, in order of execution of the Fast Confirmation Rule algorithm at time $\slotstart(s+1)$, where $\bcand = b_c$. 
    \begin{description}
        \item[\Cref{ln:set-bcand-beginning-of-get-latest-confirmed}.] 
        Impossible, as at this line $\bcand = b_c$, but $b_c \neq \varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}$.
        \item[\Cref{ln:set-bcand-to-fin}.] Impossible, as at this line $\epoch(\bcand) < \epoch(\slot(t)+1)-1$, but we assume $\epoch(b_c) \geq \epoch(\slot(t)+1) -1$.
        \item[\Cref{ln:set-bcan-on-start-conf-chain}.] Impossible, as at this line cannot be executed if $\slot(t) \neq \firstslot(\epoch(t))$.
        \item[\Cref{ln:set-bcand-to-output-find-latest}.] Given that this is the only line where $\bcand \gets b_c$, \Cref{lem:out-find-latest-conf-descendant-output} implies that $\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed} \preceq b_c$.
    \end{description}
\end{description}

\end{proof}
\begin{lemma}\label{lem:bcand-prev-epoch-vs-at-least-e-2}
    Pick any $b_c \in  \varforvalattime[val=v,time=\slotstart(\slot(t))]{\bcands}$.
    If
    \begin{enumerate}
        \item $\epoch(b_c) = \epoch(t)-1$
    \end{enumerate},
    then, there exists an honest validator $v'$ such that
    \begin{enumerate}
        \item $\exists b' \in \left(\viewattime[time=\votingtime(\slot(t)-1),val=v'] \cap \viewattime[time=\slotstart(\slot(t)),val=v']\right), b' \succeq b_c \land \epoch(\votsource[blck=b',time=\slotstartslot{t}])\geq \epoch(t)-2$
    \end{enumerate}
\end{lemma}

\begin{proof}
    By induction on $\slot(t)$.
    Let $s := \slot(t)$.
    \begin{description}
        \item[Base Case: {$s = \slot(\varforvalattime[val=v]{\tinit})$}.] The Lemma is vacuously true.
        \item[Inductive Case: {$s \geq \slot(\varforvalattime[val=v]{\tinit})$}.] We assume that the Lemma holds for $s$ and prove that it also holds for $s+1$.
        Pick any $b_c \in \varforvalattime[val=v,time=\slotstart(s+1)]{\bcands}$ such that $\epoch(b_c) \geq \epoch(s+1)-1$.
        % We also assume that $\epoch(b_c) \geq \epoch(s+1)-1$ as the Lemma holds vacuously otherwise.
        \begin{description}
            \item[Case 1: {$\epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}) < \epoch(s+1)-1$}.] Apply  \Cref{lem:when-restarting-vs-from-prev-epoch}.
            \item[Case 2: {$\epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}) \geq \epoch(s+1)-1$}.]
            % To prove the Lemma is sufficient 
            By sub cases.
            \begin{description}
                \item[Case 2.1: {$b_c = \varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}$}.] 
                By sub cases again.
                \begin{description}
                    \item[Case 2.1.1: $\epoch(s+1) = \epoch(s).$] 
                    Given that $\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed} \in \varforvalattime[val=v,time=\slotstart(s)]{\bcands}$,
                    we can apply the inductive hypothesis to conclude that there exists an honest validator $v'$ such that $\exists b' \in \left(\viewattime[time=\slotstart(s-1),val=v'] \cap \viewattime[time=\slotstart(s),val=v]\right), b' \succeq b_c \land \epoch(\votsource[blck=b',time=\slotstart(s)])\geq \epoch(s)-2 = \epoch(s+1)-2$.
                    So, given that $\viewattime[time=\slotstart(s-1),val=v'] \subseteq \viewattime[time=\slotstart(s),val=v']$ and $\viewattime[time=\slotstart(s),val=v] \subseteq \viewattime[time=\slotstart(s+1),val=v]$, the proof for this case is concluded.
                    \item[Case 2.1.2: $\epoch(s+1) = \epoch(s) + 1.$]
                    This Case implies that $\epoch(b_c) = \epoch(s)$ as 
                    $\epoch(s) = \epoch(s+1) -1 \leq \epoch(b_c) < \epoch(s+1) = \epoch(s) + 1$.
                    Note also that  $\epoch(s+1) = \epoch(s) + 1$ implies that $s+1 = \firstslot(\epoch(s+1))$.
                    All of this together with  \Cref{lem:conf-current-epoch-then-gu-curr-epoch} implies that $\exists b' \in \viewattime[time=\slotstart(s),val=v] \subseteq \viewattime[time=\slotstart(s+1),val=v], b' \succeq b_c \land \epoch(\votsource[blck=b',time=\slotstart(s+1)])\geq \epoch(\gu(b')) \geq \epoch(s)-1\geq\epoch(s+1)-2$.
                \end{description}
                \item[Case 2.2: {$b_c \neq \varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}$}.]
                Now by cases on the first line, in order of execution of the Fast Confirmation Rule algorithm at time $\slotstart(s+1)$, where $\bcand = b_c$. 
                \begin{description}
                    \item[\Cref{ln:set-bcand-beginning-of-get-latest-confirmed}.] 
                    Impossible, as at this line $\bcand = b_c$, but $b_c \neq \varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}$.
                    \item[\Cref{ln:set-bcand-to-fin}.] Impossible, as at this line $\epoch(\bcand) < \epoch(s+1)-1$, but we assume $\epoch(b_c) \geq \epoch(s+1)-1$.
                    \item[\Cref{ln:set-bcan-on-start-conf-chain}.] Obvious. \RSfn{Perhaps explain a bit more why in the future.} 
                    \item[\Cref{ln:set-bcand-to-output-find-latest}.]
                    The Lemma's statement implies $\epoch(b_c) = \epoch(s+1) - 1$. Then apply \Cref{lem:output-find-latest-different-to-input}.
                \end{description}
            \end{description}
        \end{description}
    \end{description}
\end{proof}

\begin{lemma}\label{lem:bconfirmed-at-first-slot-is-from-e-1}
    Pick any $b_c \in \varforvalattime[val=v,time=\slotstart(\slot(t))]{\bcands}$.
    If
    \begin{enumerate}
        \item $\epoch(b_c) \geq \epoch(t)-1$
    \end{enumerate},
    then,
    \begin{enumerate}
        \item $\epoch(\varforvalattime[val=v,time=\slotstart(\epoch(t))]{\bconfirmed}) = \epoch(t)-1$.
    \end{enumerate}
\end{lemma}

\begin{proof}
    Let $s := \slot(t)$.
    We know that honest validators do not vote for blocks from the future slots which implies an impossibility of $\epoch(b_c) > \epoch(t)-1$ for any $b_c \in \varforvalattime[val=v,time=\slotstart(s)]{\bcands}$ if $s=\firstslot(\epoch(t))$.
    By cases.
    \begin{description}
        \item[Case 1: {$s = \firstslot(\epoch(t))$}.]
        From the Lemma's condition and the above impossibility we know that $\epoch(b_c) = \epoch(t)-1$ in this case.
        Then the fact that $\varforvalattime[val=v,time=\slotstartslot{t})]{\bconfirmed} \in \varforvalattime[val=v,time=\slotstartslot{t})]{\bcands}$ concludes the proof.
        \item[Case 2: {$s \neq \firstslot(\epoch(t))$}.] Implies $s > \firstslot(\epoch(t))$.
        By contradiction.
        Suppose $\epoch(\varforvalattime[val=v,time=\slotstart(\epoch(t))]{\bconfirmed}) < \epoch(t)-1$.
        Then consider a slot $s' \geq s$ to be the lowest slot in $\epoch(t)$ for which $\epoch(b') \geq \epoch(t)-1$ for any $b' \in \varforvalattime[val=v,time=\slotstart(s')]{\bcands}$.
        Now by cases on the first line, in order of execution of the Fast Confirmation Rule algorithm at time $\slotstart(s')$, where $\epoch(\bcand) \geq \epoch(t)-1$. 
        \begin{description}
            \item[\Cref{ln:set-bcand-beginning-of-get-latest-confirmed}.] 
            Impossible, as at this line $\bcand = \varforvalattime[val=v,time=\slotstart(s'-1)]{\bconfirmed}$ but $s'$ is the lowest slot for which $\epoch(b_c) \geq \epoch(t)-1$.
            \item[\Cref{ln:set-bcand-to-fin}.] Impossible, as at this line $\epoch(\bcand) = \epoch(\block(\gfattime[val=v,time=\slotstart(s')])) < \epoch(t)-1$.
            \item[\Cref{ln:set-bcan-on-start-conf-chain}.] Impossible, as $s' \geq s > \firstslot(\epoch(t))$.
            \item[\Cref{ln:set-bcand-to-output-find-latest}.] Impossible, as this line can only be executed if a previous line set $\bcand$ to a value such that $\epoch(\bcand) \geq \epoch(t)-1$. However, this  is impossible as we assume that this is the first line where this happens.
        \end{description}
        Due to the fact that we have reached impossiblity in any of the above cases the proof is concluded.
    \end{description}
\end{proof}

\begin{lemma}\label{lem:exists-b-vs-at-least-e-2}
    Pick any $b_c \in \varforvalattime[val=v,time=\slotstart(\slot(t))]{\bcands}$.
    If
    \begin{enumerate}
        \item $\lastslot(\epoch(t)-1) \geq \GST$
        \item $\epoch(b_c) \geq \epoch(t)-1$
    \end{enumerate},
    then for any honest validator $v'$,
    \begin{enumerate}
        \item $\exists b' \in \viewattime[val=v',time=\slotstart(\epoch(t))]$ such that $\votsource[blck=b',time=\epoch(t)] \geq \epoch(t)-2$.
    \end{enumerate}
\end{lemma}

\begin{proof}
    Due to \Cref{lem:bconfirmed-at-first-slot-is-from-e-1} we know that $\exists b_c \in \varforvalattime[val=v,time=\slotstart(\epoch(t))]{\bcands}$ such that $\epoch(b_c) = \epoch(t)-1$.
    Then by \Cref{lem:bcand-prev-epoch-vs-at-least-e-2} we know that there exists an honest validator $v^h$ for which $\exists b' \in \viewattime[time=\votingtime(\lastslot(\epoch(t)-1)),val=v^h]$ such that $\epoch(\votsource[blck=b',time=\epoch(t)]) \geq \epoch(t)-2$.
    This together with the synchrony assumption concludes the proof.
\end{proof}

\begin{lemma}\label{lem:gj-at-least-e-2-alt}
    Pick any $b_c \in  \varforvalattime[val=v,time=\slotstart(\slot(t))]{\bcands}$, any time $t' \geq \slotstart(\epoch(t))$ and any honest validator $v'$.
    If
    \begin{enumerate}
        \item $\slotstart(\lastslot(\epoch(t)-1)) \geq \GST$
        \item $\epoch(b_c) \geq \epoch(t)-1$
    \end{enumerate},
    then,
    \begin{enumerate}
        \item $\epoch(\gjattime[val=v',time=t']) \geq \epoch(t)-2$.
    \end{enumerate}
\end{lemma}

\begin{proof}
    Due to \Cref{lem:exists-b-vs-at-least-e-2}, Definition 3 of the Paper and the monotonicity property of the greatest justified checkpoint.
\end{proof}

\begin{lemma}%[Replacement for \Cref{lem:conf-prev-epoch-then-vs-two-epochs-ago-old}]
    \label{lem:conf-prev-epoch-then-vs-two-epochs-ago}
     \label{lem:vs-at-least-e-2}
    Pick any $b_c \in  \varforvalattime[val=v,time=\slotstart(\slot(t))]{\bcands}$.
    If
    \begin{enumerate}
        \item $\slotstart(\lastslot(\epoch(t)-1)) \geq \GST$
        \item $\epoch(b_c) \geq \epoch(t)-1$
    \end{enumerate},
    then, there exists an honest validator $v'$ such that
    \begin{enumerate}
        \item $\exists b' \in \left(\viewattime[time=\votingtime(\slot(t)-1),val=v'] \cap \viewattime[time=\slotstart(\slot(t)),val=v]\right), b' \succeq b_c \land \epoch(\votsource[blck=b',time=\slotstartslot{t}])\geq \epoch(t)-2$
        % \item $\banchor^{v,\slotstart(\slot(t))} \succeq GJ^{v,t}$
    \end{enumerate}
\end{lemma}

\begin{proof}
    Let $s := \slot(t)$.
    \begin{description}
        \item[Case 1: {$\epoch(b_c) = \epoch(s)-1$}.] Apply \Cref{lem:bcand-prev-epoch-vs-at-least-e-2}.
        \item[Case 2: {$\epoch(b_c) \neq \epoch(s)-1$}.] The Lemma's statement implies $\epoch(b_c) = \epoch(s)$ for this case.
        Due to \Cref{ln:if-is-one-confirmed-second-loop,set-btcand-to-btemp}, $\isOneConfirmed(b_c, \cdot)$ which implies\MKfn{We probably should have a Lemma proving such an implication} that there exists an honest validator $v^h$ such that
        $b_c \preceq \LMDGHOSTHFC(\viewattime[val=v^h,time=\votingtime(s')])$ for $s'<s$ which implies $b_c \in \filtered[val=v^h,time=\votingtime(s')]$ . Given that $\epoch(b_c) = \epoch(s)$ and the fact that honest validators never vote for blocks from the future slots, we conclude that $\epoch(s') = \epoch(s)$.
        Then due to \Cref{lem:gj-at-least-e-2-alt} we know that $\epoch(\gjattime[val=v^h,time=\votingtime(s')]) \geq \epoch(s)-2$.
        Given that $b_c \in \filtered[val=v^h,time=\votingtime(s')]$, it must be true that $\exists b' \in \viewattime[val=v^h,time=\votingtime(s')]$ such that $b' \succeq b_c$ and one of the following conditions hold:
        \begin{enumerate}
            \item $\epoch(\votsource[blck=b',time=\slotstart(s)]) = \epoch(\gjattime[val=v^h,time=\votingtime(s')]) \geq \epoch(s)-2$
            \item $\epoch(\votsource[blck=b',time=\slotstart(s)]) \geq \epoch(s)-2$
        \end{enumerate}
        In either case $\epoch(\votsource[blck=b',time=\slotstart(s)]) \geq \epoch(s)-2$.
        Then the fact that $\viewattime[val=v^h,time=\votingtime(s')] \subseteq \viewattime[val=v^h,time=\votingtime(s-1)] \subseteq \viewattime[val=v^h, time=\slotstart(s)]$ concludes the proof.
    \end{description}
\end{proof}

% \begin{lemma}%[Replacement for \Cref{lem:conf-prev-epoch-then-vs-two-epochs-ago-old}]
%     \label{lem:conf-prev-epoch-then-vs-two-epochs-ago}
%      \label{lem:vs-at-least-e-2}
%     Pick any $b_c \in  \varforvalattime[val=v,time=\slotstart(\slot(t))]{\bcands}$.
%     If
%     \begin{enumerate}
%         \item $\epoch(b_c) \geq \epoch(t)-1$
%         % \item $\varforvalattime[val=v,time=\slotstart()]{}
%     \end{enumerate},
%     then, 
%     \begin{enumerate}
%         \item $\exists b' \in \viewattime[time=\slotstart(\slot(t)),val=v], b' \succeq  b_c \land \epoch(\votsource[blck=b',time=\slotstartslot{t}])\geq \epoch(t)-2$
%         % \item $\banchor^{v,\slotstart(\slot(t))} \succeq GJ^{v,t}$
%     \end{enumerate}
% \end{lemma}

% \begin{proof}
%     By induction on $\slot(t)$.
%     Let $s := \slot(t)$.
%     \begin{description}
%         \item[Base Case: {$s = \slot(\varforvalattime[val=v]{\tinit})$}.] The Lemma is vacuously true.
%         \item[Inductive Case: {$s \geq \slot(\varforvalattime[val=v]{\tinit})$}.] We assume that the Lemma holds for $s$ and prove that it also holds for $s+1$.
%         We also assume that $\epoch(b_c) \geq \epoch(s+1)-1$ as the Lemma holds vacuously otherwise.
%         \begin{description}
%             \item[Case 1: {$\epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}) < \epoch(s+1)-1$}.] Apply  \Cref{lem:when-restarting-vs-from-prev-epoch}.
%             \item[Case 2: {$\epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}) \geq \epoch(s+1)-1$}.]
%             % To prove the Lemma is sufficient 
%             By sub cases.
%             \begin{description}
%                 \item[Case 2.1: {$b_c = \varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}$}.] 
%                 By sub cases again.
%                 \begin{description}
%                     \item[Case 2.1.1: $\epoch(s+1) = \epoch(s).$] 
%                     Given that $\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed} \in \varforvalattime[val=v,time=\slotstart(s)]{\bcands}$,
%                     we can apply the inductive hypothesis to conclude that  $\exists b' \in \viewattime[time=\slotstart(s),val=v], b' \succeq b_c \land \epoch(\votsource[blck=b',time=\slotstart(s)])\geq \epoch(s)-2 = \epoch(s+1)-2$.
%                     So, given that $\viewattime[time=\slotstart(s),val=v'] \subseteq \viewattime[time=\slotstart(s+1),val=v']$, the proof for this case is concluded.
%                     \item[Case 2.1.2: $\epoch(s+1) = \epoch(s) + 1.$]
%                     This Case implies that $\epoch(b_c) = \epoch(s)$ as 
%                     $\epoch(s) = \epoch(s+1) -1 \leq \epoch(b_c) < \epoch(s+1) = \epoch(s) + 1$.
%                     Note also that  $\epoch(s+1) = \epoch(s) + 1$ implies that $s+1 = \firstslot(\epoch(s+1))$.
%                     All of this together with  \Cref{lem:conf-current-epoch-then-gu-curr-epoch} implies that $\exists b' \in \viewattime[time=\slotstart(s),val=v] \subseteq \viewattime[time=\slotstart(s+1),val=v], \epoch(\votsource[blck=b',time=\slotstart(s+1)])\geq \epoch(\gu(b')) \geq \epoch(s)-1\geq\epoch(s+1)-2$.
%                 \end{description}
%                 \item[Case 2.2: {$b_c \neq \varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}$}.]
%                 Now by cases on the first line, in order of execution of the Fast Confirmation Rule algorithm at time $\slotstart(s+1)$, where $\bcand = b_c$. 
%                 \begin{description}
%                     \item[\Cref{ln:set-bcand-beginning-of-get-latest-confirmed}.] 
%                     Impossible, as at this line $\bcand = b_c$, but $b_c \neq \varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}$.
%                     \item[\Cref{ln:set-bcand-to-fin}.] Impossible, as at this line $\epoch(\bcand) < \epoch(s+1)-1$, but we assume $\epoch(b_c) \geq \epoch(s+1)-1$.
%                     \item[\Cref{ln:set-bcan-on-start-conf-chain}.] Obvious. \RSfn{Perhaps explain a bit more why in the future.} 
%                     \item[\Cref{ln:set-bcand-to-output-find-latest}.] Obvious from \Cref{lem:output-find-latest-different-to-input}.
%                 \end{description}
%             \end{description}
%         \end{description}
%     \end{description}
% \end{proof}


% \begin{lemma}%[Replacement for \Cref{lem:conf-prev-epoch-then-vs-two-epochs-ago-old}]
%     %\label{lem:conf-prev-epoch-then-vs-two-epochs-ago}
%     If
%     \begin{enumerate}
%         \item $\epoch(\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}) \geq \epoch(t)-1$
%     \end{enumerate},
%     then, there exists an honest validator $v'$ such taht
%     \begin{enumerate}
%         \item $\exists b' \in \viewattime[time=\slotstart(\slot(t)-1),val=v'], b' \succeq  \bconfirmed[val=v,time=\slotstart(\slot(t))] \land \epoch(\votsource[blck=b',time=\slotstartslot{t}])\geq \epoch(t)-2$
%         % \item $\banchor^{v,\slotstart(\slot(t))} \succeq GJ^{v,t}$
%     \end{enumerate}
% \end{lemma}

% \begin{proof}
%     By induction on $\slot(t)$.
%     Let $s := \slot(t)$.
%     \begin{description}
%         \item[Base Case: {$s = \slot(\varforvalattime[val=v]{\tinit})$}.] The Lemma is vacuously true.
%         \item[Inductive Case: {$s \geq \slot(\varforvalattime[val=v]{\tinit})$}.] We assume that the Lemma holds for $s$ and prove that it also holds for $s+1$.
%         We also assume that $\epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}) \geq \epoch(s+1)-1$ as the Lemma holds vacuously otherwise.
%         % This implies that $\epoch(s+1) = \epoch(s)$ as, otherwise, it would mean that we are the beginning of epoch $\epoch(s)+1$ and, therefore, it cannot be that $\epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}) = \epoch(s+1)$ reaching a contradiction.
%         \begin{description}
%             \item[{Case 1: $\epoch(\varforvalattime[val=v,time=\slotstart(s-1)]{\bconfirmed}) < \epoch(s)-1$}.] Follows from \Cref{lem:when-restarting-vs-from-prev-epoch}.
%             \item[{Case 2: $\epoch(\varforvalattime[val=v,time=\slotstart(s-1)]{\bconfirmed}) \geq \epoch(s)-1$}] 
%             By the inductive hypothesis, we know that there exists an honest validator $v'$ such that $\exists b' \in \viewattime[time=\slotstart(s-1),val=v'], b' \succeq \varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed} \land \epoch(\votsource[blck=b',time=\slotstart(s)])\geq \epoch(s)-2$.
%             Clearly $b' \in \viewattime[time=\slotstart(s),val=v']$.
%             By cases again
%             \begin{description}
%                 \item[Case 2.1: $\epoch(s+1) = \epoch(s)$.]  Then $\epoch(\votsource[blck=b',time=\slotstart(s+1)])\geq\epoch(\votsource[blck=b',time=\slotstart(s)])\geq \epoch(s)-2 = \epoch(s+1)-2$.
%                 \item[Case 2.2: $\epoch(s+1) = \epoch(s) + 1$.] From our assumption above, $\epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}) \geq \epoch(s+1)-1 = \epoch(s)$.
%                 Given that $\epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}) \leq \epoch(s)$, we can conclude that $\epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed})= \epoch(s)$.
%                 Note also that  $\epoch(s+1) = \epoch(s) + 1$ implies that $s+1 = \firstslot(\epoch(s+1))$.
%                 All of this together with  \Cref{lem:conf-current-epoch-then-gu-curr-epoch} implies that $\exists b' \in \viewattime[time=\slotstart(s-1),val=v], \epoch(\votsource[blck=b',time=\slotstart(s)])\geq \epoch(s)-1\geq\epoch(s+1)-2$.
%             \end{description}
%         \end{description}
%     \end{description}
% \end{proof}

% \begin{proof}
%     By induction on $\slot(t)$.
%     Let $s := \slot(t)$.
%     \begin{description}
%         \item[Base Case: {$s = \slot(\varforvalattime[val=v]{\tinit})$}.] The Lemma is vacuously true.
%         \item[Inductive Case: {$s \geq \slot(\varforvalattime[val=v]{\tinit})$}.] We assume that the Lemma holds for $s$ and prove that it also holds for $s+1$.
%         We also assume that $\epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}) \geq \epoch(s+1)-1$ as the Lemma holds vacuously otherwise.
%         % This implies that $\epoch(s+1) = \epoch(s)$ as, otherwise, it would mean that we are the beginning of epoch $\epoch(s)+1$ and, therefore, it cannot be that $\epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}) = \epoch(s+1)$ reaching a contradiction.
%         \begin{description}
%             \item[{Case 1: $\epoch(\varforvalattime[val=v,time=\slotstart(s-1)]{\bconfirmed}) < \epoch(s)-1$}.] Follows from \Cref{lem:when-restarting-vs-from-prev-epoch}.
%             \item[{Case 2: $\epoch(\varforvalattime[val=v,time=\slotstart(s-1)]{\bconfirmed}) \geq \epoch(s)-1$}] 
%             By the inductive hypothesis, we know that $\exists b' \in \viewattime[time=\slotstart(s-1),val=v], \epoch(\votsource[blck=b',time=\slotstart(s)])\geq \epoch(s)-2$.
%             By cases again
%             \begin{description}
%                 \item[Case 2.1: $\epoch(s+1) = \epoch(s)$.]  Then $\epoch(\votsource[blck=b',time=\slotstart(s+1)])\geq\epoch(\votsource[blck=b',time=\slotstart(s)])\geq \epoch(s)-2 = \epoch(s+1)-2$.
%                 \item[Case 2.2: $\epoch(s+1) = \epoch(s) + 1$.] From our assumption above, $\epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}) \geq \epoch(s+1)-1 = \epoch(s)$.
%                 Given that $\epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}) \leq \epoch(s)$, we can conclude that $\epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed})= \epoch(s)$.
%                 Note also that  $\epoch(s+1) = \epoch(s) + 1$ implies that $s+1 = \firstslot(\epoch(s+1))$.
%                 All of this together with  \Cref{lem:conf-current-epoch-then-gu-curr-epoch} implies that $\exists b' \in \viewattime[time=\slotstart(s-1),val=v], \epoch(\votsource[blck=b',time=\slotstart(s)])\geq \epoch(s)-1\geq\epoch(s+1)-2$.
%             \end{description}
%         \end{description}
%     \end{description}
% \end{proof}

% \begin{lemma}\label{lem:conf-prev-epoch-then-gj-two-epochs-ago}
%     If
%     \begin{enumerate}
%         \item $\epoch(\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}) \geq \epoch(t)-1$
%     \end{enumerate},
%     then
%     \begin{enumerate}
%         \item $\epoch(\gjattime[val=v,time=\slotstart(\slot(t))]) \geq \epoch(t)-2$
%         % \item $\banchor^{v,\slotstart(\slot(t))} \succeq GJ^{v,t}$
%     \end{enumerate}
% \end{lemma}

% \begin{proof}
%     By induction on $\slot(t)$.
%     Let $s := \slot(t)$.
%     \begin{description}
%         \item[Base Case: {$s = \slot(\varforvalattime[val=v]{\tinit})$}.] The Lemma is vacuously true.
%         \item[Inductive Case: {$s \geq \slot(\varforvalattime[val=v]{\tinit})$}.] We assume that the Lemma holds for $s$ and prove that it also holds for $s+1$.
%         We also assume that $\epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}) \geq \epoch(s+1)-1$ as the Lemma holds vacuously otherwise.
%         % This implies that $\epoch(s+1) = \epoch(s)$ as, otherwise, it would mean that we are the beginning of epoch $\epoch(s)+1$ and, therefore, it cannot be that $\epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}) = \epoch(s+1)$ reaching a contradiction.
%         \begin{description}
%             \item[{Case 1: $\epoch(\varforvalattime[val=v,time=\slotstart(s-1)]{\bconfirmed}) < \epoch(s)-1$}.] Given that we assume that $\epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed} ) \geq \epoch(s)-1$, it must be that we restart ``confirmation chain'' at time $\slotstart(s)$. 
%             Therefore $s = \firstslot(\epoch(s))$ and we know that $\epoch(\gjattime[time=\slotstart(s),val=v])=\epoch(s)-1$.
%             This means that we know $\epoch(\gjattime[time=\slotstart(s+1),val=v])\geq\epoch(\gjattime[time=\slotstart(s),val=v])\geq\epoch(s)-1=\epoch(s+1)-1$.
%             \item[{Case 2: $\epoch(\varforvalattime[val=v,time=\slotstart(s-1)]{\bconfirmed}) \geq \epoch(s)-1$}] 
%             By the induction hypothesis, we know that $\epoch(\gjattime[time=\slotstart(s),val=v]) \geq \epoch(s)-2$.
%             By cases again
%             \begin{description}
%                 \item[Case 2.1: $\epoch(s+1) = \epoch(s)$.]  Then $\epoch(\gjattime[time=\slotstart(s+1),val=v])\geq\epoch(\gjattime[time=\slotstart(s),val=v])\geq \epoch(s)-2 = \epoch(s+1)-2$.
%                 \item[Case 2.2: $\epoch(s+1) = \epoch(s) + 1$.] From our assumption above, $\epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}) \geq \epoch(s+1)-1 = \epoch(s)$.
%                 Given that $\epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}) \leq \epoch(s)$, we can conclude that $\epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed})= \epoch(s)$.
%                 Note also that  $\epoch(s+1) = \epoch(s) + 1$ implies that $s+1 = \firstslot(\epoch(s+1))$.
%                 All of this together with  \Cref{lem:current-epoch-then-gu-curr-epoch} implies that $\epoch(\gjattime[val=v,time=\slotstart(s+1)]) \geq \epoch(s)-1 = \epoch(s+1)-2$.
%             \end{description}
%         \end{description}
%     \end{description}
% \end{proof}

% \begin{proof}(Sketch)
%     By induction on $\slot(t)$.
%     Let $s := \slot(t)$.
%     \begin{description}
%         \item[{Base Case: $\varforvalattime[val=v,time=\slotstart(s-1)]{\bconfirmed} = \block(\gfattime[time=\slotstart(s-1),val=v])$.}] Clearly, $\epoch(\varforvalattime[val=v,time=\slotstart(s-1)]{\bconfirmed} ) < \epoch(t) -1$. Assume then that $\epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed} ) \geq \epoch(t)-1$.
%         This means that we restart the confirmation chain, which means that we know that $\epoch(\gjattime[time=\slotstart(s+1),val=v])=\epoch(t)=\epoch(s+1)-1$.
%         \item[Inductive Case.] 
%         We assume the Lemma holds for slot $s$ and prove that it also holds for slot $s+1$.
%         We also assume $\epoch(\varforvalattime[val=v,time=\slotstart(s+1)]{\bconfirmed}) \geq \epoch(s+1)-1$  as the Lemma holds vacuously otherwise. 
%         Now, by cases.
%         \begin{description}
%             \item[{Case 1: $\epoch(\varforvalattime[val=v,time=\slotstart(s-1)]{\bconfirmed}) < \epoch(s)-1$}] Same reasoning as for the base case.
%             \item[{Case 2: $\epoch(\varforvalattime[val=v,time=\slotstart(s-1)]{\bconfirmed}) \geq \epoch(s)-1$}] 
%             By the induction hypothesis, we know that $\epoch(\gjattime[time=\slotstart(s),val=v]) \geq \epoch(s)-2$.
%             By cases again
%             \begin{description}
%                 \item[Case 2.1: $\epoch(s+1) = \epoch(s)$.]  Then $\epoch(\gjattime[time=\slotstart(s+1),val=v])\geq\epoch(\gjattime[time=\slotstart(s),val=v])\geq \epoch(s)-2 = \epoch(s+1)-2$.
%                 \item[Case 2.2: $\epoch(s+1) = \epoch(s) + 1$.] This implies that  $\epoch(\varforvalattime[val=v,time=\slotstart(s+1)]{\bconfirmed}) = \epoch(s)$ as we are at the beginning of epoch $\epoch(s+1)$ so we cannot confirm any block from epoch $\epoch(s+1)$.
%             \end{description}
%         \end{description}
%     \end{description}
%     We prove the following equivalent statement inductively.
%     If $\epoch(\varforvalattime[val=v,time=\slotstartslot{t}]{\isOneConfirmed}) \geq \epoch(s+1)-1$,
%     then $\epoch(\gjattime[val=v,time=\slotstart(s+1)]) \geq \epoch(s+1)-2$.

% \end{proof}

% \begin{lemma}\label{lem:vs-at-least-e-2-old}
%     If
%     \begin{enumerate}
%         \item $\epoch(\varforvalattime[val=v,time=\slotstartslot{t}]{\bcand}) \geq \epoch(t)-1$
%     \end{enumerate},
%     then
%     \begin{enumerate}
%         \item $\exists b' \in \viewattime[time=\slotstart(\slot(t)-1),val=v], \epoch(\votsource[blck=b',time=\slotstartslot{t}])\geq \epoch(t)-2$
%         % \item $\banchor^{v,\slotstart(\slot(t))} \succeq GJ^{v,t}$
%     \end{enumerate}
% \end{lemma}


% \begin{lemma}%[Replacement of \Cref{lem:vs-at-least-e-2-old}]
%     \label{lem:vs-at-least-e-2}
%     If
%     \begin{enumerate}
%         \item $\epoch(\varforvalattime[val=v,time=\slotstartslot{t}]{\bcand}) \geq \epoch(t)-1$
%     \end{enumerate},
%     then
%     \begin{enumerate}
%         \item $\exists b' \in \viewattime[time=\slotstart(\slot(t)-1),val=v], b' \succeq \varforvalattime[val=v,time=\slotstartslot{t}]{\bcand} \land \epoch(\votsource[blck=b',time=\slotstartslot{t}])\geq \epoch(t)-2$
%         % \item $\banchor^{v,\slotstart(\slot(t))} \succeq GJ^{v,t}$
%     \end{enumerate}
% \end{lemma}

% \begin{proof}
%     TBD
% \end{proof}


% \begin{proof}
% By cases.
% \begin{description}
%     \item[Case 1: {$\epoch(\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}) \geq \epoch(s)-1$}.] Follows from \Cref{lem:conf-prev-epoch-then-vs-two-epochs-ago}.
%     \item[Case 2: {$\epoch(\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}) < \epoch(s)-1$}.] 
%     From $\epoch(\varforvalattime[val=v,time=\slotstartslot{t}]{\bcand}) \geq \epoch(t)-1$, we can conclude that  $\epoch(\varforvalattime[val=v,time=\slotstartslot{t}]{\bconfirmed}) \geq \epoch(t)-1$.
%     Then, apply \Cref{lem:when-restarting-vs-from-prev-epoch}.
% \end{description}
% \end{proof}

% \begin{lemma}
%     Let $\varforvalattime[val=v,time=\slotstartslot{t}]{\bcand}$ be any of the possible values assumed by $\bcand$ during the execution of \Cref{alg:conffull} by validator $v$ at time $\slotstartslot{t}$
%     If
%     \begin{enumerate}
%         \item $\epoch(\varforvalattime[val=v,time=\slotstartslot{t}]{\bcand}) \geq \epoch(t)-1$
%     \end{enumerate},
%     then
%     \begin{enumerate}
%         \item $\epoch(\gjattime[val=v,time=\slotstart(\slot(t))]) \geq \epoch(t)-2$
%         % \item $\banchor^{v,\slotstart(\slot(t))} \succeq GJ^{v,t}$
%     \end{enumerate}
% \end{lemma}

% \begin{proof}(Sketch)
% \begin{description}
%     \item[Case 1: {$\epoch(\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}) \geq \epoch(s)-1$}.] Follows from \Cref{lem:conf-prev-epoch-then-gj-two-epochs-ago}.
%     \item[Case 2: {$\epoch(\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}) < \epoch(s)-1$}.] 
%     Assume that  $\epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed} ) \geq \epoch(s)-1$ as, otherwise, the Lemma holds vacuously.
%     Then, it must be that we restart ``confirmation chain'' at time $\slotstart(s)$. 
%     Therefore $s = \firstslot(\epoch(s))$ and we know that $\epoch(\gjattime[time=\slotstart(s),val=v])=\epoch(s)-1$.
% \end{description}
% \end{proof}

% \begin{lemma}\label{lem:no-conflict-chkp-is-justified}
%     % Take an honest validator $v$ and a time $t$.
%     Pick any $b_c \in  \varforvalattime[val=v,time=\slotstart(\slot(t))]{\bcands}$.
%     If
%     \begin{enumerate}
%         % \item $\slotstart(\epoch(t)-1) \geq \GST$
%         \item $\epoch(b_c) \geq \epoch(t) - 1$
%     \end{enumerate},
%     then at least one of the following statements hold:
%     \begin{enumerate}
%         \item $\gjattime[time=\slotstartslot{t},val=v] = \chkp(b_c)$
%         \item there exists a time $t' \leq t$ such that
%         \begin{enumerate}
%             \item $t' = \slotstartslot{t'}$
%             \item $\epoch(t') = \epoch(b_c)$
%             \item $\varforvalattime[val=v,time=t']{\willChkpBeJustified}(\chkp(b_c))$
%         \end{enumerate}
%     \end{enumerate}
% \end{lemma}

% \begin{proof}(by Roberto)
%     By induction on $\slot(t)$.
%     Let $s := \slot(t)$.
%     \begin{description}
%         \item[Base Case: {$s = \slot(\varforvalattime[val=v]{\tinit})$}.] The Lemma is vacuously true.
%         \item[Inductive Case: {$s \geq \slot(\varforvalattime[val=v]{\tinit})$}.]
%             We assume that the Lemma holds for $s$ and prove that it also holds for $s+1$.
%         \begin{description}
%             \item[{Case 1: $\epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}) < \epoch(s+1) - 1$}.]
%                 We assume condition at \Cref{ln:start-conf-chain} holds, otherwise,
%                 $\varforvalattime[val=v,time=\slotstartslot{s+1}]{\bcand} < \epoch(s+1) - 1$ and the Lemma is vacuously true.
%                 That condition implies $\gjattime[val=v,time=\slotstart(s+1)] = \guattime[val=v,time=\slotstart(s)]$,
%                 $\varforvalattime[val=v,time=\slotstart(s+1)]{\bcand} \succeq \block(\guattime[val=v,time=\slotstart(s)]) = \block(\gjattime[val=v,time=\slotstart(s+1)])$,
%                 $\epoch(\varforvalattime[val=v,time=\slotstart(s+1)]{\bcand}) = \epoch(s+1)-1$.
%                 Thus, $\gjattime[val=v,time=\slotstart(s+1)] = \chkp(\varforvalattime[val=v,time=\slotstart(s+1)]{\bcand},\epoch(s+1)-1)$
%                 concluding Statement 1 of the Lemma.
%             \item[Case 2: {$\epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}) \geq \epoch(s+1) - 1$}.]
%             Clearly $\epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}) \geq \epoch(s) - 1$, so the inductive hypothesis holds non-vacuously for $s$.
%             By sub-cases.
%             \begin{description} 
%                 \item[Case 2.1: {$\epoch(\varforvalattime[val=v,time=\slotstart(s+1)]{\bcand}) = \epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bcand})$}.] 
%                 This implies that $\chkp(\varforvalattime[val=v,time=\slotstart(s+1)]{\bcand}) = \chkp(\varforvalattime[val=v,time=\slotstart(s)]{\bcand})$.
%                 \sloppy{Note that if $\gjattime[time=\slotstartslot{t},val=v] = \chkp(\varforvalattime[val=v,time=\slotstartslot{t}]{\bcand})$, then $\varforvalattime[val=v,time=\slotstartslot{t}]{\willChkpBeJustified}(\chkp(\varforvalattime[val=v,time=\slotstartslot{t}]{\bcand}))$.}
%                 Then, the rest follows from the inductive hypothesis.
%                 \item[Case 2.2: {$\epoch(\varforvalattime[val=v,time=\slotstart(s+1)]{\bcand}) = \epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bcand}) + 1$}.] 
%                 Given that $\epoch(\varforvalattime[val=v,time=\slotstart(s+1)]{\bcand}) \leq \epoch(s+1)$, this implies that $\epoch(\varforvalattime[val=v,time=\slotstart(s+1)]{\bcand}) = \epoch(s+1)$.
%                 Then, it must be that the \KwSty{if} blocks at line 23 is executed proving the lemma.
%             \end{description}
%         \end{description}
%     \end{description}
% \end{proof}

% \begin{lemma}\label{lem:no-conflict-chkp-is-justified}
%     Take an honest validator $v$ and a time $t$.
%     If
%     \begin{enumerate}
%         % \item $\slotstart(\epoch(t)-1) \geq \GST$
%         \item $\epoch(\varforvalattime[val=v,time=\slotstartslot{t}]{\bcand}) \geq \epoch(t) - 1$
%     \end{enumerate},
%     then at least one of the following statements hold:
%     \begin{enumerate}
%         \item $\gjattime[time=\slotstartslot{t},val=v] = \chkp(\varforvalattime[val=v,time=\slotstartslot{t}]{\bcand})$
%         \item there exists a time $t' \leq t$ such that
%         \begin{enumerate}
%             \item $t' = \slotstartslot{t'}$
%             \item $\epoch(t') = \epoch(\varforvalattime[val=v,time=\slotstartslot{t}]{\bcand})$
%             \item $\varforvalattime[val=v,time=t']{\willChkpBeJustified}(\chkp(\varforvalattime[val=v,time=\slotstartslot{t}]{\bcand}))$
%         \end{enumerate}
%     \end{enumerate}
% \end{lemma}

% \begin{proof}(by Roberto)
%     By induction on $\slot(t)$.
%     Let $s := \slot(t)$.
%     \begin{description}
%         \item[Base Case: {$s = \slot(\varforvalattime[val=v]{\tinit})$}.] The Lemma is vacuously true.
%         \item[Inductive Case: {$s \geq \slot(\varforvalattime[val=v]{\tinit})$}.]
%             We assume that the Lemma holds for $s$ and prove that it also holds for $s+1$.
%         \begin{description}
%             \item[{Case 1: $\epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}) < \epoch(s+1) - 1$}.]
%                 We assume condition in line 14 of \Cref{alg:conffull} holds, otherwise,
%                 $\varforvalattime[val=v,time=\slotstartslot{s+1}]{\bcand} < \epoch(s+1) - 1$ and the Lemma is vacuously true.
%                 That condition implies $\gjattime[val=v,time=\slotstart(s+1)] = \guattime[val=v,time=\slotstart(s)]$,
%                 $\varforvalattime[val=v,time=\slotstart(s+1)]{\bcand} \succeq \block(\guattime[val=v,time=\slotstart(s)]) = \block(\gjattime[val=v,time=\slotstart(s+1)])$,
%                 $\epoch(\varforvalattime[val=v,time=\slotstart(s+1)]{\bcand}) = \epoch(s+1)-1$.
%                 Thus, $\gjattime[val=v,time=\slotstart(s+1)] = \chkp(\varforvalattime[val=v,time=\slotstart(s+1)]{\bcand},\epoch(s+1)-1)$
%                 concluding Statement 1 of the Lemma.
%             \item[Case 2: {$\epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}) \geq \epoch(s+1) - 1$}.]
%             Clearly $\epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}) \geq \epoch(s) - 1$, so the inductive hypothesis holds non-vacuously for $s$.
%             By sub-cases.
%             \begin{description} 
%                 \item[Case 2.1: {$\epoch(\varforvalattime[val=v,time=\slotstart(s+1)]{\bcand}) = \epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bcand})$}.] 
%                 This implies that $\chkp(\varforvalattime[val=v,time=\slotstart(s+1)]{\bcand}) = \chkp(\varforvalattime[val=v,time=\slotstart(s)]{\bcand})$.
%                 \sloppy{Note that if $\gjattime[time=\slotstartslot{t},val=v] = \chkp(\varforvalattime[val=v,time=\slotstartslot{t}]{\bcand})$, then $\varforvalattime[val=v,time=\slotstartslot{t}]{\willChkpBeJustified}(\chkp(\varforvalattime[val=v,time=\slotstartslot{t}]{\bcand}))$.}
%                 Then, the rest follows from the inductive hypothesis.
%                 \item[Case 2.2: {$\epoch(\varforvalattime[val=v,time=\slotstart(s+1)]{\bcand}) = \epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bcand}) + 1$}.] 
%                 Given that $\epoch(\varforvalattime[val=v,time=\slotstart(s+1)]{\bcand}) \leq \epoch(s+1)$, this implies that $\epoch(\varforvalattime[val=v,time=\slotstart(s+1)]{\bcand}) = \epoch(s+1)$.
%                 Then, it must be that the \KwSty{if} blocks at line 23 is executed proving the lemma.
%             \end{description}
%         \end{description}
%     \end{description}
% \end{proof}







\begin{lemma}\label{lem:no-curr-epochconflict-chkp-is-justified}
    Pick any $b_c \in  \varforvalattime[val=v,time=\slotstart(\slot(t))]{\bcands}$.
    % Take an honest validator $v$ and a time $t$.
    If
    \begin{enumerate}
        % \item $\slotstart(\epoch(t)-1) \geq \GST$
        \item $\epoch(b_c) = \epoch(t)$
    \end{enumerate},
    then,\
    \begin{enumerate}
        % \item $\gjattime[time=\slotstartslot{t},val=v] = \chkp(b_c,\epoch(t) - 1)$
        \item there exists a time $t' \leq t$ such that
        \begin{enumerate}
            \item $t' = \slotstartslot{t'}$
            \item $\epoch(t') = \epoch(t)$
            \item $\varforvalattime[val=v,time=t']{\willChkpBeJustified}(\chkp(b_c))$
        \end{enumerate}
    \end{enumerate}
\end{lemma}

\begin{proof}
    By induction on $\slot(t)$.
    Let $s := \slot(t)$.
    \begin{description}
        \item[Base Case: {$s = \slot(\varforvalattime[val=v]{\tinit})$}.] The Lemma is vacuously true.
        \item[Inductive Case: {$s \geq \slot(\varforvalattime[val=v]{\tinit})$}.]
            We assume that the Lemma holds for $s$ and prove that it also holds for $s+1$.
            Pick any $b_c \in \varforvalattime[val=v,time=\slotstart(s+1)]{\bcands}$ such that $\epoch(b_c) = \epoch(s+1)$.
            This implies $s+1 \neq \firstslot(\epoch(s+1))$ and therfore $\epoch(s) = \epoch(s+1)$.
            By cases.
            \begin{description}
                \item[Case 1: {$\epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}) = \epoch(s)$}.] 
                % This implies that $s \neq \firstslot(\epoch(s))$.
                \Cref{lem:prev-conf-at-least-e-1} implies that $\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed} \preceq \LMDGHOSTHFC(\viewattime[val=v,time=\slotstart(s+1)])$.
                This implies that $b_c \succeq \varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}$.
                Given that $\epoch(b_c) = \epoch(s) = \epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed})$, $\chkp(b_c) = \chkp(\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed})$.
                Then apply the inductive hypothesis.
                \item[Case 2: {$\epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}) < \epoch(s)$}.] 
                Given that $\epoch(b_c) = \epoch(s+1)$, condition at line \Cref{ln:check-will-chkp-be-justified} must be true for a $\btemp = b'$ such that $b' \preceq b_c \land \epoch(b') = \epoch(b_c)$.
                Hence, $\chkp(b') = \chkp(b_c)$.
                This implies that $\varforvalattime[val=v,time=\slotstart(s+1)]{\willChkpBeJustified}(\chkp(b_c))$.
            \end{description}
    \end{description}
\end{proof}


\begin{definition}[\LMDGHOST safety condition]
    The \LMDGHOST safety condition for block $b$ according to checkpoint $C$ and the view of validator $v$ at time $t\geq\GGST$ starting from block $b_mathsf{s}$, corresponds to the following condition, formally named $\varforvalattime[val=v]{\mathrm{isLMDGHOSTSafe}}(b,C,t)$.
    $$
\begin{aligned}
        \varforvalattime[val=v]{\mathrm{isLMDGHOSTSafeFrom}}(b,C,t,b_\mathsf{s}) := &b \succeq b_\mathsf{s} \land \\
        &\forall b',\; b_\mathsf{s} \preceq b' \preceq b \implies
                \indicatorfromblock[from=b',to=\slot(t)-1,val=v,when=t,chkp=C]{\indQ}
                >
                    \frac{1}{2}
                        \left( 1+
                            \frac
                            {\boostweight[chkp=C]}
                            {\commweightfromblock[from=b',to=\slot(t)-1,chkp=C,when=t,val=v]{\allvals}}
                        \right)
                    + \beta  
\end{aligned}   
                $$
\end{definition}

\begin{definition}[\safetyinductionrequirement{s}  for blocks $b$ and $b_\mathsf{s}$, time $t$ and checkpoint $C$ ]\label{def:induction-conditions}
    $\sir(b,t,C,b_\mathsf{s})$ is difined as the conjuction of $\sirone(b,t,C,b_\mathsf{s})$, $\sirtwo(b,t,\slotstart(\epoch(b)+2))$, $\sirthree(C,t,\slotstart(\epoch(b)+2))$, $\sirfour(b)$ and $\sirfive(b, \epoch(b),\epoch(b)+1)$ as defined below.
    \begin{enumerate}[label=SIR.\arabic*.,leftmargin=20ex,ref=SIR.\arabic*]
        \siritem{$(b,t,C,b_\mathsf{s})$}
        \label{def:induction-conditions:is-lmd-confirmed}  $\varforvalattime[val=v]{\mathit{isLMDGHOSTSafeFrom}}(b,C,t,b_\mathsf{s})  \land C \preceq b  \land \slotstart(\slot(t)-1)\geq \GGST$
        % \item\label{def:induction-conditions:gst}  $$
        % \item\label{def:induction-conditions:all-validators} for any honest validator $v'$ and time $t'$ such that $t \leq t' \leq \slotstart(\epoch(b)+2)$,
        % \begin{enumerate}[label=\theenumi.\arabic*.,leftmargin=10ex,ref=\theenumi.\arabic*]
            \siritem{$(b,t,t_\ell)$}
            \label{def:induction-conditions:all-validators:not-filtered-out} for any honest validator $v'$ and time $t' \in [t,t_\ell]$, $b$ is not filtered out by validator $v'$ at time $t'$, \ie, $b \in \filtered[time=t',val=v']$
            \siritem{$(C,t,t_\ell)$}
            \label{def:induction-conditions:all-validators:gj-succ} for any honest validator $v'$ and time $t' \in [t,t_\ell]$, $\gjattime[time=t',val=v']\succeq C$
            % \item\label{def:induction-conditions:all-validators:gj-succ-cs} $\gjattime[time=t',val=v'] \succeq C_\mathsf{s}$
            % \item\label{def:induction-conditions:all-validators:gj-succ-cs} $b_\mathsf{s} \preceq  \LMDGHOSTHFC(\viewattime[val=v',time=t'])$
        % \end{enumerate}
        % \item\label{def:induction-conditions:ub} by time $\slotstart(\firstslot(\epoch(b)+2))$, in the view of any honest node there exists a block $b' \succeq b$  such that $\chkp(b) \in \allU(b') \land \epoch(b') < \epoch(b)+2$.
        \siritem{$(b)$}
        \label{def:induction-conditions:ub} by time $\slotstart(\firstslot(\epoch(b)+2))$, in the view of any honest node there exists a block $b' \succeq b$ and checkpoint $C \succeq b$ such that $C \in \allU(b') \land \epoch(b') < \epoch(b)+2$.
        \siritem{$(b,e_1,e_2)$}
        \label{def:induction-conditions:no-conflicting} no checkpoint $C$ with $\epoch(C) \in [e_1,e_2]$ which conflicts with $b$ can ever be justified.
    \end{enumerate}
    We also write $\sir(b,t,C,b_\mathsf{s}).\sir n$ to mean the $\sir n(\mathit{args})$ conjunct of $\sir(b,t,C,b_\mathsf{s})$ where the arguments $\mathit{args}$ as per the definition of $\sir(b,t,C,b_\mathsf{s})$.

    For example, $\sir(b,t,C,b_\mathsf{s}).\sirtwo := \sirtwo(b,t,\slotstart(\epoch(b)+1))$.

    When $\sir(b,t,C,b_\mathsf{s})$ is clear from the context, we simply wirite $\sir n$ to mean $\sir(b,t,C,b_\mathsf{s}).\sir n$.

    We also write $\sir(b,t,C,b_\mathsf{s}).\{\sir_1,\ldots,\sir_k\}$ where $\sir_i \in {\sir n: n \in [1,5]}$ to mean  $\bigwedge_{i=1}^k \sir(b,t,C,b_\mathsf{s}).sir_i$.
\end{definition}

\begin{lemma}\label{lem:ffg-condition-on-q-implies-safety}
    Given \Cref{assum:beta,assum:no-change-to-the-validator-set},
    %~\ref{assum:beta}, \ref{assum:sync}, \ref{assum:ffg-assumptions:beta} and \ref{assum:oracle-access-to-committee-selection},
    let $v$ be any honest validator,
    $t$ and $t'$ be any two times,
    $b$ be any block and
    $C$ be any checkpoint.
    If
    \begin{enumerate}
        \item $\slotstart(\slot(t)-1)\geq\GGST$,
        % \item $slot(b) < slot(t)$
        \item $\varforvalattime[val=v]{\mathit{isLMDGHOSTSafeFrom}}(b,C,t,b_\mathsf{s})$,
        \item $t' \geq \slotstart(\slot(t))$ and
        \item for any validator $v'' \in \commfromslot[from=\slot(t),to=\slot(t')]{\honvals}$ and time $t''$ such that $t \leq t'' \leq t'$, 
        \begin{enumerate}[label*=\arabic*.]
            \item $\gjattime[time=t'',val=v''] \succeq C$,
            % \item $\gjattime[time=t'',val=v''] \succeq C_\mathsf{s}$ and
            \item $b \in \filtered[time=t'',val=v'']$,
            \item $b_\mathsf{s} \preceq  \LMDGHOSTHFC(\viewattime[val=v',time=t'])$
        \end{enumerate}
        % \item\label{itm:thm:lmd-confirmed-changing-balances:cond-on-justified-next-epoch} by the end of epoch $\epoch(t) + 1$, any honest validator has in their view a block $b''$ such that $\epoch(U(b'')) = \epoch(t) \land U(b'') \succeq \gjblock(b)$
    \end{enumerate}
    % then, for any time $t' \geq \slotstart(\slot(t))$ such that
    % \begin{enumerate}[resume]
    %     % \item $t' \geq t$, and

    % \end{enumerate}
    % we have that,
    then $b$ is canonical in the view of any honest validator at time $t'$.
    % \begin{enumerate}
    %     \item at time $t'$, $b$ is canonical in the view of any honest validator, and
    %     \item any honest validator voting at time $t'$ LMD votes for a descendant of block $b$ in slot $\slotattime{t'}$.
    % \end{enumerate}
\end{lemma}

\begin{proof}
    TBD
\end{proof}


\begin{lemma}\label{lem:ffg-safety-from-sir}
    If $\sir(b,t,C,b_\mathsf{s})$ holds, then $\canonical[blck=b,time=\slotstart(\slot(t))]$.
\end{lemma}

\begin{proof}
    % We proceed by induction on $t' \geq \slotstart(\slot(t))$
    % proving that $b$ is canonical in the view of any honest validator at time $t'$
    % % % Let $e_0 := \max(\epoch(b)+2, \epoch(t))$.
    % % We proceed by induction on epochs %$\epoch(t')$
    % % starting from $\epoch(b)+2$
    % % % For each $e' \geq e$, we want to show that $b$ does not get filtered out during epoch $e$, and also that, for any $t \geq s$ such that $\epoch(t) = e'$, $P^{N'}_{b'} > \frac{1}{2(1 - \beta)}(1 + \frac{W^{t+1}_p}{W_{b'}^{t}})$ holds throughout epoch $e'$. Moreover,
    % and add the following inductive hypothesis to the proof goal for any time $t'\geq \slotstart(\slot(t))$:

    First, we proceed by induction on $t' \geq \slotstart(\slot(t))$ to show that all of the following inductive conditions hold
    \begin{enumerate}[label=\roman*)]
        %\item by the end of epoch $\epoch(t)+1$, in the view of any honest node there exists a block $b' \succeq b$ such that $U(b') = \chkp(b)$; \label{def:safety-cond-1}
        \item there exists no checkpoint $C'$ with $\epoch(C') \in [\epoch(b), \epoch(t')]$ which conflicts with $b$. \label{lem:ffg-safety-from-sir:safety-cond-1}
        \item\label{lem:ffg-safety-from-sir:safety-cond-2} for any honest validator $v''$ and time $t''$ such that $\slotstart(\slot(t)) \leq t'' < \slotstart(\epoch(t')+1)$
        \begin{enumerate}[label=\roman{enumi}.\roman*)]
            \item $b \in \filtered[val=v'',time=t'']$\label{lem:ffg-safety-from-sir:safety-cond-2.1}
            \item $\gjattime[time=t'',val=v''] \succeq C$\label{lem:ffg-safety-from-sir:safety-cond-2.2}
            \item $b_\mathsf{s} \preceq  \LMDGHOSTHFC(\viewattime[val=v'',time=t''])$ \label{lem:ffg-safety-from-sir:safety-cond-2.3}
        \end{enumerate}

        % \item $b$ is always canonical in the view of all honest validators at any time $t' \geq t$ such that $\slotattime{t'} > \slotattime{t} \land \epoch(t') \in \{e, e+1\}$
        % \item $P_b^{t} > \frac{1}{2(1-\beta)}(1 + \frac{W^{t+1}_p}{W_b^{t}})$ for all slots $t$ such that $\epoch(t) = e+1$.
    \end{enumerate}


    \begin{description}
        \item[Base Case: $\epoch(t') < \epoch(b)+2$.]
        % Due to \sirone and \sirtwo and \sirthree we can apply Lemma~\ref{lem:ffg-condition-on-q-implies-safety} to conclude that $b$ is canonical for any honest validator at time $t'$.
        All inductive hypothesis are trivially implied by \sirtwo, \sirthree and \sirfive.


        \item[Inductive Step: $\epoch(t') \geq \epoch(b)+2$.]
        Assume that all the inductive hypotheses hold at any time $t_i$ up to %such that $\slotattime{t_i} < \slotattime{t'}$
        $\epoch(t_i) \leq \epoch(t')-1$ and prove that they hold at time $t'$ as well.
        Let $v'$ be any honest validator.
        % We let $v'$ be any hoenst validator so that, to prove \ref{def:safety-cond-2}, it will be sufficient to show that $b$ is canonical for $v'$ at time $t'$.

        % Let $v''$ be any honest validator and $t''$ be any time such that $\slotstart(\slot(t))\leq t'' < \slotstart(\epoch(t)+1)$.

        Induction hypothesis~\ref{lem:ffg-safety-from-sir:safety-cond-1} and \ref{def:induction-conditions:ub} allow us to apply Lemma 11 of the Paper to conclude that $b \in \filtered[time=t',val=v']$, \ie, $b$ does not get filtered out by any honest validator in epoch $\epoch(t')$.
        This proves induction hypothesis~\ref{lem:ffg-safety-from-sir:safety-cond-2.1} holds at time $t'$ as well.

        % First, Lemma~\ref{lem:block-in-the-view-of-all-honests} implies that $b$ is in the view of validator $v'$ at time $t'$.
        Also, induction hypothesis~\ref{lem:ffg-safety-from-sir:safety-cond-1},
        % \ref{lem:ffg-safety-from-sir:safety-cond-2.2},
        % \sirone,
        \ref{def:induction-conditions:ub},
        Property~1.7 of the Paper
        and the definition of $\gjattime[time=t',val=v']$ (Definition~\ref{def:gjview})
        imply that
        $\gjattime[time=t',val=v'] \succeq \chkp(b)$.
        Then,
        \sirone,
        proves inductive conditions \ref{lem:ffg-safety-from-sir:safety-cond-2.2} and $\gjattime[time=t',val=v']  \succeq b_\mathsf{s}$.
        Given that $\LMDGHOSTHFC(\viewattime[val=v',time=t']) \succeq \gjattime[time=t',val=v']$, this proves \ref{lem:ffg-safety-from-sir:safety-cond-2.3} for $t'$.
        % This, together with  and \ref{def:induction-conditions:all-validators:gj-succ}, implies that $\gjattime[time=t'',val=v''] \succeq C$.


        % Consider some epoch $e' \geq e+1$, for which all inductive %assumptions
        % hypotheses are satisfied.
        % This implies that there is no justified checkpoint in epochs $[e-1, e']$ which conflicts with $b$.
        % Together with condition~\ref{def:safety-cond-1}, this
        Given that $t'\geq\slotstart(\slot(t))$ and that above we have proved that inductive condition \ref{lem:ffg-safety-from-sir:safety-cond-2} is satisfied for time $t'$, thanks to \sirone, we can apply Lemma~\ref{lem:ffg-condition-on-q-implies-safety} to conclude that $b$ is always canonical in the view of all honest validators at any time during epoch $\epoch(t')$.
        % and that all honest validators in epoch $\epoch(t')$ \GHOST vote for a descendant of $b$ proving the Lemma's statement.

        % We can now use this and inductive hypothesis iv) to apply Lemma~\ref{lem:slot-induction-within-epoch} to epoch $e'+1$, and conclude that $P_b^{t'} > \frac{1}{2(1-\beta)}(1 + \frac{W^{t'+1}_p}{W_b^{t'}})$ for all slots $t'$ in epoch $e'+1$ proving condition iii).
        % This also implies that $b$ is canonical in all honest views in epoch $e'+1$, and thus that the subtree of $b$ receives all honest votes proving the Lemma's statement.
        % Then we are just left to show that the inductive hypothesis~\ref{def:safety-cond-2}
        By Properties~1.3 and 1.6 of the Paper, this immediately implies that no checkpoint conflicting with $b$ can be justified in epoch $\epoch(t') $, which concludes the proof for the inductive hypothesis~\ref{lem:ffg-safety-from-sir:safety-cond-1}.
        % Condition i) is trivially true as the view of an honest node is monotonic.
    \end{description}
    Given that we have just established that the inductive condition \ref{lem:ffg-safety-from-sir:safety-cond-2} hold for any time $t' \geq \slotstart(\slot(t))$, thanks to \sirone, we can apply Lemma~\ref{lem:ffg-condition-on-q-implies-safety} to complete the proof.
\end{proof}

\begin{lemma}\label{lem:epoch-gu-less-than-two-epoch-ago-start-epoch}
    If
    \begin{enumerate}
        \item $\slotstart(\slot(t)-1)\geq \GST$
        \item $\epoch(\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}) \geq \epoch(t) - 1$
        \item $\slot(t) = \firstslot(\epoch(t))$
    \end{enumerate},
    then
    \begin{enumerate}
        \item $\epoch(\guattime[time=\slotstart(\slot(t)-1),val=v]) \geq \epoch(t)-2$
    \end{enumerate}
\end{lemma}

\begin{proof}
    Let $s:= \slot(t)$.
    The Lemma's condition imply that $\epoch(\varforvalattime[val=v,time=\slotstart(s-1)]{\bconfirmed}) = \epoch(s-1)$ as $\epoch(s-1) = \epoch(s)-1 \leq \epoch(\varforvalattime[val=v,time=\slotstart(s-1)]{\bconfirmed}) < \epoch(t)$.
    \Cref{lem:conf-current-epoch-then-gu-curr-epoch} implies that $\exists b' \in \viewattime[val=v,time=\slotstart(s-1)], b' \succeq \varforvalattime[val=v,time=\slotstart(s-1)]{\bconfirmed} \land \epoch(\gu(b')) \geq \epoch(s-1) = \epoch(s)-2$.
\end{proof}

\begin{lemma}\label{lem:epoch-gj-less-than-two-epoch-ago-start-epoch}
    If
    \begin{enumerate}
        \item $\slotstart(\slot(t)-1)\geq \GST$
        \item $\epoch(\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}) \geq \epoch(t) - 1$
        \item $\slot(t) = \firstslot(\epoch(t))$
    \end{enumerate},
    then, for any honest validator $v'$ and time $t' \geq \slotstart(\epoch(t))$,
    \begin{enumerate}
        \item $\epoch(\gjattime[time=t',val=v']) \geq \epoch(t)-2$
    \end{enumerate}
\end{lemma}

\begin{proof}
    From \Cref{lem:epoch-gu-less-than-two-epoch-ago-start-epoch} and the synchrony assumption.
\end{proof}

\begin{lemma}\label{lem:gj-prec-prev-confirmed-at-start-of-epoch}
    % Pick any $b_c \in  \varforvalattime[val=v,time=\slotstart(\slot(t))]{\bcands}$, any time $t' \geq \slotstartslot{t}$ and any honest validator $v'$.
    If
    \begin{enumerate}
        \item $\slotstart(\firstslot(\epoch(t))-1)\geq \GST$
        \item  $t = \firstslot(\epoch(t))$
        \item the \KwSty{if} condition at line \Cref{ln:if-bcand-npreceq-head} is false
        % \item \ref{def:induction-conditions:ub} holds for $\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}$
        \item  \label{itm:lem:gj-prec-prev-confirmed-at-start-of-epoch:4}no checkpoint $C$ s.t. $\epoch(C) = \epoch(\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed})$ and $C \neq \chkp(\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed})$ can ever be justified
        % \item \ref{def:induction-conditions:ub} holds for $\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}$
        % \item $\slotstart(\lastslot(\epoch(t)-1)) \geq \GST$
        % \item $\epoch(b_c) \geq \epoch(t)-1$
        % \item $b_c \in \filtered[val=v',time=t']$
    \end{enumerate},
    then, for any justified checkpoint $C$ %honest validators $v'$ and any time $t' \geq \slotstart(\epoch(t))$% s.t. $\epoch(t') = \epoch(t)$
    \begin{enumerate}
        % \item $\epoch(\gjattime[time=t',val=v']) \leq \epoch(t)-1 \implies \gjattime[time=t',val=v']  \preceq \varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}$
        % \item $\epoch(\gjattime[time=t',val=v']) \in [\epoch(t)-2,\epoch(t)-1] \implies \gjattime[time=t',val=v']  \preceq \varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}$
        \item $\epoch(C) \in [\epoch(\guattime[time=\slotstart(\firstslot(\epoch(t)-1))]),\epoch(t)-1] \implies C  \preceq \varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}$
    \end{enumerate}
\end{lemma}

\begin{proof}
    The Lemma's conditions imply that $\epoch(\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}) = \epoch(t)-1$.
    From \Cref{lem:epoch-gu-less-than-two-epoch-ago-start-epoch} and syncrony, we have the following two cases.
    % By cases.
    \begin{description}
        \item[Case 1: {$\epoch(C)=\epoch(t)-1$}.] 
        Given assumption~\ref{itm:lem:gj-prec-prev-confirmed-at-start-of-epoch:4} of the Lemma and $\epoch(\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}) = \epoch(t)-1$, we know that $C  = \chkp(\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}) \preceq \varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}$
        \item[Case 2: {$\epoch(C)=\epoch(t)-2$}.]
        From \Cref{lem:epoch-gu-less-than-two-epoch-ago-start-epoch} and syncrony,
        this implies $C = \guattime[val=v,time=\slotstart(\slot(t)-1)] \preceq \varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}$.
        The last $\preceq$ relation comes from the \KwSty{if} condition at line \Cref{ln:if-bcand-npreceq-head} being false.
    \end{description}
\end{proof}

% \begin{lemma}\label{lem:gj-prec-prev-confirmed-at-start-of-epoch}
%     % Pick any $b_c \in  \varforvalattime[val=v,time=\slotstart(\slot(t))]{\bcands}$, any time $t' \geq \slotstartslot{t}$ and any honest validator $v'$.
%     If
%     \begin{enumerate}
%         \item $\slotstart(\firstslot(\epoch(t))-1)\geq \GST$
%         \item  $t = \firstslot(\epoch(t))$
%         \item the \KwSty{if} condition at line \Cref{ln:if-bcand-npreceq-head} is false
%         % \item \ref{def:induction-conditions:ub} holds for $\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}$
%         % \item $\slotstart(\lastslot(\epoch(t)-1)) \geq \GST$
%         % \item $\epoch(b_c) \geq \epoch(t)-1$
%         % \item $b_c \in \filtered[val=v',time=t']$
%     \end{enumerate},
%     then, for any honest validators $v'$ and time $t'$ s.t. $\epoch(t') = \epoch(t)$
%     \begin{enumerate}
%         \item $\gjattime[time=t',val=v']  \preceq \varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}$
%     \end{enumerate}
% \end{lemma}

% \begin{proof}
%     The Lemma's conditions imply that $\epoch(\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}) = \epoch(t)-1$.
%     From \Cref{lem:epoch-gu-less-than-two-epoch-ago-start-epoch} and syncrony, by cases.
%     \begin{description}
%         \item[Case 1: {$\epoch(\gjattime[time=t',val=v'])=\epoch(t)-1$}.] 
%         Given that $\willNoConflictingChkpBeJustified(\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed})$, and $\epoch(\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}) = \epoch(t)-1$, we know that $\gjattime[time=t',val=v']  \preceq \varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}$
%         \item[Case 2: {$\epoch(\gjattime[time=t',val=v'])=\epoch(t)-2$}.]
%         This implies $\gjattime[time=t',val=v'] = \guattime[val=v,time=\slotstart(\slot(t)-1)] \preceq \varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}$ 
%     \end{description}
% \end{proof}

\begin{lemma}\label{lem:prev-confirmed-not-filtered-out-start-of-epoch}
    % Pick any $b_c \in  \varforvalattime[val=v,time=\slotstart(\slot(t))]{\bcands}$, any time $t' \geq \slotstartslot{t}$ and any honest validator $v'$.
    If
    \begin{enumerate}
        \item $\slotstart(\firstslot(\epoch(t))-1)\geq \GST$
        \item  $t = \slotstart(\epoch(t))$
        \item the \KwSty{if} condition at line \Cref{ln:if-bcand-npreceq-head} is false
        \item no checkpoint $C$ s.t. $\epoch(C) = \epoch(t)-1$ and $\block(C)$ conflicts with  $\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]$ can ever be justified
        % \item \ref{def:induction-conditions:ub} holds for $\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}$
        % \item \ref{def:induction-conditions:ub} holds for $\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}$
        % \item $\slotstart(\lastslot(\epoch(t)-1)) \geq \GST$
        % \item $\epoch(b_c) \geq \epoch(t)-1$
        % \item $b_c \in \filtered[val=v',time=t']$
    \end{enumerate},
    then, for any honest validators $v'$ and time $t'$ s.t. $\epoch(t') = \epoch(t)$
    \begin{enumerate}
        \item $\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed} \in \filtered[val=v',time=t']$
    \end{enumerate}
\end{lemma}

\begin{proof}
    The Lemma's conditions imply $\epoch(\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}) = \epoch(t)-1$.
    Then, the proof follows from \Cref{lem:gj-prec-prev-confirmed-at-start-of-epoch,lem:conf-prev-epoch-then-vs-two-epochs-ago}\RSfn{and some property on max GJ  epoch}.
\end{proof}

\begin{lemma}\label{lem:conf-prev-slot-canonical-at-the-start-of-an-epoch}
    % Pick any $b_c \in  \varforvalattime[val=v,time=\slotstart(\slot(t))]{\bcands}$, any time $t' \geq \slotstartslot{t}$ and any honest validator $v'$.
    If
    \begin{enumerate}
        \item $\slotstart(\firstslot(\epoch(t))-1)\geq \GST$
        \item  $t = \slotstart(\epoch(t))$
        \item \label{itm:lem:conf-prev-slot-canonical-at-the-start-of-an-epoch:3} the \KwSty{if} condition at line \Cref{ln:if-bcand-npreceq-head} is false
        \item\label{itm:lem:conf-prev-slot-canonical-at-the-start-of-an-epoch:4}  no checkpoint $C$ s.t. $\epoch(C) = \epoch(t)-1$ and $\block(C)$ conflicts with  $\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]$ can ever be justified
        % \item $\slotstart(\lastslot(\epoch(t)-1)) \geq \GST$
        % \item $\epoch(b_c) \geq \epoch(t)-1$
        % \item $b_c \in \filtered[val=v',time=t']$
    \end{enumerate},
    then
    \begin{enumerate}
        \item $\sir(\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)],t,\guattime[val=v,time={\slotstart(\firstslot(\epoch(t))-1)}],\block(\guattime[val=v,time={\slotstart(\firstslot(\epoch(\varforvalattime[val=v]{t}))-1)}])).\{ \sirone, \sirtwo, \sirthree\}$ holds.
        % \item for any honest validators $v'$ and time $t'$ s.t. $\epoch(t') = \epoch(t)$, $\gjattime[time=t',val=v']  \preceq \bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]$
        \item for any justified checkpiont $C$, $\epoch(C) \in [\epoch(\guattime[time=\slotstart(\firstslot(\epoch(t)-1))]),\epoch(t)-1] \implies C  \succeq \guattime[time=\slotstart(\firstslot(\epoch(t))-1),val=v]$
        \item for any justified checkpiont $C$, $\epoch(C) \in [\epoch(\guattime[time=\slotstart(\firstslot(\epoch(t)-1))]),\epoch(t)-1] \implies C  \preceq \bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]$
        \item $\canonical[blck={\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]},time=t,to=\slotstart(\epoch(t)+1)]$
    \end{enumerate}
\end{lemma}

\begin{proof}
    Lemma's assumption~\ref{itm:lem:conf-prev-slot-canonical-at-the-start-of-an-epoch:3}
    implies that $\epoch(\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]) = \epoch(t)-1$ and $\varforvalattime[val=v]{\mathit{is\_chain\_one\_confirmed}}(\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)],\guattime[val=v,time={\slotstart(\firstslot(\epoch(\varforvalattime[val=v]{t}))-1)}])$.
    
    Note that this implies that $\slotstart(epoch(\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]) +2) = \slotstart(\epoch(t)+1)$.


    % Now, we prove tha $\sir(\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)],t,\guattime[val=v,time={\slotstart(\firstslot(\epoch(\varforvalattime[val=v]{t}))-1)}],\block(\guattime[val=v,time={\slotstart(\firstslot(\epoch(\varforvalattime[val=v]{t}))-1)}]))$ holds.

    $\varforvalattime[val=v]{\mathit{is\_chain\_one\_confirmed}}(\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)],\guattime[val=v,time={\slotstart(\firstslot(\epoch(\varforvalattime[val=v]{t}))-1)}])$ implies that $\block(\guattime[val=v,time={\slotstart(\firstslot(\epoch(\varforvalattime[val=v]{t}))-1)}]) \preceq \bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]$.
    Given that $\epoch(\guattime[val=v,time={\slotstart(\firstslot(\epoch(\varforvalattime[val=v]{t}))-1)}])\leq \epoch(t)-1 = \epoch(\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)])$, we have that $\guattime[val=v,time={\slotstart(\firstslot(\epoch(\varforvalattime[val=v]{t}))-1)}] \preceq \bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]$.
    % $\varforvalattime[val=v]{\mathit{is\_chain\_one\_confirmed}}(\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)],\guattime[val=v,time={\slotstart(\firstslot(\epoch(\varforvalattime[val=v]{t}))-1)}])$ then also implies \sirone.
    This further implies that \sirone holds.

    \Cref{lem:prev-confirmed-not-filtered-out-start-of-epoch}  proves \ref{def:induction-conditions:all-validators:not-filtered-out}.

    Let $C$ be a justified checkpoint such that $\epoch(C) \in [\epoch(\guattime[time=\slotstart(\firstslot(\epoch(t)-1))]),\epoch(t)-1]$.
    \Cref{lem:gj-prec-prev-confirmed-at-start-of-epoch} implies $C  \preceq \bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]$.
    Given that, as proven above, $\guattime[val=v,time={\slotstart(\firstslot(\epoch(\varforvalattime[val=v]{t}))-1)}] \preceq \bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]$, this implies that $\guattime[val=v,time={\slotstart(\firstslot(\epoch(\varforvalattime[val=v]{t}))-1)}]$ does not conflict with $C$.
    Then, given that we assume $\epoch(C)\geq \epoch(\guattime[val=v,time={\slotstart(\firstslot(\epoch(\varforvalattime[val=v]{t}))-1)}])$, we have that $C\succeq \guattime[val=v,time={\slotstart(\firstslot(\epoch(\varforvalattime[val=v]{t}))-1)}]$.

    Given that $\epoch(\gjattime[time=t',val=v']) \in [\epoch(\guattime[time=\slotstart(\firstslot(\epoch(t)-1))]),\epoch(t)-1]$ for any honest validator $v'$ and time $t' \in [\slotstart(\epoch(t)),\slotstart(\epoch(t)+1)]$, \ref{def:induction-conditions:all-validators:gj-succ} holds.


    % Let $v'$ be any honest validator and $t' \geq \epoch(t)$ such that $\epoch(\gjattime[time=t',val=v']\leq\epoch(t)-1$.
    % \Cref{lem:gj-prec-prev-confirmed-at-start-of-epoch} implies $\gjattime[time=t',val=v']  \preceq \bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]$.
    % Given that, as proven above, $\guattime[val=v,time={\slotstart(\firstslot(\epoch(\varforvalattime[val=v]{t}))-1)}] \preceq \bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]$, this implies that $\guattime[val=v,time={\slotstart(\firstslot(\epoch(\varforvalattime[val=v]{t}))-1)}]$ does not conflict with $\gjattime[time=t',val=v']$.
    % Then, given that due to synchorny, $\epoch(\gjattime[time=t',val=v'])\geq \epoch(\guattime[val=v,time={\slotstart(\firstslot(\epoch(\varforvalattime[val=v]{t}))-1)}])$, we have that $\gjattime[time=t',val=v']\succeq \guattime[val=v,time={\slotstart(\firstslot(\epoch(\varforvalattime[val=v]{t}))-1)}]$.
    % This also implies that \ref{def:induction-conditions:all-validators:gj-succ} holds.

    % This, \Cref{lem:gj-at-least-e-2-curr-slot,lem:gj-does-not-conflict} we can conclude that $\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]$ does not conflict with $\gjattime[time=t',val=v']$.



    % $\epoch(t) > \epoch(\gjattime[time=t',val=v']) \geq \epoch(\guattime[val=v,time={\slotstart(\firstslot(\epoch(t))-1)}]) \geq \epoch(t)-2$b


    % Assumption \ref{itm:lem:conf-prev-slot-canonical-at-the-start-of-an-epoch:4} of the Lemma implies that no justified checkpoint for epoch $\epoch(t)-1$ conflicting with $\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]$ can exist.





    % Then, this, \Cref{lem:gu-prec-gj-start-epoch-when-prec-conf-from-at-least-prev-epoch,lem:epoch-gu-less-than-two-epoch-ago-start-epoch}, $\epoch(\gjattime[time=t',val=v']) \geq \epoch(\guattime[val=v,time={\slotstart(\firstslot(\epoch(\varforvalattime[val=v]{t}))-1)}])$ imply \ref{def:induction-conditions:all-validators:gj-succ} and \ref{def:induction-conditions:all-validators:gj-succ-cs}.

    \sirone, \sirtwo and \sirthree and \Cref{lem:ffg-condition-on-q-implies-safety} imply that $\canonical[time=t,blck={\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]},to=\slotstart(\epoch(t)+1)]$. 

    % This then implies that no checkpoint for epoch $\epoch(t)$ conflicting with $\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]$ can ever be justified which concldes the proof for \sirfive.

    % \ref{def:induction-conditions:ub} holds by assumption.
\end{proof}


\begin{lemma}\label{lem:output-find-latest-canonical-canonical-at-the-start-of-an-epoch}
    % Let $b_o := \varforvalattime[val=v]{\mathit{find\_latest\_confirmed\_descendant}}(b_c)$.
    Let $b_c$ be a block such that
    If
    \begin{enumerate}
        \item $\bconfirmed[val=v,time=\slotstart(\slot(t))] =  \varforvalattime[val=v]{\mathit{find\_latest\_confirmed\_descendant}}(b_c)$
        \item $\slotstart(\firstslot(\epoch(t))-1)\geq \GST$
        % \item $\sir(b_c,t,\guattime[val=v,time={\slotstart(\slot({t})-1)}],\cdot)$ holds
        \item $\canonical[blck=b_c,time={\varforvalattime[val=v]{t}},to=\slotstart(\epoch(t)+1)]$
        \item \label{itm:lem:output-find-latest-canonical-canonical-at-the-start-of-an-epoch:4}for any justified checkpiont $C$, $\epoch(C) \in [\epoch(\guattime[time=\slotstart(\firstslot(\epoch(t)-1))]),\epoch(t)-1] \implies C  \preceq b_c$
        \item for any justified checkpiont $C$, $\epoch(C) \in [\epoch(\guattime[time=\slotstart(\firstslot(\epoch(t)-1))]),\epoch(t)-1] \implies C  \succeq \ceba[val=v,time=\slotstartslot{t}]$
        \item  \label{itm:lem:output-find-latest-canonical-canonical-at-the-start-of-an-epoch:5} for any justified checkpiont $C$, $\epoch(C) \in [\epoch(\guattime[time=\slotstart(\firstslot(\epoch(t)-1))]),\epoch(t)-1] \implies C  \succeq \guattime[time=\slotstart(\firstslot(\epoch(t))-1),val=v]$
        % \item \ref{def:induction-conditions:ub} holds for a block $b_0$ s.t. $b_0 \preceq b_c$ and $\epoch(b_0) = \epoch(t)-1$ %\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]
        % \item $\epoch(b_c) \geq \epoch(\varforvalattime[val=v]{t})-1$
        \item $t = \slotstart(\slot(t))$

        % \item $\varforvalattime[val=v]{t} = \slotstart(\epoch(\varforvalattime[val=v]{t}))$
    \end{enumerate},
    then
    \begin{enumerate}
        % \item for any honest validators $v'$ and time $t'$ s.t. $\epoch(t') = \epoch(t)$, $\gjattime[time=t',val=v']  \preceq \bconfirmed[val=v,time=\slotstart(\slot(t))]$
        \item for any justified checkpiont $C$, $\epoch(C) \in [\epoch(\guattime[time=\slotstart(\firstslot(\epoch(t)-1))]),\epoch(t)-1] \implies C  \preceq \bconfirmed[val=v,time=\slotstart(\slot(t))]$
        \item $\sir(\bconfirmed[val=v,time=\slotstart(\slot(t))],t,\ceba[val=v,time=\slotstartslot{t}],b_c).\{ \sirone, \sirtwo, \sirthree\}$ holds.
        % \item $\sir(b_o,t,\guattime[val=v,time={\s\lotstart(\slot(\varforvalattime[val=v]{t})-1)}],b_c)$, with the exception of  \ref{def:induction-conditions:ub}, holds
        \item $\canonical[blck=b_o,time={\varforvalattime[val=v]{t}},to=\slotstart(\epoch(t)+1)]$
    \end{enumerate}
\end{lemma}

\begin{proof}
        We prove first that $\sir(\bconfirmed[val=v,time=\slotstart(\slot(t))],t,\ceba[val=v,time=\slotstartslot{t}],b_c).\{ \sirone, \sirtwo, \sirthree\}$ holds.
        Let $v'$ be any honest validator and $t' \in [t, \slotstart(\epoch(t)+1)]$.



        % If $b_c= b_o$ by the inductive hypothesis above.

        % From \Cref{lem:if-new-bc-then-output-find-latest} we know that\\ $b_o=\mathit{find\_latest\_confirmed\_descendant}(b_c)$.

        We know that $\bconfirmed[val=v,time=\slotstart(\slot(t))] \succeq b_c$.

        Due to synchrony, we know that $\epoch(\ceba[val=v,time=t]) \in [\epoch(\guattime[time=\slotstart(\firstslot(\epoch(t)-1))]),\epoch(t)-1]$ and $\epoch(\gjattime[val=v',time=t']) \in [\epoch(\guattime[time=\slotstart(\firstslot(\epoch(t)-1))]),\epoch(t)-1]$.
        Then, Lemma's condition \ref{itm:lem:output-find-latest-canonical-canonical-at-the-start-of-an-epoch:4} implies $\ceba[val=v',time=t'] \preceq b_o$ and $\gjattime[val=v',time=t'] \preceq b_o$.

        % Assumption \ref{itm:lem:output-find-latest-canonical-canonical-at-the-start-of-an-epoch:4} of the Lemma's statement then implies that $\gjattime[time=t',val=v'] \preceq \bconfirmed[val=v,time=\slotstart(\slot(t))]$ for any time $t' \in [\slotstart(\epoch(t)),\slotstart(\epoch(t)+1)]$ and an honest validator $v'$.

        % We can prove that there exists a time $t'' \in [\slotstart(\epoch(t)),\slotstart(\epoch(t)+1)]$ and an honest validator $v''$ such that $\ceba[val=v,time=\slotstartslot{t}] = \gjattime[time=t'',val=v'']$. (If we are in the first slot then $t''$ is any time and $v''$ is any validator, otherwise, $t''= \slotstart(\slot(t)-1)$ and $v'' = v$.)

        % Then, from the above we can conclude that $\ceba[val=v,time=\slotstartslot{t}]  \preceq b_o$.

        We also know that $\mathit{find\_latest\_confirmed\_descendant}$ ensures that\\
            $\mathit{isLMDGHOSTSafeFrom}(b_o,t,\ceba[val=v,time=\slotstartslot{t}],b_c)$. 
        Hence, \sirone holds.


        Also, $\gjattime[time=t',val=v'] \preceq b_o$ and
        \Cref{lem:conf-prev-epoch-then-vs-two-epochs-ago} imply \ref{def:induction-conditions:all-validators:not-filtered-out}.

        % We know that $\epoch(t)-2\leq\epoch(\guattime[val=v,time={\slotstart(\firstslot(\epoch(t))-1)}])\leq\epoch(\ceba[val=v,time=\slotstartslot{t}])\leq\epoch(\gjattime[time=t',val=v'])\leq\epoch(t)-1$.

        Then, if $\epoch(\ceba[val=v,time=\slotstartslot{t}])=\epoch(\guattime[time=\slotstart(\firstslot(\epoch(t)-1))])$, 
        $\ceba[val=v,time=\slotstartslot{t}]= \guattime[val=v,time={\slotstart(\slot({t})-1)}]$ and Lemma's condition~\ref{itm:lem:output-find-latest-canonical-canonical-at-the-start-of-an-epoch:5} implies $\gjattime[time=t',val=v']\succeq \ceba[val=v,time=\slotstartslot{t}]$.
        Otherwise, \Cref{lem:epoch-gu-less-than-two-epoch-ago-start-epoch} implies that 
        $\epoch(\ceba[val=v,time=\slotstartslot{t}])=\epoch(t)-1$. 
        Then,  $\gjattime[time=t',val=v'] = \ceba[val=v,time=\slotstartslot{t}]$.
        Hence, \ref{def:induction-conditions:all-validators:gj-succ} holds.

        Finally, \sirone, \sirtwo and \sirthree,   $\canonical[blck={b_c},time=t, to=\slotstart(\epoch(t)+1)]$, and \Cref{lem:ffg-condition-on-q-implies-safety} imply that $\canonical[time=t,blck={\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}},to=\slotstart(\epoch(t)+1)]$. 


        % $\sir(b_c,t,\guattime[val=v,time={\slotstart(\slot({t})-1)}],\cdot)$ clearly implies \ref{def:induction-conditions:all-validators:gj-succ}$(b_o,t,\guattime[val=v,time={\slotstart(\slot(\varforvalattime[val=v]{t})-1)}],b_c)$.

        % \ref{def:induction-conditions:all-validators:gj-succ-cs} is clearly implied by the Lemma's assumptions.

        % % \ref{def:induction-conditions:ub} is cleraly implied by the Lemma's assumptions.

        % \sirfive can be proven as in the proof of \Cref{lem:conf-prev-slot-canonical-at-the-start-of-an-epoch}: from the proof of the previous conditions, we can conclude that $\canonical[time=t,blck={b_o},to=\slotstart(\epoch(t)+1)]$ from which we can prove that  no checkpoint for epoch $\epoch(t) = \epoch(b_o)+1$ conflicting with ${b_o}$ can ever be justified.
        % \ref{def:induction-conditions:ub} holding for ${b_o}$ implies \sirfive  for epoch $\epoch(b) = \epoch(t)-1$, 
\end{proof}

% \begin{proof}
    
%     % We need to prove that $\sir(b_o,t,\guattime[val=v,time={\slotstart(\slot(\varforvalattime[val=v]{t})-1)}],b_c)$ holds.  
    
%     We know that 
%     \begin{enumerate}
%         \item $\mathit{find\_latest\_confirmed\_descendant}$ ensures that\\ $\mathit{isLMDGHOSTSafeFrom}(b_o,t,\guattime[val=v,time={\slotstart(\slot(\varforvalattime[val=v]{t})-1)}],b_c)$ 
%         \item  $\sir(b_c,t,\guattime[val=v,time={\slotstart(\slot({t})-1)}],\cdot)$ implies  $\guattime[val=v,time={\slotstart(\slot(\varforvalattime[val=v]{t})-1)}] \preceq b_c$.
%         $b_o = \varforvalattime[val=v]{\mathit{find\_latest\_confirmed\_descendant}}(b_c)$ then implies $\guattime[val=v,time={\slotstart(\slot(\varforvalattime[val=v]{t})-1)}] \preceq b_c \preceq b_o$.
%         % \item Given the above, $\block(\guattime[val=v,time={\slotstart(\slot(\varforvalattime[val=v]{t})-1)}])  \preceq b_o$
%     \end{enumerate}
%     Hence, \sirone holds.

%     Given that $b_o \succeq b_c$,
%     assumption \ref{itm:lem:output-find-latest-canonical-canonical-at-the-start-of-an-epoch:4} implies that $\gjattime[time=t',val=v'] \preceq b_c  \preceq b_o$.
%     \Cref{lem:conf-prev-epoch-then-vs-two-epochs-ago} then implies \ref{def:induction-conditions:all-validators:not-filtered-out}.

%     $\sir(b_c,t,\guattime[val=v,time={\slotstart(\slot({t})-1)}],\cdot)$ clearly implies \ref{def:induction-conditions:all-validators:gj-succ}$(b_o,t,\guattime[val=v,time={\slotstart(\slot(\varforvalattime[val=v]{t})-1)}],b_c)$.

%     % \ref{def:induction-conditions:all-validators:gj-succ-cs} is clearly implied by the Lemma's assumptions.

%     % \ref{def:induction-conditions:ub} is cleraly implied by the Lemma's assumptions.

%     \sirfive can be proven as in the proof of \Cref{lem:conf-prev-slot-canonical-at-the-start-of-an-epoch}: from the proof of the previous conditions, we can conclude that $\canonical[time=t,blck=b_o,to=\slotstart(\epoch(t)+1)]$ from which we can prove that  no checkpoint for epoch $\epoch(t) = \epoch(b_o)+1$ conflicting with $b_o$ can ever be justified.
%     \ref{def:induction-conditions:ub} holding for $b_o$ implies \sirfive  for epoch $\epoch(b) = \epoch(t)-1$, 
% \end{proof}

\begin{lemma}\label{lem:code-implications-of-confirmed-block-from-prev-epoch-at-the-beginning-of-epoch}
        If
    \begin{enumerate}
        % \item $\slotstart(\firstslot(\epoch(t))-1)\geq \GST$
        \item  $t = \slotstart(\epoch(t))$
        \item $\epoch(\bconfirmed[val=v,time=\slotstart(\epoch(t))])=\epoch(t)-1$
        % \item if $\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)] \preceq \bconfirmed[val=v,time=\slotstart(\epoch(t))]$,
        % then no checkpoint $C$ s.t. $\epoch(C) = \epoch(\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)])$ and $C \neq \chkp(\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)])$ can ever be justified
        % \item \ref{def:induction-conditions:ub} holds for $\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}$
        % \item \ref{def:induction-conditions:ub} holds for $\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}$
        % \item $\slotstart(\lastslot(\epoch(t)-1)) \geq \GST$
        % \item $\epoch(b_c) \geq \epoch(t)-1$
        % \item $b_c \in \filtered[val=v',time=t']$
    \end{enumerate},
    then, one of the following conditions hold
    \begin{enumerate}
        % \item $\bconfirmed[val=v,time=\slotstart(\epoch(t))] = \block(\gfattime[val=v,time={\varforvalattime[val=v]{t}}])$
        \item the \KwSty{if} condition at line \Cref{ln:if-bcand-npreceq-head} is false 
        and\\$\bconfirmed[val=v,time=\slotstart(\epoch(t))] = \varforvalattime[val=v]{\mathit{find\_latest\_confirmed\_descendant}}(\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)])$.
        \item $\guattime[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]=\chkp(\bconfirmed[val=v,time=\slotstart(\epoch(t))])$ and\\ 
        $\bconfirmed[val=v,time=\slotstart(\epoch(t))] = \varforvalattime[val=v]{\mathit{find\_latest\_confirmed\_descendant}}(\block(\guattime[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]))$
        and $\exists b' \succeq \bconfirmed[val=v,time=\slotstart(\epoch(t))], \gu(b')=\chkp(\bconfirmed[val=v,time=\slotstart(\epoch(t))])$
        % \item $\bconfirmed[val=v,time=\slotstart(\epoch(t))] \succeq \block(\guattime[val=v,time=\slotstart(\firstslot(\epoch(t))-1)])$ and $\epoch(\guattime[val=v,time=\slotstart(\firstslot(\epoch(t))-1)])= \epoch(t)-1$
    \end{enumerate}
\end{lemma}

\begin{proof}
    TBD
\end{proof}

\begin{lemma}\label{lem:gu-e-1-canonical}
    If
    \begin{enumerate}
        \item $\slotstart(\firstslot(\epoch(t))-1)\geq \GST$
        \item $t = \slotstart(\epoch(t))$
        \item $\epoch(\guattime[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]) = \epoch(t)-1$
    \end{enumerate},
    then,
    \begin{enumerate}
        \item $\canonical[blck={\block(\guattime[val=v,time=\slotstart(\firstslot(\epoch(t))-1)])},time=\slotstartslot{t}]$.
        \item for any justified checkpiont $C$, $\epoch(C) = \epoch(t)-1 \implies C  \preceq \block(\guattime[time=\slotstart(\firstslot(\epoch(t)-1))])$
        \item   for any justified checkpiont $C$, $\epoch(C) =\epoch(t)-1 \implies C  \succeq \guattime[time=\slotstart(\firstslot(\epoch(t))-1),val=v]$
    \end{enumerate}
\end{lemma}

\begin{proof}
    By induction on $t' \geq \slotstartslot{t}$.
    Let $b := \block(\guattime[val=v,time=\slotstart(\firstslot(\epoch(t))-1)])$.
    We will show that $b \preceq \LMDGHOSTHFC(\viewattime[val=v',time=t'])$.
    \begin{description}
        \item[Base case: {$\epoch(t') = \epoch(t)$}.] Because of the synchrony assumption and the fact that $\epoch(\guattime[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]) = \epoch(t)-1$,
        we know that $\gjattime[val=v',time=t'] = \guattime[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]$ for any honest validator $v'$ and time $t'$ such that $\epoch(t') = \epoch(t)$.
        Clearly, $b \preceq \LMDGHOSTHFC(\viewattime[val=v',time=t'])$.
        \item[Inductive case: {$\epoch(t') > \epoch(t)$}.] We assume that the Lemma holds for any $t'' \geq t$ such that $\epoch(t'') < \epoch(t')$ and prove that it also holds for $t'$.        
        We will show that $b \preceq \gjattime[val=v',time=t']$. Then, clearly, $b \preceq \LMDGHOSTHFC(\viewattime[val=v',time=t'])$.
        By cases.
        \begin{description}
            \item[Case 1: {$\epoch(\gjattime[val=v',time=t']) = \epoch(\guattime[val=v,time=\slotstart(\firstslot(\epoch(t))-1)])$}.] Clearly, $\gjattime[val=v',time=t'] = \guattime[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]$ in this case, thus $b = \block(\gjattime[val=v',time=t'])$.
            \item[Case 2: {$\epoch(\gjattime[val=v',time=t']) \neq \epoch(\guattime[val=v,time=\slotstart(\firstslot(\epoch(t))-1)])$}.]
            By the definition of the greatest justified checkpoint, $\epoch(\gjattime[val=v',time=t']) \leq \epoch(t')-1$ which implies $\epoch(t) \leq \epoch(\gjattime[val=v',time=t']) \leq \epoch(t'')$ for this case.
            From the inductive hypothesis we know that $b \preceq \LMDGHOSTHFC(\viewattime[val=v',time=t''])$ which implies that during each epoch $e \in \left[\epoch(t), \epoch(t'')\right]$ all honest validators cast their FFG votes in the support of $\chkp(b',e)$ such that $b' \succeq b$.
            Thus, given the synchrony assumption no checkpoint $\chkp'$ conflicting with $b$ such that $\epoch(\chkp') \in \left[\epoch(t), \epoch(t'')\right]$ can ever be justified.
            Given that, we conclude $b \prec \gjattime[val=v',time=t']$.
        \end{description}
        We have show that $b \preceq \gjattime[val=v',time=t']$ which proves that $\canonical[blck={\block(\guattime[val=v,time=\slotstart(\firstslot(\epoch(t))-1)])},time=\slotstartslot{t}]$.

        The other two conclusions follow from the fact that if $C$ is a justified checkpoint such that $\epoch(C) = \epoch(t)-1$, then $C = \guattime[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]$.
    \end{description}
\end{proof}

\begin{lemma}\label{lem:confirmed-end-first-slot-canonical}
    If
    \begin{enumerate}
        \item $\slotstart(\firstslot(\epoch(t))-1)\geq \GST$
        \item  $t = \slotstart(\epoch(t))$
        \item $\epoch(\bconfirmed[val=v,time=\slotstart(\slot(t))])\geq\epoch(t)-1$
        \item if $\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)] \preceq \bconfirmed[val=v,time=\slotstart(\slot(t))]$,
        then  no checkpoint $C$ s.t. $\epoch(C) = \epoch(t)-1$ and $\block(C)$ conflicts with  $\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]$ can ever be justified
        % \item \ref{def:induction-conditions:ub} holds for $\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}$
        % \item \ref{def:induction-conditions:ub} holds for $\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}$
        % \item $\slotstart(\lastslot(\epoch(t)-1)) \geq \GST$
        % \item $\epoch(b_c) \geq \epoch(t)-1$
        % \item $b_c \in \filtered[val=v',time=t']$
    \end{enumerate},
    then, 
    \begin{enumerate}
        \item \sirone, \sirtwo and \sirthree for $\sir(\bconfirmed[val=v,time=\slotstart(\slot(t))],t,\guattime[val=v,time={\slotstart(\slot(\varforvalattime[val=v]{t})-1)}],\cdot)$
        \item $\canonical[blck={\bconfirmed[val=v,time=\slotstart(\slot(t))]},time=t,to=\slotstart(\epoch(t)+1)]$
        \item for any justified checkpiont $C$, $\epoch(C) \in [\epoch(\guattime[time=\slotstart(\firstslot(\epoch(t)-1))]),\epoch(t)-1] \implies C  \preceq \bconfirmed[val=v,time=\slotstart(\slot(t))]$
        \item   for any justified checkpiont $C$, $\epoch(C) \in [\epoch(\guattime[time=\slotstart(\firstslot(\epoch(t)-1))]),\epoch(t)-1] \implies C  \succeq \guattime[time=\slotstart(\firstslot(\epoch(t))-1),val=v]$
    \end{enumerate}
\end{lemma}

\begin{proof}
    Follows from \Cref{lem:code-implications-of-confirmed-block-from-prev-epoch-at-the-beginning-of-epoch,lem:conf-prev-slot-canonical-at-the-start-of-an-epoch,lem:output-find-latest-canonical-canonical-at-the-start-of-an-epoch,lem:gu-e-1-canonical}.
    \RSfn{We might want to explain this a bit more}


    % If $\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)] \preceq \bconfirmed[val=v,time=\slotstart(\slot(t))]$, then apply \Cref{lem:conf-prev-slot-canonical-at-the-start-of-an-epoch,lem:output-find-latest-canonical-canonical-at-the-start-of-an-epoch} to conclude the proof.

    % Otherwise, 
    % It should be easy to conclude from \Cref{lem:conf-prev-slot-canonical-at-the-start-of-an-epoch,lem:output-find-latest-canonical-canonical-at-the-start-of-an-epoch,lem:gu-e-1-canonical}.
\end{proof}

\begin{lemma}\label{lem:if-new-bc-then-output-find-latest}
    Pick any $b_c \in  \varforvalattime[val=v,time=\slotstart(\slot(t))]{\bcands}$
    If
    \begin{enumerate}
        \item $\slot(t) > \firstslot(\epoch(t))$
        \item $\epoch(b_c) \geq \epoch(t)-1$
    \end{enumerate}
    ,then
    \begin{enumerate}
        \item $b_c \neq \varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}  \implies b_c = \varforvalattime[val=v]{\mathit{find\_latest\_confirmed\_descendant}}(\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed})$
        % \item $\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed} \preceq b_c$
    \end{enumerate}
\end{lemma}


\begin{lemma}\label{lem:conf-beginning-epoch-prec-bcand}
    Pick any $b_c \in  \varforvalattime[val=v,time=\slotstart(\slot(t))]{\bcands}$
    If
    \begin{enumerate}
        \item $\slot(t) > \firstslot(\epoch(t))$
        \item $\epoch(b_c) \geq \epoch(t)-1$
    \end{enumerate}
    ,then, for every  $s' \in [\firstslot(\epoch(t)),\slot(t)]$,
    \begin{enumerate}
        \item $\varforvalattime[val=v,time=\slotstart(s')]{\bconfirmed} \preceq b_c$
        \item $\epoch(\varforvalattime[val=v,time=\slotstart(s')]{\bconfirmed}) \geq \epoch(t)-1$
    \end{enumerate}
\end{lemma}

\begin{lemma}\label{lem:canonical-for-current-epoch-with-extra-assum}
    If
    \begin{enumerate}
        \item $\slotstart(\firstslot(\epoch(t))-1)\geq \GST$
        \item  $t = \slotstart(\slot(t))$
        \item $\epoch(\bconfirmed[val=v,time=\slotstart(\slot(t))])\geq\epoch(t)-1$
        \item if $\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)] \preceq \bconfirmed[val=v,time=\slotstart(\slot(t))]$,
        then  no checkpoint $C$ s.t. $\epoch(C) = \epoch(t)-1$ and $\block(C)$ conflicts with  $\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]$ can ever be justified
        % \item \ref{def:induction-conditions:ub} holds for $\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}$
        % \item $\slotstart(\lastslot(\epoch(t)-1)) \geq \GST$
        % \item $\epoch(b_c) \geq \epoch(t)-1$
        % \item $b_c \in \filtered[val=v',time=t']$
    \end{enumerate},
    then,
    \begin{enumerate}
        \item $\canonical[blck={\bconfirmed[val=v,time=\slotstart(\slot(t))]},time=t, to=\slotstart(\epoch(t)+1)]$
    \end{enumerate}
\end{lemma}

\begin{proof}
    % First note that \Cref{lem:conf-beginning-epoch-prec-bcand, lem:output-find-latest-canonical-canonical-at-the-start-of-an-epoch} imp
    By induction on slot $\sind$.
    
    % Also, add the following inductive hypothesis.
    % \begin{enumerate}
    %     \item for any justified checkpiont $C$, $\epoch(C) \in [\epoch(\guattime[time=\slotstart(\firstslot(\epoch(t)-1))]),\epoch(t)-1] \implies C  \preceq \bconfirmed[val=v,time=\slotstart(\sind)]$
    %     \item   for any justified checkpiont $C$, $\epoch(C) \in [\epoch(\guattime[time=\slotstart(\firstslot(\epoch(t)-1))]),\epoch(t)-1] \implies C  \succeq \guattime[time=\slotstart(\firstslot(\epoch(t))-1),val=v]$\RSfn{Even though $\sind$ does not appear here, I list this as an inductive hypothesis here for convenience.}    
    %     % \item $\varforvalattime[val=v,time=\slotstart(\slot(\tind))]{\bconfirmed} \succeq \bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]$
    %     % \item for any honest validators $v'$ and time $t'$ s.t. $\epoch(t') = \epoch(t)$, $\gjattime[time=t',val=v']  \preceq \varforvalattime[val=v,time=\slotstart(\slot(\tind))]{\bconfirmed}$
    %     % \item  for any honest validators $v'$ and time $t'$ s.t. $\epoch(t') = \epoch(t)$, $\gjattime[time=t',val=v']  \succeq \guattime[time=\slotstart(\firstslot(\epoch(t))-1),val=v]$
    % \end{enumerate}
    \begin{description}
        \item[Base Case: $\sind = \firstslot(\epoch(t))$.]  \Cref{lem:confirmed-end-first-slot-canonical} proves the base case.
        \item[Inductive Step: $\sind > \firstslot(\epoch(t))$.] 
        From \Cref{lem:conf-beginning-epoch-prec-bcand}, we know that $\bconfirmed[val=v,time=\slotstart(\sind)] \succeq \varforvalattime[val=v,time=\slotstart(\sind-1)]{\bconfirmed}$.


        If $\varforvalattime[val=v,time=\slotstart(\sind-1)]{\bconfirmed} = \bconfirmed[val=v,time=\slotstart(\sind)]$, then $\canonical[blck={\varforvalattime[val=v,time=\slotstart(\sind)]{\bconfirmed}},time=t, to=\slotstart(\epoch(t)+1)]$ follows by the inductive hypothesis.

        Now, assume $\varforvalattime[val=v,time=\slotstart(\sind-1)]{\bconfirmed} \neq \bconfirmed[val=v,time=\slotstart(\sind)]$.
        From \Cref{lem:if-new-bc-then-output-find-latest,lem:conf-beginning-epoch-prec-bcand}, we know that\\ $\bconfirmed[val=v,time=\slotstart(\sind)]=\mathit{find\_latest\_confirmed\_descendant}(\varforvalattime[val=v,time=\slotstart(\sind-1)]{\bconfirmed})$ and $\bconfirmed[val=v,time=\slotstart(\sind)] \succeq \varforvalattime[val=v,time=\slotstart(\firstslot(\epoch(\sind)))]{\bconfirmed}$.

        Then, \Cref{lem:confirmed-end-first-slot-canonical} implies that
        \begin{enumerate}
            \item for any justified checkpiont $C$, $\epoch(C) \in [\epoch(\guattime[time=\slotstart(\firstslot(\epoch(t)-1))]),\epoch(t)-1] \implies C  \preceq \bconfirmed[val=v,time=\slotstart(\sind)]$
            \item   for any justified checkpiont $C$, $\epoch(C) \in [\epoch(\guattime[time=\slotstart(\firstslot(\epoch(t)-1))]),\epoch(t)-1] \implies C  \succeq \guattime[time=\slotstart(\firstslot(\epoch(t))-1),val=v]$
        \end{enumerate}

        Given that, by the inductive hypothesis, $\canonical[blck={\varforvalattime[val=v,time=\slotstart(\sind-1)]{\bconfirmed}},time=t, to=\slotstart(\epoch(t)+1)]$,
        we can apply \Cref{lem:output-find-latest-canonical-canonical-at-the-start-of-an-epoch} and conclude the proof.



        % \sep

        % From \Cref{lem:conf-beginning-epoch-prec-bcand} and the extra inductive hypothesis, we know that $\bconfirmed[val=v,time=\slotstart(\sind)] \succeq \varforvalattime[val=v,time=\slotstart(\sind-1)]{\bconfirmed}\succeq C$.

        % If $\varforvalattime[val=v,time=\slotstart(\sind-1)]{\bconfirmed} = \bconfirmed[val=v,time=\slotstart(\sind)]$, then $\canonical[blck={\varforvalattime[val=v,time=\slotstart(\sind-1)]{\bconfirmed}},time=t, to=\slotstart(\epoch(t)+1)]$ follows by the inductive hypotheses above.

        % Then, assume $\varforvalattime[val=v,time=\slotstart(\sind-1)]{\bconfirmed} \neq \bconfirmed[val=v,time=\slotstart(\sind)]$.
        % From \Cref{lem:if-new-bc-then-output-find-latest}, we know that\\ $\bconfirmed[val=v,time=\slotstart(\sind)]=\mathit{find\_latest\_confirmed\_descendant}(\varforvalattime[val=v,time=\slotstart(\sind-1)]{\bconfirmed})$.
        % By the inductive hypothses, we also know that $\canonical[blck={\varforvalattime[val=v,time=\slotstart(\sind-1)]{\bconfirmed}},time=t, to=\slotstart(\epoch(t)+1)]$.

        % This, together with the addditional inducive hypotheses allows us to apply \Cref{lem:output-find-latest-canonical-canonical-at-the-start-of-an-epoch} and conclude the proof.
        % \Cref{lem:gj-prec-prev-confirmed-at-start-of-epoch} then implies that $\gjattime[time=t',val=v'] \preceq \varforvalattime[val=v,time=\slotstart(\slot(\tind))]{\bconfirmed}$.


        % We know that 
        % \begin{enumerate}
        %     \item $\mathit{find\_latest\_confirmed\_descendant}$ ensures that\\
        %     $\mathit{isLMDGHOSTSafeFrom}(\varforvalattime[val=v,time=\slotstart(\slot(\tind))]{\bconfirmed},t,\gjattime[val=v,time={\slotstart(\slot(\varforvalattime[val=v]{t})-1)}],\varforvalattime[val=v,time=\slotstart(\slot(t')-1)]{\bconfirmed})$ 
        %     \item  $\gjattime[time=t',val=v'] \preceq \varforvalattime[val=v,time=\slotstart(\slot(\tind))]{\bconfirmed}$ implies that $\gjattime[val=v,time={\slotstart(\slot(\varforvalattime[val=v]{t})-1)}] \preceq \varforvalattime[val=v,time=\slotstart(\slot(\tind))]{\bconfirmed}$.
        %     % \item Given the above, $\block(\guattime[val=v,time={\slotstart(\slot(\varforvalattime[val=v]{t})-1)}])  \preceq b_o$
        % \end{enumerate}
        % Hence, \sirone holds.

        % $\gjattime[time=t',val=v'] \preceq \varforvalattime[val=v,time=\slotstart(\slot(\tind))]{\bconfirmed}$ and
        % \Cref{lem:conf-prev-epoch-then-vs-two-epochs-ago} then imply \ref{def:induction-conditions:all-validators:not-filtered-out}.

        % We know that $\epoch(t)-2\leq\epoch(\guattime[val=v,time={\slotstart(\firstslot(\epoch(t))-1)}])\leq\epoch(\gjattime[val=v,time={\slotstart(\slot(\varforvalattime[val=v]{t})-1)}])\leq\epoch(\gjattime[time=t',val=v'])\leq\epoch(t)-1$.

        % If $\epoch(\gjattime[val=v,time={\slotstart(\slot(\varforvalattime[val=v]{t})-1)}])=\epoch(t)-2$, 
        % then  $\gjattime[val=v,time={\slotstart(\slot(\varforvalattime[val=v]{t})-1)}]= \guattime[val=v,time={\slotstart(\slot({t})-1)}]$.
        % $\sir(b_c,t,\guattime[val=v,time={\slotstart(\slot({t})-1)}],\cdot)$ then implies $\gjattime[time=t',val=v']\succeq \gjattime[val=v,time={\slotstart(\slot(\varforvalattime[val=v]{t})-1)}]$.

        % If $\epoch(\gjattime[val=v,time={\slotstart(\slot(\varforvalattime[val=v]{t})-1)}])=\epoch(t)-1$, 
        % then  $\gjattime[time=t',val=v'] = \gjattime[val=v,time={\slotstart(\slot(\varforvalattime[val=v]{t})-1)}]$.
        % Hence, \ref{def:induction-conditions:all-validators:gj-succ} holds.


        % % $\sir(b_c,t,\guattime[val=v,time={\slotstart(\slot({t})-1)}],\cdot)$ clearly implies \ref{def:induction-conditions:all-validators:gj-succ}$(b_o,t,\guattime[val=v,time={\slotstart(\slot(\varforvalattime[val=v]{t})-1)}],b_c)$.

        % % \ref{def:induction-conditions:all-validators:gj-succ-cs} is clearly implied by the Lemma's assumptions.

        % % % \ref{def:induction-conditions:ub} is cleraly implied by the Lemma's assumptions.

        % \sirfive can be proven as in the proof of \Cref{lem:conf-prev-slot-canonical-at-the-start-of-an-epoch}: from the proof of the previous conditions, we can conclude that $\canonical[time=t,blck={\varforvalattime[val=v,time=\slotstart(\slot(\tind))]{\bconfirmed}},to=\slotstart(\epoch(t)+1)]$ from which we can prove that  no checkpoint for epoch $\epoch(t) = \epoch(b_o)+1$ conflicting with ${\varforvalattime[val=v,time=\slotstart(\slot(\tind))]{\bconfirmed}}$ can ever be justified.
        % \ref{def:induction-conditions:ub} holding for ${\varforvalattime[val=v,time=\slotstart(\slot(\tind))]{\bconfirmed}}$ implies \sirfive  for epoch $\epoch(b) = \epoch(t)-1$, 
    \end{description}
\end{proof}

\begin{lemma}\label{lem:no-conflicting-to-c-b-at-the-start-of-an-epoch}
    % Pick any $b_c \in  \varforvalattime[val=v,time=\slotstart(\slot(t))]{\bcands}$, any time $t' \geq \slotstartslot{t}$ and any honest validator $v'$.
    If
    \begin{enumerate}
        \item $\slotstart(\firstslot(\epoch(t)-1)-1)\geq \GST$
        \item  $t = \slotstart(\epoch(t))$
        \item\label{itm:lem:no-conflicting-to-c-b-at-the-start-of-an-epoch:3} the \KwSty{if} condition at line \Cref{ln:if-bcand-npreceq-head} is false
        % \item\label{itm:lem:conf-prev-slot-canonical-at-the-start-of-an-epoch:4} \ref{def:induction-conditions:ub} holds for $\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]$
        % \item $\slotstart(\lastslot(\epoch(t)-1)) \geq \GST$
        % \item $\epoch(b_c) \geq \epoch(t)-1$
        % \item $b_c \in \filtered[val=v',time=t']$
    \end{enumerate},
    then
    \begin{enumerate}
        \item\label{itm:lem:no-conflicting-to-c-b-at-the-start-of-an-epoch:conc1}  for any block $b' \succeq \chkp(\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)])$ and time $t' \geq \slotstart(\epoch(t))$,$\weightofset[chkp=b']{\ffgvalsetallsentraw[source=,target={\chkp(\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)])},time=t'] \setminus \slashedset[chkp=b']} \geq \frac{2}{3}\totvalsetweight[chkp=b'] {\allvals}$
        \item\label{itm:lem:no-conflicting-to-c-b-at-the-start-of-an-epoch:conc2} no checkpoint $C$ s.t. $\epoch(C) = \epoch(t)-1$ and $\block(C)$ conflicts with $\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]$ can ever be justified
        % \item  if $\epoch(\guattime[time=\slotstart(\firstslot(\epoch(t))-1),val=v]) \neq \epoch(t)-1$, then there exists a time $t' \in \{\slotstart(s): s \in [\firstslot(\epoch(t)-1),\lastslot(\epoch(t)-1)]\}$ such that
        % \begin{enumerate}
        %     \item  $\varforvalattime[val=v,time=t']{\willChkpBeJustified}(\bconfirmed[val=v,time=t'])$.
        %     \item $\canonical[blck={\bconfirmed[val=v,time=t']},time=t',to=\slotstart(\epoch(t))]$
        %     \item $\bconfirmed[val=v,time=t'] \preceq \bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]$
        %     \item $\epoch(\bconfirmed[val=v,time=t']) = \epoch(t)-1$
        % \end{enumerate}
    \end{enumerate}
\end{lemma}

\begin{proof}
    Conclusion~\ref{itm:lem:no-conflicting-to-c-b-at-the-start-of-an-epoch:conc2} is implied by conclusion~\ref{itm:lem:no-conflicting-to-c-b-at-the-start-of-an-epoch:conc1}.
    So, we just prove the latter.
    Because of condition~\ref{itm:lem:no-conflicting-to-c-b-at-the-start-of-an-epoch:3},
    we know that $\epoch(\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)])\geq\epoch(t)-1$. 
    From \Cref{lem:no-curr-epochconflict-chkp-is-justified}, we know that there exists a time $t' \in \{\slotstart(s): s \in [\firstslot(\epoch(t)-1),\lastslot(\epoch(t)-1)]\}$ such that $\varforvalattime[val=v,time=t']{\willChkpBeJustified}(\bconfirmed[val=v,time=t'])$ and $\epoch(\bconfirmed[val=v,time=t'] ) = \epoch(t)-1$.
    \Cref{lem:conf-beginning-epoch-prec-bcand} then implies that $\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)] \preceq \bconfirmed[val=v,time=t'] \preceq \bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]$ and $\epoch(\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)] ) \geq \epoch(t)-2$.

    Then, given Lemma 13 of the paper, to conclude the proof it is sufficient to prove that  $\canonical[blck={\bconfirmed[val=v,time=t']},time=t',to=\slotstart(\epoch(t))]$.

    Now, if  $\varforvalattime[val=v,time=\slotstart(\firstslot(\epoch(t)-1)-1)]{\bconfirmed} \npreceq \bconfirmed[val=v,time=t']$, then we can apply \Cref{lem:canonical-for-current-epoch-with-extra-assum} to conclude that $\canonical[blck={\bconfirmed[val=v,time=t']},time=t',to=\slotstart(\epoch(t))]$.

    Then, assume that $\varforvalattime[val=v,time=\slotstart(\firstslot(\epoch(t)-1)-1)]{\bconfirmed} \preceq \bconfirmed[val=v,time=t']$.
    In this case, to apply \Cref{lem:canonical-for-current-epoch-with-extra-assum} we need to show that no checkpoint $C$ s.t. $\epoch(C) = \epoch(t)-2$ and $\block(C)$ conflicts with  $\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t)-1)-1)]$ can ever be justified.
    Then, let $C$ be a justified checkpoint such that $\epoch(C)=\epoch(t)-2$.
    This implies that $C = \guattime[time=\slotstart(\firstslot(\epoch(t))-1),val=v]$.
    From condition~\ref{itm:lem:no-conflicting-to-c-b-at-the-start-of-an-epoch:3},
    we know that $\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t)-1))] \succeq \guattime[time=\slotstart(\firstslot(\epoch(t))-1),val=v]$.
    Given that $\varforvalattime[val=v,time=\slotstart(\firstslot(\epoch(t)-1)-1)]{\bconfirmed} \preceq \bconfirmed[val=v,time=t'] \preceq \bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t)-1))]$, we can conclude that $\block(C)$ does not conflict with 
    $\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t)-1)-1)]$    
    
    
    % Then, from \Cref{lem:epoch-gu-less-than-two-epoch-ago-start-epoch} we know that $\epoch(\guattime[time=\slotstart(\firstslot(\epoch(t))-1),val=v]) \in \{\epoch(t)-2,\epoch(t)-1\}$.

    % Let $C$ be a justified checkpoint such that $\epoch(C) = \epoch(t)-1$.
    % If $\epoch(\guattime[time=\slotstart(\firstslot(\epoch(t))-1),val=v]) = \epoch(t)-1$, then we are done as $\guattime[time=\slotstart(\firstslot(\epoch(t))-1),val=v] = C$ and, from condition~\ref{itm:lem:no-conflicting-to-c-b-at-the-start-of-an-epoch:3}, we know that $\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)] \succeq \guattime[time=\slotstart(\firstslot(\epoch(t))-1),val=v] = C$.

    % Now, assume $\epoch(\guattime[time=\slotstart(\firstslot(\epoch(t))-1),val=v]) = \epoch(t)-2$.
\end{proof}

\begin{lemma}\label{lem:helper-hard-to-name}
    If
    \begin{enumerate}
        \item $\slotstart(\firstslot(\epoch(t)-1)-1)\geq \GST$
        \item  $t = \slotstart(\epoch(t))$
        \item $\epoch(b_c) = \epoch(t)-1$
        \item either
        \begin{enumerate}
            \item  the \KwSty{if} condition at line \Cref{ln:if-bcand-npreceq-head} is false and $b_c \succeq \bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]$.
            \item $\exists b' \succeq b_c, \gu(b') = \chkp(b_c)$
            % \item $b_c \succeq \block(\guattime[time=\slotstart(\firstslot(\epoch(t))-1),val=v])$ and $\epoch(\guattime[time=\slotstart(\firstslot(\epoch(t))-1),val=v]) = \epoch(t)-1$
        \end{enumerate}
        \item \label{itm:lem:helper-hard-to-name:cond6} $\canonical[blck={b_c},time=t,to=\slotstart(\epoch(t)+1)]$
        \item \sirone, \sirtwo and \sirthree for $\sir(b_c,t,\guattime[val=v,time={\slotstart(\firstslot(\epoch(t))-1)}],\block(\guattime[val=v,time={\slotstart(\slot(\varforvalattime[val=v]{t})-1)}]))$ hold 
        % \item for any justified checkpiont $C$, $\epoch(C) \in [\epoch(\guattime[time=\slotstart(\firstslot(\epoch(t)-1))]),\epoch(t)-1] \implies C  \succeq \guattime[time=\slotstart(\firstslot(\epoch(t))-1),val=v]$,


    \end{enumerate},
    then
    \begin{enumerate}
        \item $\sir(b_c,t,\guattime[val=v,time={\slotstart(\firstslot(\epoch(t))-1)}],\block(\guattime[val=v,time={\slotstart(\firstslot(\epoch(t))-1)}]))$ holds
        % \item no checkpoint $C$ s.t. $\epoch(C) = \epoch(t)-1$ and $\block(C)$ conflicts with $\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]$ can ever be justified
        % \item for any honest validators $v'$ and time $t'$ s.t. $\epoch(t') = \epoch(t)$, $\gjattime[time=t',val=v']  \preceq \bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]$
        % \item for any justified checkpiont $C$, $\epoch(C) \in [\epoch(\guattime[time=\slotstart(\firstslot(\epoch(t)-1))]),\epoch(t)-1] \implies C  \succeq \guattime[time=\slotstart(\firstslot(\epoch(t))-1),val=v]$
        \item $\canonical[blck={b_c},time=t]$
    \end{enumerate}
\end{lemma}

\begin{proof}
    By cases.
    \begin{description}[style=nextline]
        % \item[{\parbox[t]{\linewidth}{Case 1: the \KwSty{if} condition at line \Cref{ln:if-bcand-npreceq-head} is false and $b_c \succeq {{\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]}}$ and $\epoch({\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]}) = \epoch(t)-1$.}}] \hfill\\
        \item[Case 1: the \KwSty{if} condition at line \Cref{ln:if-bcand-npreceq-head} is false and $b_c \succeq {{\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]}}$ and $\epoch({\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]}) = \epoch(t)-1$.] 
        This case implies that $\chkp(b_c) = \chkp(\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)])$.
        % \leavevmode
        This, Lemma's conditions~\ref{itm:lem:helper-hard-to-name:cond6} and \Cref{lem:no-conflicting-to-c-b-at-the-start-of-an-epoch} allows us to to apply \Cref{assm:bcand-chkp-in-allu} to conclude \ref{def:induction-conditions:ub}.

        Given that $\epoch(b_c) = \epoch(\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]) = \epoch(t)-1$,
        \Cref{lem:no-conflicting-to-c-b-at-the-start-of-an-epoch} also implies that no justified checkpoint $C$ with $\epoch(C)=\epoch(t)-1$ and $\block(C)$ conflicting with $b_c$ can exists.



        
        \item[Case 2: $\exists b' \succeq b_c, \gu(b') = \chkp(b_c)$.] 
        Given that $\epoch(b_c) = \epoch(t)-1$, \sirfour clearly holds in this case.
        Also, clearly no justified checkpoint $C$ with $\epoch(C)=\epoch(t)-1$ and $\block(C)$ conflicting with $b_c$ can exists.
    \end{description}

    Given the above, \Cref{lem:no-conflicting-to-c-b-at-the-start-of-an-epoch} and $\canonical[blck={b_c},time=t,to=\slotstart(\epoch(t)+1)]$ also imply \sirfive.

    Now, \Cref{lem:ffg-safety-from-sir} imply  $\canonical[blck={b_c},time=t]$.

    % Finally, \Cref{lem:no-conflicting-to-c-b-at-the-start-of-an-epoch} also implies that no checkpoint $C$ s.t. $\epoch(C) = \epoch(t)-1$ and $\block(C)$ conflicts with $\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]$ can ever be justified

    % \sep

    % \Cref{lem:no-conflicting-to-c-b-at-the-start-of-an-epoch} also implies that there exists a time $t' \in \{\slotstart(s): s \in [\firstslot(\epoch(t)-1),\lastslot(\epoch(t)-1)]\}$ such that
    %     \begin{enumerate}
    %         \item  $\varforvalattime[val=v,time=t']{\willChkpBeJustified}(\bconfirmed[val=v,time=t'])$.
    %         \item $\canonical[blck={\bconfirmed[val=v,time=t']},time=t',to=\slotstart(\epoch(t))]$
    %         \item $\bconfirmed[val=v,time=t'] \preceq \bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]$
    %         \item $\epoch(\bconfirmed[val=v,time=t']) = \epoch(t)-1$
    %     \end{enumerate}

    % The above implies that $\chkp(\bconfirmed[val=v,time=t']) = \chkp(\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)])$.
    % All of this together with $\canonical[blck={\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]},time=t,to=\slotstart(\epoch(t)+1)]$ allows us to apply \Cref{assm:bcand-chkp-in-allu} to conclude \ref{def:induction-conditions:ub}.

    %  \Cref{lem:no-conflicting-to-c-b-at-the-start-of-an-epoch} and $\canonical[blck={\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]},time=t,to=\slotstart(\epoch(t)+1)]$ also imply \sirfive.

    % Now, \Cref{lem:ffg-safety-from-sir} imply  $\canonical[blck={\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]},time=t]$    
\end{proof}

\begin{lemma}\label{lem:conf-prev-slot-canonical-at-the-start-of-an-epoch-no-extra-assum}
    % Pick any $b_c \in  \varforvalattime[val=v,time=\slotstart(\epoch(t))]{\bcands}$, any time $t' \geq \slotstartslot{t}$ and any honest validator $v'$.
    If
    \begin{enumerate}
        \item $\slotstart(\firstslot(\epoch(t)-1)-1)\geq \GST$
        \item  $t = \slotstart(\epoch(t))$
        \item\label{itm:lem:conf-at-the-start-of-an-epoch-no-extra-assum:cond3} the \KwSty{if} condition at line \Cref{ln:if-bcand-npreceq-head} is false
        % \item\label{itm:lem:conf-prev-slot-canonical-at-the-start-of-an-epoch:4} \ref{def:induction-conditions:ub} holds for $\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]$
        % \item $\slotstart(\lastslot(\epoch(t)-1)) \geq \GST$
        % \item $\epoch(b_c) \geq \epoch(t)-1$
        % \item $b_c \in \filtered[val=v',time=t']$
    \end{enumerate},
    then
    \begin{enumerate}
        \item $\sir(\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)],t,\guattime[val=v,time={\slotstart(\firstslot(\epoch(t))-1)}],\block(\guattime[val=v,time={\slotstart(\slot(\varforvalattime[val=v]{t})-1)}]))$ holds
        \item no checkpoint $C$ s.t. $\epoch(C) = \epoch(t)-1$ and $C$ conflicts with $\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]$ can ever be justified
        % \item for any honest validators $v'$ and time $t'$ s.t. $\epoch(t') = \epoch(t)$, $\gjattime[time=t',val=v']  \preceq \bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]$
        \item for any justified checkpiont $C$, $\epoch(C) \in [\epoch(\guattime[time=\slotstart(\firstslot(\epoch(t)-1))]),\epoch(t)-1] \implies C  \preceq \bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]$
        \item for any justified checkpiont $C$, $\epoch(C) \in [\epoch(\guattime[time=\slotstart(\firstslot(\epoch(t)-1))]),\epoch(t)-1] \implies C  \succeq \guattime[time=\slotstart(\firstslot(\epoch(t))-1),val=v]$
        \item $\canonical[blck={\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]},time=t]$
    \end{enumerate}
\end{lemma}

\begin{proof}
    \Cref{lem:no-conflicting-to-c-b-at-the-start-of-an-epoch} proves that no checkpoint $C$ s.t. $\epoch(C) = \epoch(t)-1$ and $\block(C)$ conflicts with $\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]$ can ever be justified,
    which
    allows us to apply
    \Cref{lem:conf-prev-slot-canonical-at-the-start-of-an-epoch} which implies that
    \begin{enumerate}
        \item \sirone, \sirtwo and \sirthree for $\sir(\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)],t,\guattime[val=v,time={\slotstart(\firstslot(\epoch(t))-1)}],\block(\guattime[val=v,time={\slotstart(\slot(\varforvalattime[val=v]{t})-1)}]))$ hold,  
        \item for any justified checkpiont $C$, $\epoch(C) \in [\epoch(\guattime[time=\slotstart(\firstslot(\epoch(t)-1))]),\epoch(t)-1] \implies C  \succeq \guattime[time=\slotstart(\firstslot(\epoch(t))-1),val=v]$,
        \item for any justified checkpiont $C$, $\epoch(C) \in [\epoch(\guattime[time=\slotstart(\firstslot(\epoch(t)-1))]),\epoch(t)-1] \implies C  \preceq \bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]$
        \item $\canonical[blck={\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]},time=t,to=\slotstart(\epoch(t)+1)]$
    \end{enumerate}

    % \Cref{lem:no-conflicting-to-c-b-at-the-start-of-an-epoch} also implies that there exists a time $t' \in \{\slotstart(s): s \in [\firstslot(\epoch(t)-1),\lastslot(\epoch(t)-1)]\}$ such that
    %     \begin{enumerate}
    %         \item  $\varforvalattime[val=v,time=t']{\willChkpBeJustified}(\bconfirmed[val=v,time=t'])$.
    %         \item $\canonical[blck={\bconfirmed[val=v,time=t']},time=t',to=\slotstart(\epoch(t))]$
    %         \item $\bconfirmed[val=v,time=t'] \preceq \bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]$
    %         \item $\epoch(\bconfirmed[val=v,time=t']) = \epoch(t)-1$
    %     \end{enumerate}
    Then, apply \Cref{lem:helper-hard-to-name} to conclude the proof.
    % The above implies that $\chkp(\bconfirmed[val=v,time=t']) = \chkp(\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)])$.
    % All of this together with $\canonical[blck={\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]},time=t,to=\slotstart(\epoch(t)+1)]$ allows us to apply \Cref{assm:bcand-chkp-in-allu} to conclude \ref{def:induction-conditions:ub}.

    %  \Cref{lem:no-conflicting-to-c-b-at-the-start-of-an-epoch} and $\canonical[blck={\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]},time=t,to=\slotstart(\epoch(t)+1)]$ also imply \sirfive.

    % Now, \Cref{lem:ffg-safety-from-sir} imply  $\canonical[blck={\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]},time=t]$
    % Then, given $\bconfirmed[val=v,time=t'] \preceq \bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]$ and  $\canonical[blck={\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]},time=t,to=\slotstart(\epoch(t)+1)]$, $\canonical[blck={\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]},time=t,to=\slotstart(\epoch(t)+1)]$.
\end{proof}

% \begin{lemma}\label{lem:conf-prev-slot-canonical-at-the-start-of-an-epoch-no-extra-assum}
%     % Pick any $b_c \in  \varforvalattime[val=v,time=\slotstart(\epoch(t))]{\bcands}$, any time $t' \geq \slotstartslot{t}$ and any honest validator $v'$.
%     If
%     \begin{enumerate}
%         \item $\slotstart(\firstslot(\epoch(t)-1)-1)\geq \GST$
%         \item  $t = \slotstart(\epoch(t))$
%         \item the \KwSty{if} condition at line \Cref{ln:if-bcand-npreceq-head} is false
%         % \item\label{itm:lem:conf-prev-slot-canonical-at-the-start-of-an-epoch:4} \ref{def:induction-conditions:ub} holds for $\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]$
%         % \item $\slotstart(\lastslot(\epoch(t)-1)) \geq \GST$
%         % \item $\epoch(b_c) \geq \epoch(t)-1$
%         % \item $b_c \in \filtered[val=v',time=t']$
%     \end{enumerate},
%     then
%     \begin{enumerate}
%         \item $\sir(\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)],t,\guattime[val=v,time={\slotstart(\firstslot(\epoch(t))-1)}],\block(\guattime[val=v,time={\slotstart(\slot(\varforvalattime[val=v]{t})-1)}]))$ holds
%         \item no checkpoint $C$ s.t. $\epoch(C) = \epoch(t)-1$ and $C$ conflicts with $\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]$ can ever be justified
%         % \item for any honest validators $v'$ and time $t'$ s.t. $\epoch(t') = \epoch(t)$, $\gjattime[time=t',val=v']  \preceq \bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]$
%         \item for any justified checkpiont $C$, $\epoch(C) \in [\epoch(\guattime[time=\slotstart(\firstslot(\epoch(t)-1))]),\epoch(t)-1] \implies C  \succeq \guattime[time=\slotstart(\firstslot(\epoch(t))-1),val=v]$
%         \item $\canonical[blck={\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]},time=t]$
%         \item  there exists a time $t' \in \{\slotstart(s): s \in [\firstslot(\epoch(t)-1),\lastslot(\epoch(t)-1)]\}$ such that
%         \begin{enumerate}
%             \item  $\varforvalattime[val=v,time=t']{\willChkpBeJustified}(\bconfirmed[val=v,time=t'])$.
%             \item $\canonical[blck={\bconfirmed[val=v,time=t']},time=t',to=\slotstart(\epoch(t)+1)]$
%             \item $\bconfirmed[val=v,time=t'] \preceq \bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]$
%             \item $\epoch(\bconfirmed[val=v,time=t']) = \epoch(t)-1$
%         \end{enumerate}
%     \end{enumerate}
% \end{lemma}

% \begin{proof}
%     \Cref{lem:no-conflicting-to-c-b-at-the-start-of-an-epoch} allows us to apply
%     \Cref{lem:conf-prev-slot-canonical-at-the-start-of-an-epoch} which implies that (i) \sirone, \sirtwo and \sirthree for $\sir(\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)],t,\guattime[val=v,time={\slotstart(\firstslot(\epoch(t))-1)}],\block(\guattime[val=v,time={\slotstart(\slot(\varforvalattime[val=v]{t})-1)}]))$ hold,  
%     (ii) for any justified checkpiont $C$, $\epoch(C) \in [\epoch(\guattime[time=\slotstart(\firstslot(\epoch(t)-1))]),\epoch(t)-1] \implies C  \succeq \guattime[time=\slotstart(\firstslot(\epoch(t))-1),val=v]$,
%     and (iii) $\canonical[blck={\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]},time=t,to=\slotstart(\epoch(t)+1)]$

%     \Cref{lem:no-conflicting-to-c-b-at-the-start-of-an-epoch} also implies that there exists a time $t' \in \{\slotstart(s): s \in [\firstslot(\epoch(t)-1),\lastslot(\epoch(t)-1)]\}$ such that
%         \begin{enumerate}
%             \item  $\varforvalattime[val=v,time=t']{\willChkpBeJustified}(\bconfirmed[val=v,time=t'])$.
%             \item $\canonical[blck={\bconfirmed[val=v,time=t']},time=t',to=\slotstart(\epoch(t))]$
%             \item $\bconfirmed[val=v,time=t'] \preceq \bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]$
%             \item $\epoch(\bconfirmed[val=v,time=t']) = \epoch(t)-1$
%         \end{enumerate}

%     The above implies that $\chkp(\bconfirmed[val=v,time=t']) = \chkp(\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)])$.
%     All of this together with $\canonical[blck={\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]},time=t,to=\slotstart(\epoch(t)+1)]$ allows us to apply \Cref{assm:bcand-chkp-in-allu} to conclude \ref{def:induction-conditions:ub}.

%      \Cref{lem:no-conflicting-to-c-b-at-the-start-of-an-epoch} and $\canonical[blck={\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]},time=t,to=\slotstart(\epoch(t)+1)]$ also imply \sirfive.

%     Now, \Cref{lem:ffg-safety-from-sir} imply  $\canonical[blck={\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]},time=t]$
%     % Then, given $\bconfirmed[val=v,time=t'] \preceq \bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]$ and  $\canonical[blck={\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]},time=t,to=\slotstart(\epoch(t)+1)]$, $\canonical[blck={\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]},time=t,to=\slotstart(\epoch(t)+1)]$.
% \end{proof}

% \begin{lemma}\label{lem:output-find-latest-canonical-canonical-at-the-start-of-an-epoch-for-ever}
%     % Pick any $b_c \in  \varforvalattime[val=v,time=\slotstart(\epoch(t))]{\bcands}$, any time $t' \geq \slotstartslot{t}$ and any honest validator $v'$.
%     If
%     \begin{enumerate}
%         \item $\slotstart(\firstslot(\epoch(t)-1)-1)\geq \GST$
%         \item  $t = \slotstart(\epoch(t))$
%         \item\label{itm:lem:output-find-latest-canonical-canonical-at-the-start-of-an-epoch-for-ever:cond3} the \KwSty{if} condition at line \Cref{ln:if-bcand-npreceq-head} is false
%         % \item\label{itm:lem:conf-prev-slot-canonical-at-the-start-of-an-epoch:4} \ref{def:induction-conditions:ub} holds for $\bconfirmed[val=v,time=\slotstart(\epoch(t))]$
%         % \item $\slotstart(\lastslot(\epoch(t)-1)) \geq \GST$
%         % \item $\epoch(b_c) \geq \epoch(t)-1$
%         % \item $b_c \in \filtered[val=v',time=t']$
%     \end{enumerate},
%     then
%     \begin{enumerate}
%         \item $\sir(\bconfirmed[val=v,time=\slotstart(\epoch(t))],t,\guattime[val=v,time={\slotstart(\firstslot(\epoch(t))-1)}],\block(\guattime[val=v,time={\slotstart(\slot(\varforvalattime[val=v]{t})-1)}]))$ holds
%         \item no checkpoint $C$ s.t. $\epoch(C) = \epoch(t)-1$ and $C$ conflicts with $\bconfirmed[val=v,time=\slotstart(\epoch(t))]$ can ever be justified
%         % \item for any honest validators $v'$ and time $t'$ s.t. $\epoch(t') = \epoch(t)$, $\gjattime[time=t',val=v']  \preceq \bconfirmed[val=v,time=\slotstart(\epoch(t))]$
%         \item for any justified checkpiont $C$, $\epoch(C) \in [\epoch(\guattime[time=\slotstart(\firstslot(\epoch(t)-1))]),\epoch(t)-1] \implies C  \preceq \bconfirmed[val=v,time=\slotstart(\epoch(t))]$
%         \item for any justified checkpiont $C$, $\epoch(C) \in [\epoch(\guattime[time=\slotstart(\firstslot(\epoch(t)-1))]),\epoch(t)-1] \implies C  \succeq \guattime[time=\slotstart(\firstslot(\epoch(t))-1),val=v]$
%         \item $\canonical[blck={\bconfirmed[val=v,time=\slotstart(\epoch(t))]},time=t]$
%     \end{enumerate}
% \end{lemma}

% \begin{proof}
%     Lemma's condition~\ref {itm:lem:output-find-latest-canonical-canonical-at-the-start-of-an-epoch-for-ever:cond3}  imply that $\bconfirmed[val=v,time=\slotstart(\epoch(t))] = \varforvalattime[val=v]{\mathit{find\_latest\_confirmed\_descendant}}(\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)])$.

%     \Cref{lem:conf-prev-slot-canonical-at-the-start-of-an-epoch-no-extra-assum} implies hat that no checkpoint $C$ s.t. $\epoch(C) = \epoch(t)-1$ and $\block(C)$ conflicts with $\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]$ can ever be justified,which also allows us to apply
%     \Cref{lem:output-find-latest-canonical-canonical-at-the-start-of-an-epoch} which implies that
%     \begin{enumerate}
%         \item \sirone, \sirtwo and \sirthree for $\sir(\bconfirmed[val=v,time=\slotstart(\epoch(t))],t,\guattime[val=v,time={\slotstart(\firstslot(\epoch(t))-1)}],\block(\guattime[val=v,time={\slotstart(\slot(\varforvalattime[val=v]{t})-1)}]))$ hold,  
%         \item for any justified checkpiont $C$, $\epoch(C) \in [\epoch(\guattime[time=\slotstart(\firstslot(\epoch(t)-1))]),\epoch(t)-1] \implies C  \succeq \guattime[time=\slotstart(\firstslot(\epoch(t))-1),val=v]$,
%         \item for any justified checkpiont $C$, $\epoch(C) \in [\epoch(\guattime[time=\slotstart(\firstslot(\epoch(t)-1))]),\epoch(t)-1] \implies C  \preceq \bconfirmed[val=v,time=\slotstart(\epoch(t))]$
%         \item $\canonical[blck={\bconfirmed[val=v,time=\slotstart(\epoch(t))]},time=t,to=\slotstart(\epoch(t)+1)]$
%     \end{enumerate}

%     Then, apply \Cref{lem:helper-hard-to-name} to conclude the proof.
% \end{proof}

\begin{lemma}\label{lem:confirmed-end-first-slot-canonical-no-extra-assum}
    If
    \begin{enumerate}
        \item $\slotstart(\firstslot(\epoch(t)-1)-1)\geq \GST$
        \item  $t = \slotstart(\epoch(t))$
        \item $\epoch(\bconfirmed[val=v,time=\slotstart(\epoch(t))])=\epoch(t)-1$
        % \item if $\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)] \preceq \bconfirmed[val=v,time=\slotstart(\slot(t))]$,
        % then no checkpoint $C$ s.t. $\epoch(C) = \epoch(\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)])$ and $C \neq \chkp(\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)])$ can ever be justified
        % \item \ref{def:induction-conditions:ub} holds for $\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}$
        % \item \ref{def:induction-conditions:ub} holds for $\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}$
        % \item $\slotstart(\lastslot(\epoch(t)-1)) \geq \GST$
        % \item $\epoch(b_c) \geq \epoch(t)-1$
        % \item $b_c \in \filtered[val=v',time=t']$
    \end{enumerate},
    then, 
    \begin{enumerate}
        \item $\sir(\bconfirmed[val=v,time=\slotstart(\epoch(t))],t,\guattime[val=v,time={\slotstart(\slot(\varforvalattime[val=v]{t})-1)}],\block(\guattime[val=v,time={\slotstart(\slot(\varforvalattime[val=v]{t})-1)}]))$
        \item $\canonical[blck={\bconfirmed[val=v,time=\slotstart(\epoch(t))]},time=t]$
        \item for any justified checkpiont $C$, $\epoch(C) \in [\epoch(\guattime[time=\slotstart(\firstslot(\epoch(t)-1))]),\epoch(t)-1] \implies C  \succeq \guattime[time=\slotstart(\firstslot(\epoch(t))-1),val=v]$,
        \item for any justified checkpiont $C$, $\epoch(C) \in [\epoch(\guattime[time=\slotstart(\firstslot(\epoch(t)-1))]),\epoch(t)-1] \implies C  \preceq \bconfirmed[val=v,time=\slotstart(\epoch(t))]$
        \item no checkpoint $C$ s.t. $\epoch(C) = \epoch(t)-1$ and $C$ conflicts with $\bconfirmed[val=v,time=\slotstart(\epoch(t))]$ can ever be justified
    \end{enumerate}
\end{lemma}

\begin{proof}
    Below we prove that (i) no checkpoint $C$ s.t. $\epoch(C) = \epoch(t)-1$ and $C$ conflicts with $\bconfirmed[val=v,time=\slotstart(\epoch(t))]$ can ever be justified and (ii) we can apply
    \Cref{lem:output-find-latest-canonical-canonical-at-the-start-of-an-epoch} to conclude that
    \begin{enumerate}
        \item \sirone, \sirtwo and \sirthree for $\sir(\bconfirmed[val=v,time=\slotstart(\epoch(t))],t,\guattime[val=v,time={\slotstart(\firstslot(\epoch(t))-1)}],\block(\guattime[val=v,time={\slotstart(\slot(\varforvalattime[val=v]{t})-1)}]))$ hold,  
        \item for any justified checkpiont $C$, $\epoch(C) \in [\epoch(\guattime[time=\slotstart(\firstslot(\epoch(t)-1))]),\epoch(t)-1] \implies C  \succeq \guattime[time=\slotstart(\firstslot(\epoch(t))-1),val=v]$,
        \item for any justified checkpiont $C$, $\epoch(C) \in [\epoch(\guattime[time=\slotstart(\firstslot(\epoch(t)-1))]),\epoch(t)-1] \implies C  \preceq \bconfirmed[val=v,time=\slotstart(\epoch(t))]$
        \item $\canonical[blck={\bconfirmed[val=v,time=\slotstart(\epoch(t))]},time=t,to=\slotstart(\epoch(t)+1)]$
    \end{enumerate}


    \Cref{lem:code-implications-of-confirmed-block-from-prev-epoch-at-the-beginning-of-epoch} implies that 
$\bconfirmed[val=v,time=\slotstart(\epoch(t))] = \varforvalattime[val=v]{\mathit{find\_latest\_confirmed\_descendant}}(\block(\guattime[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]))$.

    % Then, again per \Cref{lem:code-implications-of-confirmed-block-from-prev-epoch-at-the-beginning-of-epoch}, we can proceed by the following cases to prove that we can apply  \Cref{lem:output-find-latest-canonical-canonical-at-the-start-of-an-epoch}.

    Per \Cref{lem:code-implications-of-confirmed-block-from-prev-epoch-at-the-beginning-of-epoch}, we can proceed by the following cases.
    \begin{description}[style=nextline]
        \item[Case 1:  the \KwSty{if} condition at line \Cref{ln:if-bcand-npreceq-head} is false 
        and\\${\bconfirmed[val=v,time=\slotstart(\epoch(t))]} = {\varforvalattime[val=v]{\mathit{find\_latest\_confirmed\_descendant}}(\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)])}$.]   
        
        % Lemma's condition~\ref {itm:lem:output-find-latest-canonical-canonical-at-the-start-of-an-epoch-for-ever:cond3}  imply that $\bconfirmed[val=v,time=\slotstart(\epoch(t))] = \varforvalattime[val=v]{\mathit{find\_latest\_confirmed\_descendant}}(\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)])$.

        Given that $\bconfirmed[time=\slotstart(\epoch(t)),val=v]\succeq \bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]$, \Cref{lem:conf-prev-slot-canonical-at-the-start-of-an-epoch-no-extra-assum} implies hat that no checkpoint $C$ s.t. $\epoch(C) = \epoch(t)-1$ and $\block(C)$ conflicts with $\bconfirmed[val=v,time=\slotstart(\epoch(t))]$ can ever be justified.
        It also allows us to apply \Cref{lem:output-find-latest-canonical-canonical-at-the-start-of-an-epoch}.


        \item[Case 2: {$\guattime[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]=\chkp(\bconfirmed[val=v,time=\slotstart(\epoch(t))])$ and\\ 
        $\bconfirmed[val=v,time=\slotstart(\epoch(t))] = \varforvalattime[val=v]{\mathit{find\_latest\_confirmed\_descendant}}(\block(\guattime[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]))$ and $\exists b' \succeq \bconfirmed[val=v,time=\slotstart(\epoch(t))], \gu(b')=\chkp(\bconfirmed[val=v,time=\slotstart(\epoch(t))])$}.]
        This case clarly implies that no checkpoint $C$ s.t. $\epoch(C) = \epoch(t)-1$ and $\block(C)$ conflicts with $\bconfirmed[val=v,time=\slotstart(\epoch(t))]$ can ever be justified.
        \Cref{lem:gu-e-1-canonical} allows us to apply \Cref{lem:output-find-latest-canonical-canonical-at-the-start-of-an-epoch}.
    \end{description}

    Now, we can apply \Cref{lem:helper-hard-to-name} to conclude the proof.
\end{proof}

\begin{lemma}\label{lem:canonical-no-extra-assum}
    If
    \begin{enumerate}
        \item $\slotstart(\firstslot(\epoch(t))-1)\geq \GST$
        \item  $t = \slotstart(\slot(t))$
        \item $\epoch(\bconfirmed[val=v,time=t])=\epoch(t)-1$
        % \item \ref{def:induction-conditions:ub} holds for $\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}$
        % \item $\slotstart(\lastslot(\epoch(t)-1)) \geq \GST$
        % \item $\epoch(b_c) \geq \epoch(t)-1$
        % \item $b_c \in \filtered[val=v',time=t']$
    \end{enumerate},
    then,
    \begin{enumerate}
        \item $\canonical[blck={\bconfirmed[val=v,time=t]},time=t]$
    \end{enumerate}
\end{lemma}

\begin{proof}
    By induction on slot $\sind$.
    
    Also, add the following inductive hypothesis.
    \begin{enumerate}
        % \item $\varforvalattime[val=v,time=\slotstart(\slot(\tind))]{\bconfirmed} \succeq \bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]$
        \item \label{itm:lem:canonical-no-extra-assum:ind-1}  for any justified checkpiont $C$, $\epoch(C) \in [\epoch(\guattime[time=\slotstart(\firstslot(\epoch(t)-1))]),\epoch(t)-1] \implies C  \preceq \bconfirmed[val=v,time=\slotstart(\sind)]$
        \item   for any justified checkpiont $C$, $\epoch(C) \in [\epoch(\guattime[time=\slotstart(\firstslot(\epoch(t)-1))]),\epoch(t)-1] \implies C  \succeq \guattime[time=\slotstart(\firstslot(\epoch(t))-1),val=v]$\RSfn{Even though $\sind$ does not appear here, I list this as an inductive hypothesis here for convenience.}    
        \item \label{itm:lem:canonical-no-extra-assum:ind-3}no checkpoint $C$ s.t. $\epoch(C) = \epoch(t)-1$ and $C$ conflicts with $\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]$ can ever be justified
        % \item no checkpoint $C$ s.t. $\epoch(C) = \epoch(t)-1$ and $C$ conflicts with $\bconfirmed[val=v,time=\slotstart(\epoch(t))]$ can ever be justified
        % \item if $\epoch(\varforvalattime[val=v,time=\slotstart(\slot(\tind))]{\bconfirmed}) = \epoch(t)$, then there exists a slot $s'$ s.t. $
    \end{enumerate}
    \begin{description}
        \item[Base Case: $\sind = \firstslot(\epoch(t))$.]  \Cref{lem:confirmed-end-first-slot-canonical-no-extra-assum} proves the base case.
    
        \item[Inductive Step: $\sind > \firstslot(\epoch(t))$.] 
        
        From \Cref{lem:conf-beginning-epoch-prec-bcand}, we know that $\bconfirmed[val=v,time=\slotstart(\sind)] \succeq \varforvalattime[val=v,time=\slotstart(\sind-1)]{\bconfirmed}$.


        If $\varforvalattime[val=v,time=\slotstart(\sind-1)]{\bconfirmed} = \bconfirmed[val=v,time=\slotstart(\sind)]$, then $\canonical[blck={\varforvalattime[val=v,time=\slotstart(\sind)]{\bconfirmed}},time=t]$ follows by the inductive hypothesis.

        Now, assume $\varforvalattime[val=v,time=\slotstart(\sind-1)]{\bconfirmed} \neq \bconfirmed[val=v,time=\slotstart(\sind)]$.
        From \Cref{lem:if-new-bc-then-output-find-latest,lem:conf-beginning-epoch-prec-bcand}, we know that\\ $\bconfirmed[val=v,time=\slotstart(\sind)]=\mathit{find\_latest\_confirmed\_descendant}(\varforvalattime[val=v,time=\slotstart(\sind-1)]{\bconfirmed})$ and $\bconfirmed[val=v,time=\slotstart(\sind)] \succeq \varforvalattime[val=v,time=\slotstart(\firstslot(\epoch(\sind)))]{\bconfirmed}$.

        Then, \Cref{lem:confirmed-end-first-slot-canonical-no-extra-assum} implies that
        \begin{enumerate}
            \item \label{itm:lem:canonical-no-extra-assum:ind-1}  for any justified checkpiont $C$, $\epoch(C) \in [\epoch(\guattime[time=\slotstart(\firstslot(\epoch(t)-1))]),\epoch(t)-1] \implies C  \preceq \bconfirmed[val=v,time=\slotstart(\sind)]$
            \item  \label{itm:lem:canonical-no-extra-assum:ind-2} for any justified checkpiont $C$, $\epoch(C) \in [\epoch(\guattime[time=\slotstart(\firstslot(\epoch(t)-1))]),\epoch(t)-1] \implies C  \succeq \ceba[val=v,time=\slotstart(\sind)]$
            \item   for any justified checkpiont $C$, $\epoch(C) \in [\epoch(\guattime[time=\slotstart(\firstslot(\epoch(t)-1))]),\epoch(t)-1] \implies C  \succeq \guattime[time=\slotstart(\firstslot(\epoch(t))-1),val=v]$
            \item \label{itm:lem:canonical-no-extra-assum:ind-3}no checkpoint $C$ s.t. $\epoch(C) = \epoch(t)-1$ and $C$ conflicts with $\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]$ can ever be justified
        \end{enumerate}

        Given that, by the inductive hypothesis, $\canonical[blck={\varforvalattime[val=v,time=\slotstart(\sind-1)]{\bconfirmed}},time=t, to=\slotstart(\epoch(t)+1)]$,
        we can apply \Cref{lem:output-find-latest-canonical-canonical-at-the-start-of-an-epoch} and conclude the proof.

        The above means that we can apply \Cref{lem:output-find-latest-canonical-canonical-at-the-start-of-an-epoch} to conclude that
        \begin{enumerate}
            \item $\canonical[blck={ \bconfirmed[val=v,time=\slotstart(\sind)]},time=\tind,to=\slotstart(\epoch(t)+1)]$
            \item  $\sir({ \bconfirmed[val=v,time=\slotstart(\sind)]},\tind,\varforvalattime[val=v,time=\slotstartslot{\tind}]{\chkp_{EBA}},{ \varforvalattime[val=v,time=\slotstart(\sind-1)]{\bconfirmed}}).\{\sirone,\sirtwo,\sirthree\}$ holds.
        \end{enumerate} 



        \begin{description}
            \item\item[Case 1: ${\epoch(\bconfirmed[val=v,time=\slotstart(\sind)])=\epoch(t)-1}$.]
            Given we assume $\bconfirmed[val=v,time=\slotstart(\sind)] \neq \varforvalattime[val=v,time=\slotstart(\sind-1)]{\bconfirmed}$, we know that there exists a block $b' \succeq \bconfirmed[val=v,time=\slotstart(\sind)]$ s.t. $\epoch(\gu(b'))\geq \epoch(t)-1$. 
            This is sufficient to ensure $\sirfour(\bconfirmed[val=v,time=\slotstart(\sind)])$.
            Then,  $\canonical[blck={ \bconfirmed[val=v,time=\slotstart(\sind)]},time=\tind,to=\slotstart(\epoch(t)+1)]$ and condition~\ref{itm:lem:canonical-no-extra-assum:ind-3} above imply $\sirfive(\bconfirmed[val=v,time=\slotstart(\sind)],\epoch(t)-1,\epoch(t)) = \sirfive(\bconfirmed[val=v,time=\slotstart(\sind)],\epoch(\bconfirmed[val=v,time=\slotstart(\sind)]),\epoch(\bconfirmed[val=v,time=\slotstart(\sind)])+1)$.
            Hence, $\sir({ \bconfirmed[val=v,time=\slotstart(\sind)]},\tind,\varforvalattime[val=v,time=\slotstartslot{\tind}]{\chkp_{EBA}},{ \varforvalattime[val=v,time=\slotstart(\sind-1)]{\bconfirmed}})$ holds.
            Now, \Cref{lem:ffg-safety-from-sir} imply  $\canonical[blck={\bconfirmed[val=v,time=\slotstart(\sind)]},time=t]$ 
            \item [Case 2: ${\epoch(\bconfirmed[val=v,time=\slotstart(\sind)])=\epoch(t)}$.]
            Let $v'$ be any honest validator and $t' \in [t, \slotstart(\epoch(t)+1)]$. 
            \Cref{lem:no-curr-epochconflict-chkp-is-justified,lem:conf-beginning-epoch-prec-bcand}, the inductive hypothesis, and $\canonical[blck={ \bconfirmed[val=v,time=\slotstart(\sind)]},time=\tind,to=\slotstart(\epoch(t)+1)]$ ensure that any checkpoint $C$ s.t. $C$ is justified and $\epoch(C)=\epoch(t)$, then $C = \chkp( \bconfirmed[val=v,time=\slotstart(\sind)])$.
            This, together with
            $\epoch(\gjattime[time=t',val=v']) \in [\epoch(\guattime[time=\slotstart(\firstslot(\epoch(t)-1))]),\epoch(t)]$, the fact that \sirone implies $\ceba[val=v,time=\slotstart(\sind)]\preceq \bconfirmed[val=v,time=\slotstart(\sind)]$, 
            and condition~\ref{itm:lem:canonical-no-extra-assum:ind-1} and \ref{itm:lem:canonical-no-extra-assum:ind-2} above, imply that  $\gjattime[time=t',val=v']  \preceq \bconfirmed[val=v,time=\slotstart(\sind)]$ and $\gjattime[time=t',val=v']  \succeq \ceba[val=v,time=\slotstart(\sind)]$ .
            \Cref{lem:conf-prev-epoch-then-vs-two-epochs-ago,lem:conf-current-epoch-then-gu-curr-epoch} then imply that $\sirtwo$ and $\sirthree$ hold.
            Then, \Cref{lem:ffg-condition-on-q-implies-safety} implies that $\canonical[blck={ \bconfirmed[val=v,time=\slotstart(\sind)]},time=\tind,to=\slotstart(\epoch(t)+2)]$.
            All the above then implies that $\sirfive(\bconfirmed[val=v,time=\slotstart(\sind)],\epoch(t),\epoch(t)+1) = \sirfive(\bconfirmed[val=v,time=\slotstart(\sind)],\epoch(\bconfirmed[val=v,time=\slotstart(\sind)]),\epoch(\bconfirmed[val=v,time=\slotstart(\sind)])+1)$ holds.
            Finally, \Cref{lem:no-curr-epochconflict-chkp-is-justified,lem:conf-beginning-epoch-prec-bcand}, $\canonical[blck={ \bconfirmed[val=v,time=\slotstart(\sind)]},time=\tind,to=\slotstart(\epoch(t)+2)]$, \Cref{assm:bcand-chkp-in-allu} imply $\sirfour(\bconfirmed[val=v,time=\slotstart(\sind)])$.
            Now, \Cref{lem:ffg-safety-from-sir} imply  $\canonical[blck={\bconfirmed[val=v,time=\slotstart(\sind)]},time=\tind]$.

            % \sep
            % With modified hypothesis this should give us that $\gjattime[time=t',val=v']  \preceq \bconfirmed[val=v,time=\slotstart(\sind)]$ from which $\gjattime[time=t',val=v']  \succeq \varforvalattime[val=v,time=\slotstartslot{\tind}]{\chkp_{EBA}}$.
            % \Cref{lem:conf-prev-epoch-then-vs-two-epochs-ago} then implies that \sirtwo and \sirthree holds.
            % Then, \Cref{lem:ffg-condition-on-q-implies-safety} implies that $\canonical[blck={ \bconfirmed[val=v,time=\slotstart(\sind)]},time=\tind,to=\slotstart(\epoch(t)+2)]$.
            % All the above then implies that \sirfive holds.
            % Finally, \Cref{lem:no-curr-epochconflict-chkp-is-justified}, $\canonical[blck={ \bconfirmed[val=v,time=\slotstart(\sind)]},time=\tind,to=\slotstart(\epoch(t)+2)]$, \Cref{lem:if-new-bc-then-output-find-latest} imply \ref{def:induction-conditions:ub}.
        \end{description}

    %     \sep
        
    %     Let $v'$ be any honest validator and $t' \in [t, \slotstart(\epoch(t)+1)]$.



    %     If $\varforvalattime[val=v,time=\slotstart(\sind-1)]{\bconfirmed} = \bconfirmed[val=v,time=\slotstart(\sind)]$ by the inductive hypothesis above.

    %     Otherwise, from \Cref{lem:if-new-bc-then-output-find-latest} we know that\\ $\bconfirmed[val=v,time=\slotstart(\sind)]=\mathit{find\_latest\_confirmed\_descendant}(\varforvalattime[val=v,time=\slotstart(\sind-1)]{\bconfirmed})$.
    %     Then $\bconfirmed[val=v,time=\slotstart(\sind)] \succeq \varforvalattime[val=v,time=\slotstart(\sind-1)]{\bconfirmed}\succeq \bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]$.

    %     We also know that $\canonical[blck={\varforvalattime[val=v,time=\slotstart(\sind-1)]{\bconfirmed}},time=t]$.


    %     \begin{description}
    %         \item[Case 1: ${\epoch(\bconfirmed[val=v,time=\slotstart(\sind)])=\epoch(t)-1}$.] 
            
    %         The above, together with the additional inductive hypothesis allows us to apply \Cref{lem:output-find-latest-canonical-canonical-at-the-start-of-an-epoch} which implies that $\canonical[blck={ \bconfirmed[val=v,time=\slotstart(\sind)]},time=\tind,to=\slotstart(\epoch(t)+1)]$ and 
    %         \sirone, \sirtwo and \sirthree for $\sir({ \bconfirmed[val=v,time=\slotstart(\sind)]},\tind,\varforvalattime[val=v,time=\slotstartslot{\tind}]{\chkp_{EBA}},{ \varforvalattime[val=v,time=\slotstart(\sind-1)]{\bconfirmed}})$ hold
    %         Given we assume $\bconfirmed[val=v,time=\slotstart(\sind)] \neq \varforvalattime[val=v,time=\slotstart(\sind-1)]{\bconfirmed}$, we know that there exists a block $b' \succeq \bconfirmed[val=v,time=\slotstart(\sind)]$ s.t. $\epoch(\gu(b'))\geq \epoch(t)-1$. 
    %         This is sufficient to ensure \ref{def:induction-conditions:ub}.

    %         Then,  $\canonical[blck={ \bconfirmed[val=v,time=\slotstart(\sind)]},time=\tind,to=\slotstart(\epoch(t)+1)]$ and the inductive hypothesis \ref{itm:lem:canonical-no-extra-assum:ind-3} imply \sirfive.
    %         Now, \Cref{lem:ffg-safety-from-sir} imply  $\canonical[blck={\bconfirmed[val=v,time=\slotstart(\sind)]},time=t]$    
    %         \item [Case 2: ${\epoch(\bconfirmed[val=v,time=\slotstart(\sind)])=\epoch(t)}$.] 
    %         We can use \Cref{lem:output-find-latest-canonical-canonical-at-the-start-of-an-epoch} to conclude \sirone.
    %         \begin{description}
    %             \item[$\epoch(t')=\epoch(t)$.]
    %             We can use \Cref{lem:output-find-latest-canonical-canonical-at-the-start-of-an-epoch} to conclude \sirtwo and \sirthree and $\canonical[blck={ \bconfirmed[val=v,time=\slotstart(\sind)]},time=\tind,to=\slotstart(\epoch(t)+1)]$.
    %             % From the inductive hypothesis \ref{itm:lem:canonical-no-extra-assum:ind-1} and \Cref{lem:conf-beginning-epoch-prec-bcand}, we can conclude that $\gjattime[time=t',val=v']  \preceq \bconfirmed[val=v,time=\slotstart(\sind)]$.
    %             % \Cref{lem:conf-prev-epoch-then-vs-two-epochs-ago} then implies \ref{def:induction-conditions:all-validators:not-filtered-out}.
    %             \item[$\epoch(t')=\epoch(t)+1$.]  
    %             \Cref{lem:no-curr-epochconflict-chkp-is-justified} and the inductive hypothesis, and $\canonical[blck={ \bconfirmed[val=v,time=\slotstart(\sind)]},time=\tind,to=\slotstart(\epoch(t)+1)]$ ensure that any checkpoint $C$ s.t. is justified and $\epoch(C)=\epoch(t)$, then $C = \chkp( \bconfirmed[val=v,time=\slotstart(\sind)])$.
    %             With modified hypothesis this should give us that $\gjattime[time=t',val=v']  \preceq \bconfirmed[val=v,time=\slotstart(\sind)]$ from which $\gjattime[time=t',val=v']  \succeq \varforvalattime[val=v,time=\slotstartslot{\tind}]{\chkp_{EBA}}$.
    %             \Cref{lem:conf-prev-epoch-then-vs-two-epochs-ago} then implies that \sirtwo and \sirthree holds.
    %             Then, \Cref{lem:ffg-condition-on-q-implies-safety} implies that $\canonical[blck={ \bconfirmed[val=v,time=\slotstart(\sind)]},time=\tind,to=\slotstart(\epoch(t)+2)]$.
    %             All the above then implies that \sirfive holds.
    %             Finally, \Cref{lem:no-curr-epochconflict-chkp-is-justified}, $\canonical[blck={ \bconfirmed[val=v,time=\slotstart(\sind)]},time=\tind,to=\slotstart(\epoch(t)+2)]$, \Cref{lem:if-new-bc-then-output-find-latest} imply \ref{def:induction-conditions:ub}.
    %         \end{description}
    %         Now, \Cref{lem:ffg-safety-from-sir} imply  $\canonical[blck={\bconfirmed[val=v,time=\slotstart(\sind)]},time=\tind]$.
    %     \end{description}

    \end{description}
\end{proof}

% \begin{lemma}\label{lem:output-find-latest-canonical-canonical-at-the-start-of-an-epoch-for-ever}
%     % Let $b_o := \varforvalattime[val=v]{\mathit{find\_latest\_confirmed\_descendant}}(b_c)$.
%     Let $b_c$ be a block such that
%     If
%     \begin{enumerate}
%         \item $\bconfirmed[val=v,time=\slotstart(\slot(t))] =  \varforvalattime[val=v]{\mathit{find\_latest\_confirmed\_descendant}}(b_c)$
%         \item $\slotstart(\firstslot(\epoch(t))-1)\geq \GST$
%         % \item $\sir(b_c,t,\guattime[val=v,time={\slotstart(\slot({t})-1)}],\cdot)$ holds
%         \item $\canonical[blck=b_c,time={\varforvalattime[val=v]{t}}]$
%         \item \label{itm:lem:output-find-latest-canonical-canonical-at-the-start-of-an-epoch:4}for any honest validators $v'$ and time $t'$ s.t. $\epoch(t') = \epoch(t)$, $\gjattime[time=t',val=v']  \preceq b_c$
%         \item  \label{itm:lem:output-find-latest-canonical-canonical-at-the-start-of-an-epoch:5}for any honest validators $v'$ and time $t'$ s.t. $\epoch(t') = \epoch(t)$, $\gjattime[time=t',val=v']  \succeq \guattime[time=\slotstart(\firstslot(\epoch(t))-1),val=v]$
%         % \item \ref{def:induction-conditions:ub} holds for a block $b_0$ s.t. $b_0 \preceq b_c$ and $\epoch(b_0) = \epoch(t)-1$ %\bconfirmed[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]
%         % \item $\epoch(b_c) \geq \epoch(\varforvalattime[val=v]{t})-1$
%         \item $t = \slotstart(\slot(t))$

%         % \item $\varforvalattime[val=v]{t} = \slotstart(\epoch(\varforvalattime[val=v]{t}))$
%     \end{enumerate},
%     then
%     \begin{enumerate}
%         \item for any honest validators $v'$ and time $t'$ s.t. $\epoch(t') = \epoch(t)$, $\gjattime[time=t',val=v']  \preceq \bconfirmed[val=v,time=\slotstart(\slot(t))]$
%         \item \sirone, \sirtwo and \sirthree for $\sir(\bconfirmed[val=v,time=\slotstart(\slot(t))],t,\ceba[val=v,time=\slotstartslot{t}],b_c)$ hold
%         % \item $\sir(b_o,t,\guattime[val=v,time={\s\lotstart(\slot(\varforvalattime[val=v]{t})-1)}],b_c)$, with the exception of  \ref{def:induction-conditions:ub}, holds
%         \item $\canonical[blck=b_o,time={\varforvalattime[val=v]{t}}]$
%     \end{enumerate}
% \end{lemma}

\begin{lemma}\label{lem:epoch-conf-less-prev-then-conf-finalized}
    If
    \begin{enumerate}
        % \item $\slotstart(\slot(t)-1)\geq \GST$
        \item $\epoch(\bconfirmed[val=v,time=\slotstart(\slot(t))]) < \epoch(t) - 1$
        % \item $\slot(t) = \firstslot(\epoch(t))$
    \end{enumerate},
    then
    \begin{enumerate}
        \item $\bconfirmed[val=v,time=\slotstart(\slot(t))] = \block(\gfattime[time=\slotstart(\epoch(t)),val=v])$
    \end{enumerate}
\end{lemma}

\begin{lemma}
    If
    \begin{enumerate}
        \item $\slotstart(\firstslot(\epoch(t))-1)\geq \GST$
        \item  $t = \slotstart(\slot(t))$
        % \item $\epoch(\bconfirmed[val=v,time=t])=\epoch(t)-1$
        % \item \ref{def:induction-conditions:ub} holds for $\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}$
        % \item $\slotstart(\lastslot(\epoch(t)-1)) \geq \GST$
        % \item $\epoch(b_c) \geq \epoch(t)-1$
        % \item $b_c \in \filtered[val=v',time=t']$
    \end{enumerate},
    then,
    \begin{enumerate}
        \item $\canonical[blck={\bconfirmed[val=v,time=t]},time=\slotstart(\slot(t)+1)]$
    \end{enumerate}    
\end{lemma}
\begin{proof}
    Follows from \Cref{lem:epoch-conf-less-prev-then-conf-finalized,lem:canonical-no-extra-assum}.
\end{proof}

\begin{lemma}
    If
    \begin{enumerate}
        \item $\slotstart(\epoch(t)-1) \geq \GST$
        \item $\epoch(\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}) = \epoch(t)-1$
        \item $\slot(t) = \firstslot(\epoch(t))$
    \end{enumerate},
    then,
    \begin{enumerate}
        \item $\willNoConflictingChkpBeJustified(\chkp(\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}))$
    \end{enumerate}
\end{lemma}

\begin{proof}
    \Cref{lem:bcand-current-epoch-then-no-first-slot} together with \Cref{lem:no-curr-epochconflict-chkp-is-justified} and the synchrony assumption concludes the proof.
\end{proof}

\begin{lemma}\label{lem:gu-prev-slot-descendant-of-gj-prev-slot}
    If
    \begin{enumerate}
        \item $\slotstart(\epoch(t)) \geq \GST$
        \item $\epoch(\varforvalattime[val=v,time=\slotstart(\slot(t))]{\bconfirmed}) = \epoch(t)$
    \end{enumerate},
    then,
    \begin{enumerate}
        \item $\gjattime[val=v,time=\slotstart(\slot(t)-1)] \preceq \guattime[val=v,time=\slotstart(\firstslot(\epoch(t))-1)]$.
    \end{enumerate}
\end{lemma}

\begin{lemma}\label{lem:bconf-curr-epoch-ancestor-is-one-confirmed}
    Pick any $b \preceq \varforvalattime[val=v,time=\slotstart(\slot(t))]{\bconfirmed}$.
    If
    \begin{enumerate}
        \item $\epoch(\varforvalattime[val=v,time=\slotstart(\slot(t))]{\bconfirmed}) = \epoch(t)$
        \item $\epoch(b) = \epoch(t)$
    \end{enumerate},
    then,
    \begin{enumerate}
        \item There exists slot $s > \firstslot(\epoch(t))$,
        $Q^{s-1, v, \slotstart(s), \chkp}_{b} > \frac{1}{2}\left(1 + \frac{W^{\chkp}_p}{W^{s-1, \chkp}_b}\right) + \beta - \frac{D^{s-1, v, \slotstart(s), \chkp}_b}{W^{s-1, \chkp}_b}$,
        where $\chkp = \gjattime[val=v,time=\slotstart(s-1)]$.
    \end{enumerate}
\end{lemma}

\begin{lemma}\label{lem:beta-less-than-quarter-no-reconfirmation-required}
    Let $s' := \firstslot(\epoch(t)+1)$, $\chkp' := \guattime[val=v,time=\slotstart(s'-1)]$.
    Pick any block $b$ such that $b \preceq \varforvalattime[val=v,time=\slotstartslot{t})]{\bconfirmed}$.
    If
    \begin{enumerate}
        \item $\slotstart(\epoch(t)) \geq \GST$
        \item $\epoch(b) = \epoch(t)$
        \item $\beta \leq \frac{1}{4}$
    \end{enumerate},
    then,
    \begin{enumerate}
        \item $Q^{s'-1, v, \slotstart(s'), \chkp'}_{b} > \frac{1}{2}\left(1 + \frac{W^{\chkp'}_p}{W^{s'-1, \chkp'}_b}\right) + \beta - \frac{D^{s'-1, v, \slotstart(s'), \chkp'}_b}{W^{s'-1, \chkp'}_b}$
    \end{enumerate}
\end{lemma}

\begin{proof}
    Due to \Cref{lem:bconf-curr-epoch-ancestor-is-one-confirmed} we know that $\exists s, \epoch(s)=\epoch(t)$ such that $Q^{s-1, v, \slotstart(s), \chkp}_{b} > \frac{1}{2}\left(1 + \frac{W^{\chkp}_p}{W^{s-1, \chkp}_b}\right) + \beta - \frac{D^{s-1, v, \slotstart(s), \chkp}_b}{W^{s-1, \chkp}_b}$,
    where $\chkp=\gjattime[val=v,time=\slotstart(s)-1]$.
    Then due to \Cref{lem:gu-prev-slot-descendant-of-gj-prev-slot} $\chkp = \gjattime[val=v,time=\slotstart(s-1)] \preceq \guattime[val=v,time=\slotstart(s'-1)] = \chkp'$. Given that we can conclude the following:
    \begin{itemize}
        \item $S^{s-1, v, \slotstart(s), \chkp}_{b} = S^{s-1, v, \slotstart(s'), \chkp'}_{b} + \left(D^{s-1, v, \slotstart(s'), \chkp'}_{b}-D^{s-1, v, \slotstart(s), \chkp}_{b}\right)$ --
        because $S^{s-1, v, \slotstart(s')}_{b} = S^{s-1, v, \slotstart(s)}_{b} \setminus \left(D^{s-1, v, \slotstart(s')}_{b} \setminus D^{s-1, v, \slotstart(s)}_{b}\right)$ and Assumption 1 of the Paper,
        \item $D^{s-1, v, \slotstart(s'), \chkp}_{b} \leq D^{s'-1, v, \slotstart(s'), \chkp'}_{b}$ --
        because $D^{s-1, v, \slotstart(s')}_{b} \subseteq D^{s'-1, v, \slotstart(s')}_{b}$ and Assumption 1 of the Paper,
        \item $W^{s-1,\chkp'}_b \leq W^{s-1,\chkp}_b$ -- because of Assumption 1 of the Paper,
        \item $W^{\chkp'}_p \leq W^{\chkp}_p$ -- because of Assumption 1 of the Paper,
        \item $W^{s'-1,\chkp'}_b = W^{s-1,\chkp'}_b + W^{s'-1,\chkp'}_s$ -- because $W^{s'-1}_b = W^{s-1}_b \cup W^{s'-1}_s$,
        \item Let $S^{s'-1, v, \slotstart(s')}_{b,s} := S^{s'-1, v, \slotstart(s')}_{b} \cap W^{s'-1}_s$, $S^{s'-1, v, \slotstart(s'), \chkp'}_{b} = S^{s-1, v, \slotstart(s'), \chkp'}_{b} + S^{s'-1, v, \slotstart(s'), \chkp'}_{b,s}$ -- because $S^{s'-1, v, \slotstart(s')}_{b} = S^{s-1, v, \slotstart(s')}_{b} \cup S^{s'-1, v, \slotstart(s')}_{b,s}$
    \end{itemize}

    Given the above we proceed with the inequality from \Cref{lem:bconf-curr-epoch-ancestor-is-one-confirmed}:
    \begin{align*}
        Q^{s-1, v, \slotstart(s), \chkp}_{b} > \frac{1}{2}\left(1 + \frac{W^{\chkp}_p}{W^{s-1, \chkp}_b}\right) + \beta - \frac{D^{s-1, v, \slotstart(s), \chkp}_b}{W^{s-1, \chkp}_b},\\
        \frac{S^{s-1, v, \slotstart(s), \chkp}_{b}}{W^{s-1, \chkp}_{b}} > \frac{1}{2}\left(1 + \frac{W^{\chkp}_p}{W^{s-1, \chkp}_b}\right) + \beta - \frac{D^{s-1, v, \slotstart(s), \chkp}_b}{W^{s-1, \chkp}_b}\\ \text{-- By definition},\\
        S^{s-1, v, \slotstart(s), \chkp}_{b} > \left(\frac{1}{2} + \beta\right){W^{s-1, \chkp}_b} + \frac{1}{2} W^{\chkp}_p - D^{s-1, v, \slotstart(s), \chkp}_b\\ \text{-- By simplification},\\
        S^{s-1, v, \slotstart(s'), \chkp'}_{b} + D^{s-1, v, \slotstart(s'), \chkp'}_{b}-D^{s-1, v, \slotstart(s), \chkp}_{b}\\ > \left(\frac{1}{2} + \beta\right){W^{s-1, \chkp}_b} + \frac{1}{2} W^{\chkp}_p - D^{s-1, v, \slotstart(s), \chkp}_b\\ \text{-- By substitution},\\
        S^{s-1, v, \slotstart(s'), \chkp'}_{b} > \left(\frac{1}{2} + \beta\right){W^{s-1, \chkp}_b} + \frac{1}{2} W^{\chkp}_p - D^{s-1, v, \slotstart(s'), \chkp'}_b\\ \text{-- By simplification},\\
        S^{s-1, v, \slotstart(s'), \chkp'}_{b} > \left(\frac{1}{2} + \beta\right){W^{s-1, \chkp'}_b} + \frac{1}{2} W^{\chkp'}_p - D^{s-1, v, \slotstart(s'), \chkp'}_b\\ \text{-- As } W^{s-1,\chkp'}_b \leq W^{s-1,\chkp}_b \text{ and } W^{\chkp'}_p \leq W^{\chkp}_p,\\
        S^{s-1, v, \slotstart(s'), \chkp'}_{b} > \left(\frac{1}{2} + \beta\right){W^{s-1, \chkp'}_b} + \frac{1}{2} W^{\chkp'}_p - D^{s'-1, v, \slotstart(s'), \chkp'}_b\\ \text{-- As } D^{s-1, v, \slotstart(s'), \chkp}_{b} \leq D^{s'-1, v, \slotstart(s'), \chkp'}_{b}.\\
    \end{align*}
    
    Given the above, we proceed with the inequality from the Lemma's statement:
    \begin{align*}
        Q^{s'-1, v, \slotstart(s'), \chkp'}_{b} > \frac{1}{2}\left(1 + \frac{W^{\chkp'}_p}{W^{s'-1, \chkp'}_b}\right) + \beta - \frac{D^{s'-1, v, \slotstart(s'), \chkp'}_b}{W^{s'-1, \chkp'}_b},\\
        \frac{S^{s'-1, v, \slotstart(s'), \chkp'}_{b}}{W^{s'-1, \chkp'}_{b}} > \frac{1}{2}\left(1 + \frac{W^{\chkp'}_p}{W^{s'-1, \chkp'}_b}\right) + \beta - \frac{D^{s'-1, v, \slotstart(s), \chkp'}_b}{W^{s'-1, \chkp'}_b}\\ \text{-- By definition},\\
        S^{s'-1, v, \slotstart(s'), \chkp'}_{b} > \left(\frac{1}{2} + \beta\right){W^{s'-1, \chkp'}_b} + \frac{1}{2} W^{\chkp'}_p - D^{s'-1, v, \slotstart(s'), \chkp'}_b\\ \text{-- By simplification},\\
        S^{s'-1, v, \slotstart(s'), \chkp'}_{b,s} + S^{s-1, v, \slotstart(s'), \chkp'}_{b} >\\ \left(\frac{1}{2} + \beta\right){W^{s-1, \chkp'}_b} + \frac{1}{2} W^{\chkp'}_p - D^{s'-1, v, \slotstart(s'), \chkp'}_b + \left(\frac{1}{2} + \beta\right){W^{s'-1, \chkp'}_s}\\ \text{-- By substitution},\\
        S^{s'-1, v, \slotstart(s'), \chkp'}_{b,s} \geq \left(\frac{1}{2} + \beta\right){W^{s'-1, \chkp'}_s}\\ \text{-- As } S^{s-1, v, \slotstart(s'), \chkp'}_{b} > \left(\frac{1}{2} + \beta\right){W^{s-1, \chkp'}_b} + \frac{1}{2} W^{\chkp'}_p - D^{s'-1, v, \slotstart(s'), \chkp'}_b,\\
        \left(1-\beta\right){W^{s'-1, \chkp'}_s} \geq \left(\frac{1}{2} + \beta\right){W^{s'-1, \chkp'}_s}\\ \text{-- By the synchrony assumption},\\
        1-\beta \geq \frac{1}{2} + \beta\\ \text{-- By simplification},\\
        2\beta \leq \frac{1}{2},\\
        \beta \leq \frac{1}{4}.
    \end{align*}
    Given $\beta \leq \frac{1}{4}$ condition of the Lemma's statement the proof is concluded.
\end{proof}

\begin{lemma}\label{lem:beta-less-than-quarter-no-reconfirmation-required-bconf-prev-epoch}
    Let $s' := \firstslot(\epoch(t)+1)$, $\chkp' := \guattime[val=v,time=\slotstart(s'-1)]$.
    If
    \begin{enumerate}
        \item $\slotstart(\epoch(t)) \geq \GST$
        \item $\epoch(\varforvalattime[val=v,time=\slotstartslot{t}]{\bconfirmed}) = \epoch(t)$
        \item $\beta \leq \frac{1}{4}$
    \end{enumerate},
    then, $\forall b' \prec \varforvalattime[val=v,time=\slotstartslot{t}]{\bconfirmed}$ such that $\epoch(b') = \epoch(t)-1$,
    \begin{enumerate}
        \item $Q^{s'-1, v, \slotstart(s'), \chkp'}_{b'} > \frac{1}{2}\left(1 + \frac{W^{\chkp'}_p}{W^{s'-1, \chkp'}_{b'}}\right) + \beta - \frac{D^{s'-1, v, \slotstart(s'), \chkp'}_{b'}}{W^{s'-1, \chkp'}_{b'}}$
    \end{enumerate}
\end{lemma}

\begin{proof}
    Let $b$ be the lowest block in the chain of $\varforvalattime[val=v,time=\slotstartslot{t}]{\bconfirmed}$ such that $\epoch(b)=\epoch(t)$.
    Given that we can conclude the following:
    \begin{itemize}
        \item $W^{s'-1,\chkp'}_b = W^{s'-1,\chkp'}_{b'}$, because $\parentslotplusone(b') \leq \parentslotplusone(b) \leq \firstslot(\epoch(t))$ and thus $W^{s'-1}_b = W^{s'-1}_{b'} = W_t$,
        \item $S^{s'-1, v, \slotstart(s'), \chkp'}_{b'} \geq S^{s'-1, v, \slotstart(s'), \chkp'}_{b}$, because $S^{s'-1, v, \slotstart(s')}_{b} \subseteq S^{s'-1, v, \slotstart(s')}_{b'}$ due to $b' \prec b$,
        \item $D^{s'-1, v, \slotstart(s'), \chkp'}_{b'} \geq D^{s'-1, v, \slotstart(s'), \chkp'}_{b}$, because $D^{s'-1, v, \slotstart(s')}_{b} \subseteq D^{s'-1, v, \slotstart(s')}_{b'}$.
    \end{itemize}

    Due to \Cref{lem:beta-less-than-quarter-no-reconfirmation-required} we have:
    \begin{align*}
        Q^{s'-1, v, \slotstart(s'), \chkp'}_{b} > \frac{1}{2}\left(1 + \frac{W^{\chkp'}_p}{W^{s'-1, \chkp'}_{b}}\right) + \beta - \frac{D^{s'-1, v, \slotstart(s'), \chkp'}_{b}}{W^{s'-1, \chkp'}_{b}},\\
        \frac{S^{s'-1, v, \slotstart(s'), \chkp'}_{b}}{W^{s'-1,\chkp'}_b} > \frac{1}{2}\left(1 + \frac{W^{\chkp'}_p}{W^{s'-1, \chkp'}_{b}}\right) + \beta - \frac{D^{s'-1, v, \slotstart(s'), \chkp'}_{b}}{W^{s'-1, \chkp'}_{b}}\\ \text{-- By definition},\\
        \frac{S^{s'-1, v, \slotstart(s'), \chkp'}_{b}}{W^{s'-1,\chkp'}_{b'}} > \frac{1}{2}\left(1 + \frac{W^{\chkp'}_p}{W^{s'-1, \chkp'}_{b'}}\right) + \beta - \frac{D^{s'-1, v, \slotstart(s'), \chkp'}_{b}}{W^{s'-1, \chkp'}_{b'}}\\ \text{-- As } W^{s'-1,\chkp'}_b = W^{s'-1,\chkp'}_{b'}, \\
        \frac{S^{s'-1, v, \slotstart(s'), \chkp'}_{b'}}{W^{s'-1,\chkp'}_{b'}} > \frac{1}{2}\left(1 + \frac{W^{\chkp'}_p}{W^{s'-1, \chkp'}_{b'}}\right) + \beta - \frac{D^{s'-1, v, \slotstart(s'), \chkp'}_{b'}}{W^{s'-1, \chkp'}_{b'}}\\
        \text{-- As } S^{s'-1, v, \slotstart(s'), \chkp'}_{b'} \geq S^{s'-1, v, \slotstart(s'), \chkp'}_{b} \text{and}\\ D^{s'-1, v, \slotstart(s'), \chkp'}_{b'} \geq D^{s'-1, v, \slotstart(s'), \chkp'}_{b}, \\
        Q^{s'-1, v, \slotstart(s'), \chkp'}_{b'} > \frac{1}{2}\left(1 + \frac{W^{\chkp'}_p}{W^{s'-1, \chkp'}_{b'}}\right) + \beta - \frac{D^{s'-1, v, \slotstart(s'), \chkp'}_{b'}}{W^{s'-1, \chkp'}_{b'}}\\ \text{-- By definition}.
    \end{align*}
\end{proof}

\begin{lemma}
    If
    \begin{enumerate}
        \item $\slotstart(\epoch(t)-1) \geq \GST$
        \item $\epoch(\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}) = \epoch(t)-1$
        \item $\beta \leq \frac{1}{4}$
    \end{enumerate},
    then, $\forall b' \succeq \guattime[val=v,time=\slotstart(\slot(t)-1)]$ such that $b' \preceq \varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}$,
    \begin{enumerate}
        \item $Q^{s'-1, v, \slotstart(s'), \chkp'}_{b'} > \frac{1}{2}\left(1 + \frac{W^{\chkp'}_p}{W^{s'-1, \chkp'}_{b'}}\right) + \beta - \frac{D^{s'-1, v, \slotstart(s'), \chkp'}_{b'}}{W^{s'-1, \chkp'}_{b'}}$
    \end{enumerate}
\end{lemma}

\begin{proof}
    Due to \Cref{lem:conf-current-epoch-then-gu-curr-epoch} we know that $\exists b'' \in \viewattime[val=v,time=\slotstart(\slot(t)-1)], b'' \succeq \varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed} \land \epoch(\gu(b')) \geq \epoch(t)-2$.
    Then we can conclude that $\epoch(\guattime[val=v,time=\slotstart(\slot(t)-1)]) \geq \epoch(t)-2$.
    By cases.
    \begin{description}
        \item[Case 1: {$\epoch(b') = \epoch(t)-1$}.] Apply \Cref{lem:beta-less-than-quarter-no-reconfirmation-required}.
        \item[Case 2: {$\epoch(b') \neq \epoch(t)-1$}.] Implies $\epoch(b') = \epoch(t)-2$. Apply \Cref{lem:beta-less-than-quarter-no-reconfirmation-required-bconf-prev-epoch}.
    \end{description}
\end{proof}

\section{Old}

\RSfn{\Cref{lem:restart-condition-cannot-cause-issues} perhaps not needed.}
\begin{lemma}\label{lem:restart-condition-cannot-cause-issues}
    If
    \begin{enumerate}
        \item $\epoch(\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}) \geq \epoch(t) - 1$
        \item $\slot(t) = \firstslot(\epoch(t))$
        \item $\epoch(\guattime[time=\slotstart(\slot(t)-1),val=v]) = \epoch(t)-1$
    \end{enumerate},
    then
    \begin{enumerate}
        \item $\block(\guattime[time=\slotstart(\slot(t)-1),val=v])$ does not coflict with $\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}$.
    \end{enumerate}
\end{lemma}

\begin{proof}
    The Lemma's condition imply that $\epoch(\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}) = \epoch(\slot(t)-1)$ as $\epoch(\slot(t)-1) = \epoch(t)-1 \leq \epoch(\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}) < \epoch(t)$.
    Given the $\epoch(\chkp(\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed})) = \epoch(t)-1$ and $\epoch(\guattime[time=\slotstart(\slot(t)-1),val=v]) = \epoch(t)-1$, 
    \Cref{lem:no-curr-epochconflict-chkp-is-justified} implies that $\guattime[time=\slotstart(\slot(t)-1),val=v]= \chkp(\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed})$.
    Given that $\chkp(\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed})$ does not conflict with $\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}$, the  proof is concluded.
\end{proof}



\begin{lemma}\label{lem:no-prev-epochconflict-chkp-is-justified}
    Pick any $b_c \in  \varforvalattime[val=v,time=\slotstart(\slot(t))]{\bcands}$.
    % Take an honest validator $v$ and a time $t$.
    If
    \begin{enumerate}
        % \item $\slotstart(\epoch(t)-1) \geq \GST$
        \item $\epoch(b_c) \geq \epoch(t) - 1$
    \end{enumerate},
    then at least one of the following statements hold:
    \begin{enumerate}
        % \item $\gjattime[time=\slotstartslot{t},val=v] = \chkp(b_c,\epoch(t) - 1)$
        \item $\chkp(b_c,\epoch(t) - 1) \in \allU(\viewattime[time=\slotstart(\slot(t)-1),val=v])$
        \item there exists a time $t' \leq \slotstart(\lastslot(\epoch(t)-1))$ such that
        \begin{enumerate}
            \item $t' = \slotstartslot{t'}$
            \item $\epoch(t') = \epoch(t)-1$
            \item $\varforvalattime[val=v,time=t']{\willChkpBeJustified}(\chkp(b_c,\epoch(t) - 1))$
        \end{enumerate}
    \end{enumerate}
\end{lemma}

\begin{proof}
    By induction on $\slot(t)$.
    Let $s := \slot(t)$.
    \begin{description}
        \item[Base Case: {$s = \slot(\varforvalattime[val=v]{\tinit})$}.] The Lemma is vacuously true.
        \item[Inductive Case: {$s \geq \slot(\varforvalattime[val=v]{\tinit})$}.]
            We assume that the Lemma holds for $s$ and prove that it also holds for $s+1$.
            Pick any $b_c \in \varforvalattime[val=v,time=\slotstart(s+1)]{\bcands}$ such that $\epoch(b_c) \geq \epoch(s+1) - 1$
        \begin{description}
            \item[{Case 1: $\epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}) < \epoch(s+1) - 1  \lor \varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed} \npreceq \LMDGHOSTHFC(\viewatstslottime[val=v,time=\slotstart(s+1)])$}.]
                Given that $\epoch(b_c) \geq \epoch(s+1) - 1$, it follows \RSfn{Perhaps we should have a Lemma about this} that condition at \Cref{ln:start-conf-chain} holds.
                This implies that $\gjattime[val=v,time=\slotstart(s+1)] = \guattime[val=v,time=\slotstart(s)]$,
                $b_c \succeq \block(\guattime[val=v,time=\slotstart(s)]) = \block(\gjattime[val=v,time=\slotstart(s+1)])$,
                $\epoch(\guattime[val=v,time=\slotstart(s)]) = \epoch(s+1)-1$.
                Thus, $\gjattime[val=v,time=\slotstart(s+1)] =\guattime[val=v,time=\slotstart(s)]= \chkp(b_c,\epoch(s+1)-1)$
                proving that Statement 1 holds.
            \item[Case 2: {$\epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}) \geq \epoch(s+1) - 1 \land \varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed} \preceq \LMDGHOSTHFC(\viewatstslottime[val=v,time=\slotstart(s+1)])$}.]
            This case and \Cref{lem:restart-condition-cannot-cause-issues} imply\RSfn{Perhaps we need a Lemma for this} that $b_c \succeq \varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}$.
            Also, clearly $\epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}) \geq \epoch(s) - 1$, so the inductive hypothesis holds non-vacuously for $s$.
            By sub-cases.
            \begin{description} 
                \item[Case 2.1: $\epoch(s+1)=\epoch(s)$.]
                Given that $b_c \succeq \varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}$ and $\epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}) \geq \epoch(s+1) - 1$,
                this implies that $\chkp(b_c,\epoch(s+1)-1) = \chkp(\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed},\epoch(s)-1)$.
                Then apply the inductive hypothesis.
                \item[Case 2.2: $\epoch(s+1)=\epoch(s)+1$.]
                This case implies that $\epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}) = \epoch(s)$.
                Then from \Cref{lem:no-curr-epochconflict-chkp-is-justified}, we know that $\exists t', t' =\slotstartslot{t'}\land \epoch(t') = \epoch(s) = \epoch(s+1)-1 \land \varforvalattime[val=v,time=t']{\willChkpBeJustified}(\chkp(\varforvalattime[val=v,time=\slotstartslot{t}]{\bconfirmed}))$.
                Given that $\chkp(\varforvalattime[val=v,time=\slotstartslot{t}]{\bconfirmed}) =  \chkp(\varforvalattime[val=v,time=\slotstartslot{t}]{\bconfirmed},\epoch(s)) = \chkp(\varforvalattime[val=v,time=\slotstartslot{t}]{\bconfirmed},\epoch(s+1)-1)$, the proof for this case is concluded.
                % \item[Case 2.1: {$\epoch(b_c) = \epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed})$}.] 
                % Given that $b_c \succeq \varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}$,
                % this implies that $\chkp(b_c,\epoch()) = \chkp(\varforvalattime[val=v,time=\slotstart(s)]{\bcand})$.
                % \sloppy{Note that if $\gjattime[time=\slotstartslot{t},val=v] = \chkp(\varforvalattime[val=v,time=\slotstartslot{t}]{\bcand})$, then $\varforvalattime[val=v,time=\slotstartslot{t}]{\willChkpBeJustified}(\chkp(\varforvalattime[val=v,time=\slotstartslot{t}]{\bcand}))$.}
                % Then, the rest follows from the inductive hypothesis.
                % \item[Case 2.2: {$\epoch(b_c) = \epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}) + 1$}.] 
                % Given that $\epoch(\varforvalattime[val=v,time=\slotstart(s+1)]{\bcand}) \leq \epoch(s+1)$, this implies that $\epoch(\varforvalattime[val=v,time=\slotstart(s+1)]{\bcand}) = \epoch(s+1)$.
                % Then, it must be that the \KwSty{if} blocks at line 23 is executed proving the lemma.
            \end{description}
        \end{description}
    \end{description}
\end{proof}

% \begin{proof}
%     By induction on $\slot(t)$.
%     Let $s := \slot(t)$.
%     \begin{description}
%         \item[Base Case: {$s = \slot(\varforvalattime[val=v]{\tinit})$}.] The Lemma is vacuously true.
%         \item[Inductive Case: {$s \geq \slot(\varforvalattime[val=v]{\tinit})$}.]
%             We assume that the Lemma holds for $s$ and prove that it also holds for $s+1$.
%             Given this, $\epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}) \geq \epoch(s) - 1$.
%             We also know that $\epoch(\varforvalattime[val=v,time=\slotstart(s+1)]{\bcand}) \leq \epoch(s+1)$.
%             With all this we proceed by cases.
%         \begin{description}
%             \item[{Case 1: $\epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}) < \epoch(s+1) - 1$}.]
%                 We assume condition in line 14 of \Cref{alg:conffull} holds, otherwise,
%                 $\varforvalattime[val=v,time=\slotstartslot{s+1}]{\bcand} < \epoch(s+1) - 1$ and the Lemma is vacuously true.
%                 That condition implies $\gjattime[val=v,time=\slotstart(s+1)] = \guattime[val=v,time=\slotstart(s)]$,
%                 $\varforvalattime[val=v,time=\slotstart(s+1)]{\bcand} \succeq \block(\guattime[val=v,time=\slotstart(s)]) = \block(\gjattime[val=v,time=\slotstart(s+1)])$,
%                 $\epoch(\varforvalattime[val=v,time=\slotstart(s+1)]{\bcand}) = \epoch(s+1)-1$.
%                 Thus, $\gjattime[val=v,time=\slotstart(s+1)] = \chkp(\varforvalattime[val=v,time=\slotstart(s+1)]{\bcand},\epoch(s+1)-1)$
%                 concluding Statement 1 of the Lemma.
%             \item[{Case 2: $\epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}) = \epoch(s+1)-1$}]. By cases again.
%                 \begin{description}
%                     \item[{Case 2.1: $\epoch(\varforvalattime[val=v,time=\slotstart(s+1)]{\bcand}) = \epoch(s+1)-1$}].
%                         $\epoch(\varforvalattime[val=v,time=\slotstart(s+1)]{\bcand}) = \epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bcand})$
%                         and $\varforvalattime[val=v,time=\slotstart(s+1)]{\bcand} \succeq \varforvalattime[val=v,time=\slotstart(s)]{\bcand}$
%                         due to line 17 of \Cref{alg:conffull} imply $\chkp(\varforvalattime[val=v,time=\slotstart(s+1)]{\bcand}) = \chkp(\varforvalattime[val=v,time=\slotstart(s)]{\bcand})$.
%                         Then by subcases.
%                         \begin{description}
%                             \item[{Case 2.1.1: $\gjattime[val=v,time=\slotstart(s+1)] = \gjattime[val=v,time=\slotstart(s)]$}].
%                                 By the inductive hypothesis assume Statement 1 holds for $\varforvalattime[val=v,time=\slotstart(s)]{\bcand}$,
%                                 then it's clearly holds for $\varforvalattime[val=v,time=\slotstart(s+1)]{\bcand}$.
%                                 Now assume that only Statement 2 holds for $\varforvalattime[val=v,time=\slotstart(s)]{\bcand}$,
%                                 then there must be $t' \leq st(s)$, $\epoch(t') = \epoch(s)-1 = \epoch(s+1)-1$
%                                 for which $\varforvalattime[val=v,time=t']{\willChkpBeJustified}(\chkp(\varforvalattime[val=v,time=\slotstart(s)]{\bcand}))$.
%                                 Then, clearly Statement 2 holds for slot $s+1$.
%                             \item[{Case 2.1.2: $\gjattime[val=v,time=\slotstart(s+1)] \ne \gjattime[val=v,time=\slotstart(s)]$}].
%                                 From \Cref{lem:gj-at-least-e-2} it follows that
%                                 $\epoch(\gjattime[val=v,time=\slotstart(s)]) \geq \epoch(s) - 2$.
%                                 Then, by definition and monotonicity property of greatest justified checkpoint,
%                                 we have $\epoch(\gjattime[val=v,time=\slotstart(s)]) = \epoch(s)-2$ and
%                                 $\epoch(\gjattime[val=v,time=\slotstart(s+1)]) = \epoch(s)-1$.
%                                 Thus, Statement 1 doesn't hold for slot $s$, and then by inductive hypothesis
%                                 it must be that Statement 2 holds, which implies
%                                 $\varforvalattime[val=v,time=t']{\willChkpBeJustified}(\chkp(\varforvalattime[val=v,time=\slotstart(s)]{\bcand}))$,
%                                 $\epoch(t') = \epoch(s)-1$. Given that, the syncrhony assumption and the fact that
%                                 $\epoch(\gjattime[val=v,time=\slotstart(s+1)]) = \epoch(s) - 1$ we conclude
%                                 $\gjattime[val=v,time=\slotstart(s+1)] = \chkp(\varforvalattime[val=v,time=\slotstart(s)]{\bcand})$.
%                                 Thus, Statement 1 of the Lemma holds for slot $s+1$.
%                         \end{description}
%                     \item[{Case 2.2: $\epoch(\varforvalattime[val=v,time=\slotstart(s+1)]{\bcand}) = \epoch(s+1)$}].
%                         This case is only possible if condition in line 23 of \Cref{alg:findlatestconf}
%                         holds for $b' \in \viewattime[val=v,time=s+1]$, $\epoch(b') = \epoch(s+1)$,
%                         thus $\varforvalattime[val=v,time=\slotstart(s+1)]{\willChkpBeJustified}(\chkp(b'))$.
%                         By lines 1-7 and 22 of \Cref{alg:findlatestconf} we know that $\varforvalattime[val=v,time=\slotstart(s+1)]{\bcand} \succeq b'$,
%                         this and the fact that $\epoch(b') = \epoch(\varforvalattime[val=v,time=\slotstart(s+1)]{\bcand})$ implies
%                         $\chkp(\varforvalattime[val=v,time=\slotstart(s+1)]{\bcand}) = \chkp(b')$.
%                         From this it follows that Statement 2 of the Lemma holds for $t' = \slotstart(s+1)$.
%                 \end{description}
%             \item[{Case 3: $\epoch(\varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed}) = \epoch(s+1)$}].
%                 By definition $\epoch(\gjattime[val=v,time=\slotstart(s+1)]) < \epoch(s+1)$, thus, Statement 1 of the Lemma cannot hold for this case.
%                 Then, by the inductive hypothesis, we know that Statement 2 of the Lemma holds for $t' \leq \slotstart(s)$.
%                 We also have $\varforvalattime[val=v,time=\slotstart(s+1)]{\bcand} \succeq \varforvalattime[val=v,time=\slotstart(s)]{\bcand}$
%                 due to line 17 of \Cref{alg:conffull}.
%                 Thus, $\chkp(\varforvalattime[val=v,time=\slotstart(s+1)]{\bcand}) = \chkp(\varforvalattime[val=v,time=\slotstart(s)]{\bcand})$
%                 which together with the inductive hypothesis concludes proof for the Statement 2 of the Lemma for slot $s+1$.
%         \end{description}
%     \end{description}    
% \end{proof}

\begin{property}\label{prop:on-chkp-prec}
    Let $C_1$ be a checkpoint and $e$ be an epoch.
    If
    \begin{enumerate}
        \item $b \preceq b'$
        \item $C_1 \preceq b'$
        \item $\epoch(C_1) \leq \epoch(b)$
    \end{enumerate}, 
    then, for any $e \geq \epoch(C_1)$,
    \begin{enumerate}
        \item $C_1 \preceq \chkp(b,e)$
    \end{enumerate}
\end{property}

\begin{lemma}\label{lem:gj-does-not-conflict}
    Pick any $b_c \in  \varforvalattime[val=v,time=\slotstart(\slot(t))]{\bcands}$.
    If
    \begin{enumerate}
        \item $\slotstart(\lastslot(\epoch(t)-1)) \geq \GST$
        \item $\epoch(b_c) \geq \epoch(t) - 1$
    \end{enumerate},
    then, for any honest validator $v'$,
    \begin{enumerate}
        \item $\gjattime[time=\slotstartslot{t},val=v'] \preceq b_c$
        % \item $\gjattime[val=v', time=\slotstart(\slot(t))] \succeq \gjattime[val=v, time=\slotstart(\slot(t)-1)]$
    \end{enumerate}
\end{lemma}

\begin{proof}
    Let $s := \slot(t)$.
    Due to \Cref{lem:vs-at-least-e-2}, we know that there exists an honest validator $v_h$ such that $\exists b' \in \viewattime[time=\votingtime(s-1),val=v_h], b' \succeq b_c \land \epoch(\votsource[blck=b',time=\slotstart(s)])\geq \epoch(s)-2$.
    Due to synchrony this implies that $\epoch(s)-2 \leq \epoch(\votsource[blck=b',time=\slotstart(s)]) \leq \epoch(\gjattime[time=\slotstart(s-1),val=v_h]) \leq \epoch(\gjattime[time=\slotstart(s),val=v']) \leq \epoch(s)-1$.
    By cases.
    \begin{description}
        \item[Case 1: {$\epoch(\gjattime[time=\slotstart(s),val=v']) = \epoch(s)-1$}.] 
        % By sub cases.
        % \begin{description}
        %     \item[Case 1.1: $\epoch(b_c) = \epoch(s)$.] 
        %             We can apply \Cref{lem:conf-current-epoch-then-gu-curr-epoch} to conclude that $\gjattime[time=\slotstart(s),val=v']$ does not conflict with $b_c$.
        %     \item[Case 1.2: $\epoch(b_c) = \epoch(s)-1$.] 
            We can apply \Cref{lem:no-prev-epochconflict-chkp-is-justified} to conclude that $\gjattime[time=\slotstartslot{t},val=v'] = \chkp(b_c, \epoch(s)-1)\preceq b_c$.
        % \end{description}
        \item[Case 2: {$\epoch(\gjattime[time=\slotstart(s),val=v']) = \epoch(s)-2$}.] This implies that $\epoch(\gjattime[time=\slotstart(s-1),val=v_h])= \epoch(s)-2$ which further implies that $\epoch(\votsource[blck=b',time=\slotstart(s)]) = \epoch(s)-2$.
        Hence, $\gjattime[time=\slotstartslot{t},val=v'] = \votsource[blck=b',time=\slotstart(s)]$.
        Given that $b' \succeq b_c \land \epoch(b_c) \geq \epoch(\votsource[blck=b',time=\slotstart(s)])$ we can apply \Cref{prop:on-chkp-prec} to conclude  $\gjattime[time=\slotstartslot{t},val=v'] = \votsource[blck=b',time=\slotstart(s)] \preceq b_c$.
    \end{description}
\end{proof}



% \begin{proof}(by Roberto)
%     Let $s := \slot(t)$.
%     Due to the synchrony assumption and \Cref{lem:vs-at-least-e-2}, we know that $\exists b' \in \viewattime[time=\slotstart(s),val=v] \cap \viewattime[time=\slotstart(s),val=v'] , b' \succeq  b_c \land \epoch(\votsource[blck=b',time=\slotstart(s)])\geq \epoch(s)-2$.
%     This implies that \{$\epoch(\gjattime[time=\slotstart(s),val=v]),\epoch(\gjattime[time=\slotstart(s),val=v'])\} \subseteq \{\epoch(s)-2,\epoch(s)-1\}$.
%     \begin{description}
%         \item[Case 1: {$\epoch(\gjattime[time=\slotstartslot{t},val=v']) = \epoch(s)-1$}.] 
%         We can apply \Cref{lem:no-conflict-chkp-is-justified} to conclude that $\gjattime[time=\slotstartslot{t},val=v']$ does not conflict with $b_c$.

%         \item[Case 2: {$\epoch(\gjattime[time=\slotstartslot{t},val=v']) = \epoch(s)-2$}.] Due to synchrony, $\epoch(\gjattime[time=\slotstart(s),val=v']) \geq \epoch(\gjattime[time=\slotstart(s-1),val=v])$ which implies that $\epoch(\gjattime[time=\slotstart(s-1),val=v])= \epoch(s)-2$.
         
%     \end{description}

%     Given that $\epoch(\varforvalattime[val=v,time=\slotstart(s-1)]{\bcand}) = \epoch(s) - 1 \geq \epoch(s-1)-1$, we can apply \Cref{lem:no-conflict-chkp-is-justified} to conclude that if $\epoch(\gjattime[time=\slotstartslot{t},val=v']) = \epoch(s)-1$, then $\gjattime[time=\slotstartslot{t},val=v']$ does not conflict with $\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bcand}$.

% \end{proof}

% \begin{lemma}%\label{lem:gj-does-not-conflict-e-1}
%     Pick any $b_c \in  \varforvalattime[val=v,time=\slotstart(\slot(t))]{\bcands}$.
%     If
%     \begin{enumerate}
%         \item $\text{\slotstart}(\text{\lastslot}(\text{\epoch}(t) - 1)) \geq \GST$
%         \item $\epoch(b_c) = \epoch(t) - 1$
%     \end{enumerate},
%     then, for any honest validator $v'$,
%     \begin{enumerate}
%         \item $\gjattime[time=\slotstartslot{t},val=v']$ does not conflict with $b_c$
%         % \item $\gjattime[val=v', time=\slotstart(\slot(t))] \succeq \gjattime[val=v, time=\slotstart(\slot(t)-1)]$
%     \end{enumerate}
% \end{lemma}

% \begin{proof}(by Roberto)
%     Let $s := \slot(t)$.
%     Due the synchrony assumption and \Cref{lem:vs-at-least-e-2}, we know that $\exists b' \in \viewattime[time=\slotstart(s)-1,val=v], b' \succeq  \varforvalattime[val=v,time=\slotstart(s)]{\bconfirmed} \land \epoch(\votsource[blck=b',time=\slotstart(s)])\geq \epoch(s)-2$.
%     This implies that $\epoch(\gjattime[time=\slotstart(s-1),val=v]) \in \{\epoch(s)-2,\epoch(s)-1\}$.
%     \begin{description}
%         \item[Case 1: {$\epoch(\gjattime[time=\slotstartslot{t},val=v']) = \epoch(s)-1$}.] 
%         We can apply \Cref{lem:no-conflict-chkp-is-justified} to conclude that $\gjattime[time=\slotstartslot{t},val=v']$ does not conflict with $\varforvalattime[val=v,time=\slotstart(s)]{\bcand}$.

%         \item[Case 2: {$\epoch(\gjattime[time=\slotstartslot{t},val=v']) = \epoch(s)-2$}.] Due to synchrony, $\epoch(\gjattime[time=\slotstart(s),val=v']) \geq \epoch(\gjattime[time=\slotstart(s-1),val=v])$ which implies that $\epoch(\gjattime[time=\slotstart(s-1),val=v])= \epoch(s)-2$.
         
%     \end{description}

%     Given that $\epoch(\varforvalattime[val=v,time=\slotstart(s-1)]{\bcand}) = \epoch(s) - 1 \geq \epoch(s-1)-1$, we can apply \Cref{lem:no-conflict-chkp-is-justified} to conclude that if $\epoch(\gjattime[time=\slotstartslot{t},val=v']) = \epoch(s)-1$, then $\gjattime[time=\slotstartslot{t},val=v']$ does not conflict with $\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bcand}$.

% \end{proof}

% \begin{proof}
%     Just a property of how checkpoints are computed.
% \end{proof}

\begin{lemma}\label{lem:gu-prec-gj-start-epoch-when-prec-conf-from-at-least-prev-epoch}
    If
    \begin{enumerate}
        \item $\slotstart(\slot(t)-1)\geq \GST$
        \item $\epoch(\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}) \geq \epoch(t) - 1$
        \item $\slot(t) = \firstslot(\epoch(t))$
    \end{enumerate},
    then
    \begin{enumerate}
        \item $\guattime[time=\slotstart(\slot(t)-1),val=v] \preceq \gjattime[time=\slotstartslot{t},val=v']$
    \end{enumerate}
\end{lemma}

\begin{proof}
    Let $s:= \slot(t)$.
    The Lemma's condition imply that $\epoch(\varforvalattime[val=v,time=\slotstart(s-1)]{\bconfirmed}) = \epoch(s-1)$ as $\epoch(s-1) = \epoch(s)-1 \leq \epoch(\varforvalattime[val=v,time=\slotstart(s-1)]{\bconfirmed}) < \epoch(t)$.
    \Cref{lem:conf-current-epoch-then-gu-curr-epoch} implies that $\exists b' \in \viewattime[val=v,time=\slotstart(s-1)], b' \succeq \varforvalattime[val=v,time=\slotstart(s-1)]{\bconfirmed} \land \epoch(\gu(b')) \geq \epoch(s-1) = \epoch(s)-2$.
    This and the synchrony assumption imply that $\epoch(s)-2 \leq \epoch(\gu(b')) \leq \epoch(\guattime[time=\slotstart(s-1),val=v] ) \leq \epoch(\gjattime[time=\slotstart(s),val=v']) \leq \epoch(s)-1$.
    By cases on $\epoch(\guattime[time=\slotstart(s-1),val=v] )$.
    \begin{description}
        % \item[Case 1: ${\epoch(\gjattime[time=\slotstart(s),val=v']) = \epoch(s)-1}$.] 
        \item[Case 1: {$\epoch(\guattime[time=\slotstart(s-1),val=v] ) = \epoch(\gjattime[time=\slotstart(s),val=v'])$}.] This implies that  $\guattime[time=\slotstart(s-1),val=v]  = \gjattime[time=\slotstart(s),val=v']$.
        \item[Case 2: {$\epoch(\guattime[time=\slotstart(s-1),val=v] ) \neq \epoch(\gjattime[time=\slotstart(s),val=v'])$}.] This case implies that $\epoch(\gu(b'))= \epoch(\guattime[time=\slotstart(s-1),val=v] ) = \epoch(s)-2$ and $\epoch(\gjattime[time=\slotstart(s),val=v']) = \epoch(s)-1$.
        Given that  $\epoch(\varforvalattime[val=v,time=\slotstart(s-1)]{\bconfirmed}) = \epoch(s-1) = \epoch(s)-1$, \Cref{lem:no-prev-epochconflict-chkp-is-justified} implies that $\gjattime[time=\slotstart(s),val=v'] = \chkp(\varforvalattime[val=v,time=\slotstart(s-1)]{\bconfirmed})$.
        Because $\epoch(\gu(b')) = \epoch(\guattime[time=\slotstart(s-1),val=v] ) \leq \epoch(\gjattime[time=\slotstart(s),val=v']) = \epoch(\chkp(\varforvalattime[val=v,time=\slotstart(s-1)]{\bconfirmed}))$ and $b' \succeq \varforvalattime[val=v,time=\slotstart(s-1)]{\bconfirmed}$, \Cref{prop:on-chkp-prec} implies that $\guattime[time=\slotstart(s-1),val=v] = \gu(b')\preceq \gjattime[time=\slotstart(s),val=v']$.
    \end{description}
\end{proof}

\begin{lemma}
    Pick any $b_c \in  \varforvalattime[val=v,time=\slotstart(\slot(t))]{\bcands}$. 
    If
    \begin{enumerate}
        \item $\slotstart(\slot(t)-1)\geq \GST$
        \item $\epoch(b_c) \geq \epoch(t) - 1$
        \item $\slot(t) = \firstslot(\epoch(t))$
    \end{enumerate},
    then
    \begin{enumerate}
        \item $\guattime[time=\slotstart(\slot(t)-1),val=v] \preceq \gjattime[time=\slotstartslot{t},val=v']$
    \end{enumerate}
\end{lemma}

\begin{proof}
    Let $s:= \slot(t)$.
    By cases.
    \begin{description}
        \item[Case 1: {$\epoch(\varforvalattime[val=v,time=\slotstart(s-1)]{\bconfirmed}) < \epoch(s) - 1$}.] 
        Given that $\epoch(b_c) \geq \epoch(s)-1$, it must be that we restart the ``confirmation chain'' at time $\slotstart(s)$ as there is no other way to satisfy the conditions in the Lemma's statement.
        This means that conditions at \Cref{ln:start-conf-chain} are true.
        Therefore, due to the synchrony assumption, $\gjattime[time=\slotstartslot{t},val=v'] = \guattime[time=\slotstart(s-1),val=v]$.
        \item[Case 2: {$\epoch(\varforvalattime[val=v,time=\slotstart(s-1)]{\bconfirmed}) \geq \epoch(s) - 1$}.] Apply \Cref{lem:gu-prec-gj-start-epoch-when-prec-conf-from-at-least-prev-epoch}.
    \end{description}
\end{proof}

% \begin{lemma}%\label{prop:on-chkp-prec}
%     If
%     \begin{enumerate}
%         \item $C_1 \preceq b'$
%         \item $b \preceq b'$
%         \item $C_2 \preceq b$
%         \item $\epoch(C_1) \leq \epoch(C_2)$
%     \end{enumerate}, 
%     then
%     \begin{enumerate}
%         \item $C_1 \preceq C_2$
%     \end{enumerate}
% \end{lemma}
% \begin{proof}
%     Just a property of how checkpoints are computed.
% \end{proof}


\RS{After all, \Cref{lem:prev-gj-prec-others-gj} is probably not needed :'(}
\begin{lemma}\label{lem:prev-gj-prec-others-gj}
    If
    \begin{enumerate}
        \item $\slotstart(\lastslot(\epoch(t)-1))\geq \GST$
        \item $\epoch(\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}) \geq \epoch(t) - 1$
        % \item $\slot(t) = \firstslot(\epoch(t))$
    \end{enumerate},
    then
    \begin{enumerate}
        \item $\gjattime[time=\slotstart(\slot(t)-1),val=v] \preceq \gjattime[time=\slotstartslot{t},val=v']$
    \end{enumerate}    
\end{lemma}

\begin{proof}
    By cases.
    From \Cref{lem:vs-at-least-e-2}, we know that $\exists b' \in \viewattime[time=\votingtime(s-1),val=v], b' \succeq \varforvalattime[val=v,time=\slotstart(s-1)]{\bconfirmed} \land \epoch(\votsource[blck=b',time=\slotstart(s-1)])\geq \epoch(s-1)-2$.
    We have $ \epoch(s-1)-2 \leq \epoch(\votsource[blck=b',time=\slotstart(s-1)]) \leq  \epoch(\gjattime[time=\slotstart(s-1),val=v]) \leq   \epoch(s-1)-1$.
    \begin{description}
        \item[Case 1: {$\epoch(\gjattime[time=\slotstart(s),val=v']) \leq \epoch(s-1)-1$}.]
        This case and the synchrony assumption imply that 
        $ \epoch(s-1)-2 \leq \epoch(\votsource[blck=b',time=\slotstart(s-1)]) \leq  \epoch(\gjattime[time=\slotstart(s-1),val=v]) \leq  \epoch(\gjattime[time=\slotstart(s),val=v']) \leq \epoch(s-1)-1$.
        \begin{description}
            \item[Case 1.1: {$\epoch(\gjattime[time=\slotstart(s-1),val=v]) =  \epoch(\gjattime[time=\slotstart(s),val=v'])$}.] Obvious.
            \item[Case 1.2: {$\epoch(\gjattime[time=\slotstart(s-1),val=v]) \neq  \epoch(\gjattime[time=\slotstart(s),val=v'])$}.]
            This case implies that $\epoch(\gjattime[time=\slotstart(s-1),val=v]) = \epoch(s-1)-2 = \epoch(\votsource[blck=b',time=\slotstart(s-1)])$ and $\epoch(\gjattime[time=\slotstart(s),val=v']) = \epoch(s-1)-1$.
            Because $\epoch(\votsource[blck=b',time=\slotstart(s-1)]) = \epoch(s-1) -2 < \epoch(s-1) -1 \leq \epoch(s)-1 \leq \epoch(\varforvalattime[val=v,time=\slotstart(s-1)]{\bconfirmed})$,  $b' \succeq \varforvalattime[val=v,time=\slotstart(s-1)]{\bconfirmed}$, we can apply \Cref{prop:on-chkp-prec} to conclude that $\votsource[blck=b',time=\slotstart(s-1)] \preceq \chkp(\varforvalattime[val=v,time=\slotstart(s-1)]{\bconfirmed},\epoch(s-1)-1)$.
            From $\epoch(\votsource[blck=b',time=\slotstart(s-1)]) = \epoch(\gjattime[time=\slotstart(s-1),val=v] )$ and \Cref{lem:no-prev-epochconflict-chkp-is-justified}, it follows that $\gjattime[time=\slotstart(s-1),val=v] =\votsource[blck=b',time=\slotstart(s-1)] \prec  \chkp(\varforvalattime[val=v,time=\slotstart(s-1)]{\bconfirmed},\epoch(s-1)-1) =  \gjattime[time=\slotstartslot{t},val=v']$.
        \end{description}
        \item[Case 2: {$\epoch(\gjattime[time=\slotstart(s),val=v']) > \epoch(s-1)-1$}.]
        This case implies that $\epoch(\gjattime[time=\slotstart(s),val=v']) = \epoch(s-1) = \epoch(s)-1$ and $s = \firstslot(\epoch(s))$.
        Hence, $\epoch(\varforvalattime[val=v,time=\slotstart(s-1)]{\bconfirmed})= \epoch(s-1)$.
        From \Cref{lem:no-curr-epochconflict-chkp-is-justified} we then have that $\gjattime[time=\slotstart(s),val=v'] = \chkp(\varforvalattime[val=v,time=\slotstart(s-1)]{\bconfirmed})$.
        By sub-cases
        \begin{description}
            \item[Case 2.1: {$\epoch(\gjattime[time=\slotstart(s-1),val=v])= \epoch(s-1)-2$}.] 
            This case implies that $\epoch(\gjattime[time=\slotstart(s-1),val=v])= \epoch(s-1)-2 = \epoch(\votsource[blck=b',time=\slotstart(s-1)])$ which further imples that $\gjattime[time=\slotstart(s-1),val=v] = \votsource[blck=b',time=\slotstart(s-1)]$.
            Because $\epoch(\votsource[blck=b',time=\slotstart(s-1)]) = \epoch(s-1) -2 < \epoch(s-1) = \epoch(\varforvalattime[val=v,time=\slotstart(s-1)]{\bconfirmed})$,  $b' \succeq \varforvalattime[val=v,time=\slotstart(s-1)]{\bconfirmed}$, we can appy \Cref{prop:on-chkp-prec} which, together with $\epoch(\gjattime[time=\slotstart(s),val=v']) = \epoch(s-1)$, allows us to conclude that $\gjattime[time=\slotstart(s-1),val=v] = \votsource[blck=b',time=\slotstart(s-1)] \preceq \chkp(\varforvalattime[val=v,time=\slotstart(s-1)]{\bconfirmed},\epoch(s-1))= \chkp(\varforvalattime[val=v,time=\slotstart(s-1)]{\bconfirmed})= \gjattime[time=\slotstart(s),val=v']$.
            \item[Case 2.2: {$\epoch(\gjattime[time=\slotstart(s-1),val=v])= \epoch(s-1)-1$}.] 
            \Cref{lem:no-prev-epochconflict-chkp-is-justified} implies that $\gjattime[time=\slotstart(s-1),val=v'] = \chkp(\varforvalattime[val=v,time=\slotstart(s-1)]{\bconfirmed},\epoch(s-1)-1)$.
            Then clearly $\gjattime[time=\slotstart(s-1),val=v'] = \chkp(\varforvalattime[val=v,time=\slotstart(s-1)]{\bconfirmed},\epoch(s-1)-1) \preceq \chkp(\varforvalattime[val=v,time=\slotstart(s-1)]{\bconfirmed}) = \gjattime[time=\slotstart(s),val=v']$.
        \end{description}
    \end{description}    
\end{proof}

\begin{lemma}\label{lem:prev-gj-prec-others-gj-alt}
    Pick any $b_c \in  \varforvalattime[val=v,time=\slotstart(\slot(t))]{\bcands}$.
    If
    \begin{enumerate}
        \item $\slotstart(\lastslot(\epoch(t)-1)) \geq \GST$
        \item $\epoch(b_c) \geq \epoch(t)-1$
        \item $\slot(t) \neq \firstslot(\epoch(t))$
    \end{enumerate},
    then
    \begin{enumerate}
        \item $\gjattime[time=\slotstart(\slot(t)-1),val=v] \preceq \gjattime[time=\slotstartslot{t},val=v']$
    \end{enumerate}
\end{lemma}

\begin{proof}
    \Cref{lem:prev-conf-at-least-e-1} implies that $\epoch(\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}) \geq \epoch(t)-1$.
    Then apply \Cref{lem:prev-gj-prec-others-gj}.
\end{proof}

\begin{proof}(that does not require \Cref{lem:prev-gj-prec-others-gj})
    \Cref{lem:prev-conf-at-least-e-1} together with \Cref{lem:bconf-always-canonical} imply $b_c \succeq \varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed} \succeq \gjattime[time=\slotstart(\slot(t)-1),val=v]$.
    Also, due to \Cref{lem:gj-does-not-conflict}, we have that  $b_c \succeq \gjattime[time=\slotstartslot{t},val=v']$.
    Finally, the synchrony assumption implies that $\gjattime[time=\slotstart(\slot(t)-1),val=v] \leq \gjattime[time=\slotstartslot{t},val=v']$ which concludes the proof.
\end{proof}

% \begin{proof}
%     By cases.
%     \begin{description}
%         \item[Case 1: $\epoch(s+1) = \epoch(s)$.]
%         \item[] 
%         \item[Case 2: $\epoch(s+1) = \epoch(s)+1$]  
%     \end{description}
% \end{proof}

% \begin{lemma}\label{lem:gj-does-not-conflict-e-1-old}
%     If
%     \begin{enumerate}
%         \item $\text{\slotstart}(\text{\lastslot}(\text{\epoch}(t) - 1)) \geq \GST$
%         \item $\epoch(\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bcand}) = \epoch(t) - 1$
%     \end{enumerate},
%     then, for any honest validator $v'$,
%     \begin{enumerate}
%         \item $\gjattime[time=\slotstartslot{t},val=v']$ does not conflict with $\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bcand}$
%         \item $\gjattime[val=v', time=\slotstart(\slot(t))] \succeq \gjattime[val=v, time=\slotstart(\slot(t)-1)]$
%     \end{enumerate}
% \end{lemma}

% \begin{proof}(by Roberto)
%     Let $s := \slot(t)$.
%     Note that $\epoch(\varforvalattime[val=v,time=\slotstart(s-1)]{\bcand}) = \epoch(s) - 1 \geq \epoch(s-1)-1$. 
%     From \Cref{lem:gj-at-least-e-2-curr-slot}, we know that $\epoch(\gjattime[time=\slotstartslot{t},val=v']) \in \{\epoch(s)-2,\epoch(s)-1\}$.
%     From \Cref{lem:conf-prev-epoch-then-vs-two-epochs-ago}, we know that $\exists b' \in \viewattime[time=\slotstart(\slot(t)-1),val=v], b' \succeq  \varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed} \land \epoch(\votsource[blck=b',time=\slotstartslot{t}])\geq \epoch(t)-2$.
%     Given that $\epoch(\varforvalattime[val=v,time=\slotstart(s-1)]{\bcand}) = \epoch(s) - 1 \geq \epoch(s-1)-1$, we can apply \Cref{lem:no-conflict-chkp-is-justified} to conclude that if $\epoch(\gjattime[time=\slotstartslot{t},val=v']) = \epoch(s)-1$, then $\gjattime[time=\slotstartslot{t},val=v']$ does not conflict with $\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bcand}$.

% \end{proof}

% \begin{proof}
%     By cases. Let $s := \slot(t)$.
%     \begin{description}
%         \item[Case 1: {$\epoch(\varforvalattime[val=v,time=\slotstart(\slot(t)-2)]{\bconfirmed}) < \epoch(t) - 1$}.]
%             We must have restarted the confirmation chain, otherwise, Condition 2 of the Lemma wouldn't held.
%             Then from lines xxx of \Cref{alg:conffull} and because of the synchrony assumption we have
%             $\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bcand} \succeq \gjattime[val=v',time=\slotstartslot{t}]$
%             which makes Statement 1 and 2 hold.
%         \item[Case 2: {$\epoch(\varforvalattime[val=v,time=\slotstart(\slot(t)-2)]{\bconfirmed}) >= \epoch(t) - 1$}.]
%             Due to lines xxx of \Cref{alg:conffull} we know that
%             $\exists b' \in \viewattime[val=v,time=\slotstart(s-1)], b' \succeq \varforvalattime[val=v,time=\slotstart(s-1)]{\bcand} \land \epoch(\gu(b')) \geq \epoch(s)-2$.
%             Because $\varforvalattime[val=v,time=\slotstart(s-1)]{\bcand} \preceq \varforvalattime[val=v,time=\slotstart(s-1)]{\LMDGHOSTHFC}$
%             we know that $\chkp(\varforvalattime[val=v,time=\slotstart(s-1)]{\bcand}) \succeq \gu(b') \succeq \gjattime[val=v,time=\slotstart(s-1)]$ for this case.
%             \begin{description}
%                 \item[Subcase 1.1: {$\epoch(\gu(b')) > \epoch(s)-2$}].
%                     Thus, $\epoch(\gu(b')) = \epoch(s)-1$.
%                     It is clear that $\gu(b') = \chkp(\varforvalattime[val=v,time=\slotstart(s-1)]{\bcand})$.
%                     Then because of the synchrony assumption
%                     $\gjattime[val=v',time=\slotstart(s)] = \gu(b') = \chkp(\varforvalattime[val=v,time=\slotstart(s-1)]{\bcand}) \succ \gjattime[val=v,time=\slotstart(s-1)]$
%                     which proves Statement 1 and 2.
%                 \item[Subcase 1.2: {$\epoch(\gu(b')) = \epoch(s)-2$}].
%                     Then because of the synchrony assumption $\epoch(\gjattime[val=v',time=\slotstart(s)]) \geq \epoch(s)-2$.
%                     Also note that $\chkp(\varforvalattime[val=v,time=\slotstart(s-1)]{\bcand}) \succ \gu(b')$ in this case.
%                     Suppose $\epoch(\gjattime[val=v',time=\slotstart(s)]) = \epoch(s)-2$,
%                     then clearly $\chkp(\varforvalattime[val=v,time=\slotstart(s-1)]{\bcand}) \succ \gjattime[val=v',time=\slotstart(s)] = \gu(b') \succeq  \gjattime[val=v,time=\slotstart(s-1)]$.
%                     Otherwise $\epoch(\gjattime[val=v',time=\slotstart(s)])$ must be equal to $\epoch(s)-1$ and then
%                     because of the \Cref{lem:no-conflict-chkp-is-justified}
%                     we have $\gjattime[val=v',time=\slotstart(s)] = \chkp(\varforvalattime[val=v,time=\slotstart(s-1)]{\bcand}) \succ \gu(b') \succeq \gjattime[val=v,time=\slotstart(s-1)]$.
%                     In both of these cases Statement 1 and 2 hold.
%             \end{description}

%     \end{description}
% \end{proof}

% \begin{lemma}\label{lem:gj-does-not-conflict}
%     If
%     \begin{enumerate}
%         \item $\slotstart(\firstslot(\epoch(t)-1)) \geq \GST$
%         \item $\epoch(\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bcand}) = \epoch(t)$
%     \end{enumerate},
%     then, for any honest validator $v'$,
%     \begin{enumerate}
%         \item $\gjattime[time=\slotstartslot{t},val=v']$ does not conflict with $\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bcand}$
%         \item $\gjattime[val=v', time=\slotstart(\slot(t))] \succeq \gjattime[val=v, time=\slotstart(\slot(t)-1)]$
%     \end{enumerate}
% \end{lemma}

% \begin{proof}
%     By induction on $\slot(t)$.
%     Let $s := \slot(t)$.
%     \begin{description}
%         \item[Base Case: {$s = \slot(\varforvalattime[val=v]{\tinit})$}.] The Lemma is vacuously true.
%         \item[Inductive Case: {$s \geq \slot(\varforvalattime[val=v]{\tinit})$}.]
%             We assume that the Lemma holds for $s$ and prove that it also holds for $s+1$.
%             \begin{description}
%                 \item[Case 1: {$\epoch(s+1) = \epoch(s)$}.]
%                     Clearly $s-1 > \firstslot(\epoch(s))$, otherwise,
%                     $\epoch(\varforvalattime[val=v,time=\slotstart(s-1)]{\bcand}) = \epoch(s)$ would be impossible.
%                     By \Cref{lem:gj-at-least-e-2-curr-slot} $\epoch(\gjattime[val=v',time=\slotstart(s-1)]) \geq \epoch(s)-2$.
%                     \begin{description}
%                         \item[Subcase 1.1: {$\epoch(\gjattime[val=v,time=\slotstart(s-1)]) > \epoch(s)-2$}.]
%                             Clearly $\epoch(\gjattime[val=v,time=\slotstart(s-1)]) = \epoch(s)-1$ in this case.
%                             Due to line xxx of \Cref{alg:conffull}
%                             $\varforvalattime[val=v,time=\slotstart(s-1)]{\bcand} \succeq \gjattime[val=v,time=\slotstart(s-1)]$,
%                             thus $\gjattime[val=v,time=\slotstart(s-1)] = \chkp(\varforvalattime[val=v,time=\slotstart(s-1)]{\bcand}, \epoch(s)-1)$.
%                             In this case it must be that $\gjattime[val=v',time=\slotstart(s)] \nsucc \gjattime[val=v,time=\slotstart(s-1)]$
%                             as $\gjattime[val=v,time=\slotstart(s-1)]$ has the greatest possible epoch,
%                             thus by the inductive hypothesis $\gjattime[val=v',time=\slotstart(s)] = \gjattime[val=v,time=\slotstart(s-1)]$.
%                             Following the above reasoning $\gjattime[val=v',time=\slotstart(s+1)] = \gjattime[val=v,time=\slotstart(s)] = \gjattime[val=v,time=\slotstart(s-1)]$
%                             which proves Statement 2. Due to line xxx of \Cref{alg:conffull}
%                             $\varforvalattime[val=v,time=\slotstart(s)]{\bcand} \succeq \gjattime[val=v,time=\slotstart(s)]$
%                             proving Statement 1.
%                         \item[Subcase 1.2 (Sketch): {$\epoch(\gjattime[val=v,time=\slotstart(s-1)]) = \epoch(s)-2$}.]
%                             By the inductive hypothesis
%                             $\gjattime[val=v',time=\slotstart(s+1)] \in \{\gjattime[val=v,time=\slotstart(s-1)], \chkp(\varforvalattime[val=v,time=\slotstart(s-1)]{\bcand}, \epoch(s)-1)\}$,
%                             so does the $\gjattime[val=v,time=\slotstart(s)]$.
%                             $\varforvalattime[val=v,time=\slotstart(s)]{\bcand} \succeq \chkp(\varforvalattime[val=v,time=\slotstart(s-1)]{\bcand}, \epoch(s)-1) \succeq \gjattime[val=v,time=\slotstart(s-1)]$.
%                             Thus both statements hold.                            
%                     \end{description}
%                 \item[Case 2: {$\epoch(s+1) > \epoch(s)$}.]
%                     Then we have $\epoch(\varforvalattime[val=v,time=\slotstart((s+1)-1)]{\bcand}) = \epoch(s+1)-1$.
%                     Apply \Cref{lem:gj-does-not-conflict-e-1}.
%             \end{description}
%     \end{description}
% \end{proof}

\RS{Done till here. Some of the Lemmas below might not be necessary anymore. Possibly because they have been replaced by a stronger Lemma above.}

\begin{lemma}\label{lem:gj-at-least-e-2-curr-slot}
    Pick any $b_c \in  \varforvalattime[val=v,time=\slotstart(\slot(t))]{\bcands}$.
    If
    \begin{enumerate}
        \item $\slotstart(\lastslot(\epoch(t)-1)) \geq \GST$
        \item $\epoch(b_c) \geq \epoch(t)-1$
    \end{enumerate},
    then, for any honest validator $v'$,
    \begin{enumerate}
        \item $\epoch(\gjattime[val=v',time=\slotstart(\slot(t))]) \geq \epoch(t)-2$
    \end{enumerate}
\end{lemma}

\begin{proof}
From \Cref{lem:vs-at-least-e-2} we know that there exists an honest validator $v_h$ such that $\exists b' \in \viewattime[time=\votingtime(\slot(t)-1),val=v_h], \epoch(\votsource[blck=b',time=\slotstartslot{t}])\geq \epoch(t)-2$.
Then, because of the synchrony assumption, $b' \in \viewattime[time=\slotstart(\slot(t)),val=v']$.
Finally, by the Definition 3 of the paper $\epoch(\gjattime[val=v',time=\slotstartslot{t}]) = \epoch(\max(\{\votsource[blck=b,time=t]: b \in \viewatstslottime[val=v',time=t]\}))
\geq \epoch(\votsource[blck=b',time=\slotstartslot{t}]) \geq \epoch(t) - 2$.
\end{proof}

\MK{\Cref{lem:gj-at-least-e-2-curr-slot} might not be needed as we have \Cref{lem:gj-at-least-e-2-alt}}.



\begin{definition}
    We define $\ceba[val=v,time=\slotstartslot{t}]$ as the source of the effective balance assignment used by the execution of the Fast Confirmation Rule algorithm at the time $t = \slotstartslot{t}$.
    \begin{equation*}
        {\ceba[val=v,time=\slotstartslot{t}]:=}
        \begin{cases}
            {\guattime[val=v,time=\slotstart(\slot(t)-1)], \text{if } \slot(t)=\firstslot(\epoch(t))},\\
            {\gjattime[val=v,time=\slotstart(\slot(t)-1)], \text{otherwise}}.
        \end{cases}
    \end{equation*}
\end{definition}

\begin{lemma}\label{lem:gj-desc-c-w}
    Pick any $b_c \in  \varforvalattime[val=v,time=\slotstart(\slot(t))]{\bcands}$, any time $t' \geq \slotstartslot{t}$ and any honest validator $v'$.
    If
    \begin{enumerate}
        \item $\slotstart(\lastslot(\epoch(t)-1)) \geq \GST$
        \item $\epoch(b_c) \geq \epoch(t)-1$
        \item $b_c \in \filtered[val=v',time=t']$
    \end{enumerate},
    then
    \begin{enumerate}
        \item $\ceba[val=v,time=\slotstartslot{t}] \preceq \gjattime[val=v',time=t']$.
    \end{enumerate}
\end{lemma}

\begin{proof}
    From \Cref{lem:gu-prec-gj-start-epoch-when-prec-conf-from-at-least-prev-epoch} and \Cref{lem:prev-gj-prec-others-gj-alt} we know that $\ceba[val=v,time=\slotstartslot{t}] \preceq \gjattime[val=v',time=\slotstartslot{t}]$.
    Then due to \Cref{lem:gj-does-not-conflict} $\ceba[val=v,time=\slotstartslot{t}] \preceq \gjattime[val=v',time=\slotstartslot{t}] \preceq b_c$.
    From the definition of the greatest justified checkpoint we have $\epoch(\ceba[val=v,time=\slotstartslot{t}]) \leq \epoch(\gjattime[val=v',time=\slotstartslot{t}]) \leq \epoch(\gjattime[val=v',time=t'])$.
    Given that $b_c \in \filtered[val=v',time=t']$, we know that $b_c$ does not conflict with $\gjattime[val=v',time=t']$.
    With all this in mind we proceed by cases.
    \begin{description}
        \item[Case 1: {$\gjattime[val=v',time=t'] \preceq b_c$}.] Then $\ceba[val=v,time=\slotstartslot{t}] \preceq \gjattime[val=v',time=\slotstartslot{t}] \preceq \gjattime[val=v',time=t'] \preceq b_c$.
        \item[Case 2: {$\gjattime[val=v',time=t'] \npreceq b_c$}.] Implies $b_c \prec \gjattime[val=v',time=t']$, then $\ceba[val=v,time=\slotstartslot{t}] \preceq \gjattime[val=v',time=\slotstartslot{t}] \preceq b_c \prec \gjattime[val=v',time=t']$.
    \end{description}
    In either case $\ceba[val=v,time=\slotstartslot{t}] \preceq \gjattime[val=v',time=t']$.
\end{proof}

\begin{lemma}\label{lem:canonical-if-in-filtered}
    Pick any $b_c \in  \varforvalattime[val=v,time=\slotstart(\slot(t))]{\bcands}$, any time $t' \geq \slotstartslot{t}$ and any honest validator $v'$.
    If
    \begin{enumerate}
        \item $\slotstart(\lastslot(\epoch(t)-1)) \geq \GST$
        \item $\epoch(b_c) \geq \epoch(t)-1$
        \item $b_c \in \filtered[val=v',time=t']$
    \end{enumerate},
    then
    \begin{enumerate}
        \item $b \preceq \LMDGHOSTHFC(\viewattime[val=v',time=t'])$.
    \end{enumerate}
\end{lemma}

\begin{proof}
    (Sketch)
    By induction on $t' \geq \slotstartslot{t}$.
    \begin{description}
        \item[Base case: {$t' < \slotstartslot{t}$}.] The Lemma is vacuously true.
        \item[Inductive case: {$t' \geq \slotstartslot{t}$}.] Let $s:=\slot(t)$, $s':=\slot(t')$
        We assume that the Lemma holds at time $t''$ such that $t'' < t'$ and prove that it also holds at time $t'$.
        From \Cref{lem:gj-desc-c-w} we know that $\ceba[val=v,time=\slotstartslot{t}] \preceq \gjattime[val=v',time=t']$.
        Then the fact that we re-confirm the confirmed chain at the beginning of each epoch together with the reasoning from the Lemma 6 of the Paper should conclude the proof.
    \end{description}
\end{proof}

\begin{lemma}\label{lem:gj-does-not-conflict-during-e}
    Pick any $b_c \in  \varforvalattime[val=v,time=\slotstart(\slot(t))]{\bcands}$, any honest validator $v'$ and time $t' \geq \slotstartslot{t}$ such that $\epoch(t') = \epoch(t)$.
    If
    \begin{enumerate}
        \item $\slotstart(\lastslot(\epoch(t)-1)) \geq \GST$
        \item $\epoch(b_c) \geq \epoch(t)-1$
    \end{enumerate},
    then,
    \begin{enumerate}
        \item No checkpoint $\chkp'$ conflicting with $b_c$ such that $\epoch(\chkp') = \epoch(t)-1$ can ever be justified.
        \item $b_c \succeq \gjattime[val=v',time=t']$
    \end{enumerate}
\end{lemma}

\begin{proof}
    By induction on $t'$.
    \begin{description}
        \item[Base case: {$t' = \slotstartslot{t}$}.] Apply \Cref{lem:gj-does-not-conflict}.
        \item[Inductive case: {$t' \geq \slotstartslot{t}$}.] We assume that the Lemma holds for any $t''$ such that $\slotstartslot{t} \leq t'' < t'$ and we prove that it holds at time $t'$ as well.
        Due to \Cref{lem:no-prev-epochconflict-chkp-is-justified} and the synchrony assumption we know that no checkpoint $\chkp'$ such that $\epoch(\chkp')=\epoch(t)-1$ conflicting with $\chkp(b_c, \epoch(t)-1)$ can ever be justified which proves the first statement.
        Then we proceed by cases.
        \begin{description}
            \item[Case 1: {$\epoch(\gjattime[val=v',time=t']) = \epoch(\gjattime[val=v',time=t''])$}.] Apply the inductive hypothesis.
            \item[Case 2: {$\epoch(\gjattime[val=v',time=t']) \neq \epoch(\gjattime[val=v',time=t''])$}.]
            Then \Cref{lem:gj-at-least-e-2-alt} implies $\epoch(t)-2 = \epoch(\gjattime[val=v',time=t'']) < \epoch(\gjattime[val=v',time=t']) = \epoch(t)-1$.
            The fact that no checkpoint $\chkp'$ conflicting with $b_c$ such that $\epoch(\chkp') = \epoch(t)-1$ can ever be justified and also that $\epoch(b_c) \geq \epoch(t)-1$ implies $\gjattime[val=v',time=t'] \preceq b_c$ in this case.
        \end{description}
    \end{description}
\end{proof}

\begin{lemma}\label{lem:bcand-in-filtered-during-e}
    Pick any $b_c \in  \varforvalattime[val=v,time=\slotstart(\slot(t))]{\bcands}$, any time $t' \geq \slotstartslot{t}$ such that $\epoch(t')=\epoch(t)$ and any honest validator $v'$.
    If
    \begin{enumerate}
        \item $\slotstart(\lastslot(\epoch(t)-1)) \geq \GST$
        \item $\epoch(b_c) \geq \epoch(t)-1$
    \end{enumerate},
    then
    \begin{enumerate}
        \item $b_c \in \filtered[val=v',time=t']$.
    \end{enumerate}
\end{lemma}

\begin{proof}
    From \Cref{lem:gj-does-not-conflict-during-e} we know that $\gjattime[val=v',time=t'] \preceq b_c$.
    From \Cref{lem:vs-at-least-e-2} we know that $\exists b' \in \left(\viewattime[time=\votingtime(\slot(t)-1),val=v'] \cap \viewattime[time=\slotstart(\slot(t)),val=v]\right), b' \succeq b_c \land \epoch(\votsource[blck=b',time=\slotstartslot{t}])\geq \epoch(t)-2$.
    All these together with the synchrony assumption concludes the proof.
\end{proof}

\begin{assumption}\label{assm:bcand-chkp-in-allu}
    (Strenghthened Assumption 5.3 of the Paper).
    Given a block $b$ and epoch $e \geq \epoch(b)$ such that $\slotstart(e+1) \geq \GST$, if for any time $t$ with $\epoch(t) = e+1$ and honest validator $v$,
    \begin{enumerate}
        \item $b$ is canonical in the view of $v$ at time $t$,
        \item for any block $b' \succeq \chkp(b,e)$ in the view of $v$ we have enough support to justify $\chkp(b,e)$,
    \end{enumerate}
    then, by time $\slotstart(e+2)$, the view of validator $v$ includes a block $b' \succeq b$ such that $\epoch(b') < e+2 \land \chkp(b,e) \in \allU(b')$.
\end{assumption}

\begin{lemma}\label{lem:if-firstslot-chkp-bcand-is-in-allu}
    Pick any $b_c \in  \varforvalattime[val=v,time=\slotstart(\slot(t))]{\bcands}$, any time $t'$ such that $t' < \slotstart(\epoch(t)+1)$ and any honest validator $v'$.
    If
    \begin{enumerate}
        \item $\slotstart(\epoch(t)-1) \geq \GST$
        \item $\epoch(b_c) = \epoch(t)-1$
        \item $\slot(t) = \firstslot(\epoch(t))$
    \end{enumerate},
    then
    \begin{enumerate}
        \item $\exists b' \in \viewattime[val=v',time=t']$ such that $b' \succeq b_c \land \chkp(b_c) \in \allU(b')$.
    \end{enumerate}
\end{lemma}

\begin{proof}
    \Cref{lem:bcand-in-filtered-during-e} together with \Cref{lem:canonical-if-in-filtered} implies $b_c \preceq \LMDGHOSTHFC(\viewattime[val=v',time=t''])$ for any $t''$ such that $\epoch(t'') = \epoch(t)$.
    Then \Cref{assm:bcand-chkp-in-allu} and \Cref{lem:no-prev-epochconflict-chkp-is-justified} together with the synchrony concludes the proof.
\end{proof}

\begin{lemma}\label{lem:no-conflicting-chkp-justified-in-e-e+1}
    Pick any $b_c \in  \varforvalattime[val=v,time=\slotstart(\slot(t))]{\bcands}$.
    If
    \begin{enumerate}
        \item $\slotstart(\lastslot(\epoch(t)-1)) \geq \GST$
        \item $\epoch(b_c) \geq \epoch(t)-1$
    \end{enumerate},
    then,
    \begin{enumerate}
        \item No checkpoint $\chkp'$ conflicting with $b_c$ such that $\epoch(\chkp') \in \left\{\epoch(t)-1,\epoch(t)\right\}$ can ever be justified.
    \end{enumerate}
\end{lemma}

\begin{proof}
    By cases.
    \begin{description}
        \item[Case 1: {$\epoch(b_c) = \epoch(t)$}.]
        Due to \Cref{lem:no-curr-epochconflict-chkp-is-justified} and the synchrony assumption, no checkpoint $\chkp'$ such that $\epoch(\chkp') = \epoch(t)$ conflicting with $b_c$ can ever be justified in this case.
        \item[Case 2: {$\epoch(b_c) \neq \epoch(t)$}.] Implies $\epoch(b_c) = \epoch(t)-1$. By sub cases.
        \begin{description}
            \item[Case 2.1: {$\slot(t) = \firstslot(\epoch(t))$}.] Due to \Cref{lem:bcand-in-filtered-during-e} together with \Cref{lem:canonical-if-in-filtered} $b_c \preceq \LMDGHOSTHFC(\viewattime[val=v',time=t''])$ for any time $t''$ such that $\epoch(t'')=\epoch(t)$.
            Which implies that all honest validators in the committees of $\epoch(t)$ send their FFG votes targeting a checkpoint that is a descendant of $b_c$.
            This, the Property 1.6 of the paper and the synchrony assumption imply that no checkpoint $\chkp'$ conflicting with $b_c$ such that $\epoch(\chkp')=\epoch(t)$ can ever be justified in this case.
            \item[Case 2.2: {$\slot(t) \neq \firstslot(\epoch(t))$}.] By contradiction.
            Suppose $\exists b', \chkp(b',\epoch(t)) \in \allU(\viewattime[val=v',time=t'])$ and $b_c \npreceq \chkp(b',\epoch(t))$.
            Then, given the synchrony assumption and the fact that $\epoch(b_c)=\epoch(t)-1$,
            
            $\willNoConflictingChkpBeJustified_v(\chkp(b', \epoch(t)))$ check in \Cref{ln:if-prev-epoch} and \Cref{ln:if-to-set-bcand-to-btcand} must have never be true,
            thus either $\slot(t) = \firstslot(\epoch(t))$ or $\epoch(b_c) \neq \epoch(t)-1$.
        \end{description}
    \end{description}
    All the above together with \Cref{lem:gj-does-not-conflict-during-e} concludes the proof.
\end{proof}

\begin{lemma}\label{lem:gj-does-not-conflict-during-e+1}
    Pick any $b_c \in  \varforvalattime[val=v,time=\slotstart(\slot(t))]{\bcands}$, any honest validator $v'$ and time $t' \geq \slotstartslot{t}$ such that $\epoch(t') \in \left\{\epoch(t),\epoch(t)+1\right\}$.
    If
    \begin{enumerate}
        \item $\slotstart(\lastslot(\epoch(t)-1)) \geq \GST$
        \item $\epoch(b_c) \geq \epoch(t)-1$
    \end{enumerate},
    then,
    \begin{enumerate}
        \item $b_c$ does not conflict with $\gjattime[val=v',time=t']$.
    \end{enumerate}
\end{lemma}

\begin{proof}
    By induction on $t'$.
    \begin{description}
        \item[Base case: {$t' = \slotstartslot{t}$}.] Apply \Cref{lem:gj-does-not-conflict}.
        \item[Inductive case: {$t' \geq \slotstartslot{t}$}.] We assume that the Lemma holds for any $t''$ such that $\slotstartslot{t} \leq t'' < t'$ and we prove that it holds at time $t'$ as well.
        By cases.
        \begin{description}
            \item[Case 1: {$\epoch(\gjattime[val=v',time=t']) = \epoch(\gjattime[val=v',time=t''])$}.] Apply the inductive hypothesis.
            \item[Case 2: {$\epoch(\gjattime[val=v',time=t']) \neq \epoch(\gjattime[val=v',time=t''])$}.]
            Then \Cref{lem:gj-at-least-e-2-alt} and the definition of the greatest justified checkpoint imply $\epoch(t)-2 \leq \epoch(\gjattime[val=v',time=t'']) < \epoch(\gjattime[val=v',time=t']) \leq \epoch(t)$, thus $\epoch(\gjattime[val=v',time=t']) \in \left\{\epoch(t)-1, \epoch(t)\right\}$.
            Then \Cref{lem:no-conflicting-chkp-justified-in-e-e+1} concludes the proof for this case.
        \end{description}
    \end{description}
\end{proof}

\begin{lemma}\label{lem:find-latest-conf-desc-output-in-filtered-during-e+1}
    Let $b_o := \varforvalattime[val=v]{\mathit{find\_latest\_confirmed\_descendant}}(b_c)$.
    Pick any honest validator $v'$ and time $t'$ such that $\epoch(t') = \epoch(t)+1$.
    If
    \begin{enumerate}
        \item $\slotstart(\epoch(t)-1) \geq \GST$
        \item $\epoch(b_c) \geq \epoch(t)-1$
        \item $b_o \neq b_c$
    \end{enumerate},
    then
    \begin{enumerate}
        \item $\exists b' \in \viewattime[val=v',time=t']$ such that $b' \succeq b_o \land \votsource[blck=b',time=\epoch(t')] \geq \epoch(t')-2$.
    \end{enumerate}
\end{lemma}

\begin{proof}
    By cases.
    \begin{description}
        \item[Case 1: {$\slot(t) = \firstslot(\epoch(t))$}.] Implies $\epoch(b_o)=\epoch(t)-1$.
        \Cref{lem:bcand-in-filtered-during-e} together with \Cref{lem:canonical-if-in-filtered} implies $b_o \preceq \LMDGHOSTHFC(\viewattime[val=v',time=t''])$ for any $t''$ such that $\epoch(t'') = \epoch(t)$.
        Then due to \Cref{lem:if-firstslot-chkp-bcand-is-in-allu} we know that $\exists b' \in \viewattime[val=v',time=t']$ such that $b' \succeq b_o \land \votsource[blck=b',time=\epoch(t')] \geq \epoch(t')-2$.
        \item[Case 2: {$\slot(t) \neq \firstslot(\epoch(t))$}.]
        Because of the check in \Cref{ln:if-prev-epoch} and \Cref{ln:second-if} we know that $\exists b' \in \viewattime[val=v,time=\slotstartslot{t}]$ such that $b' \succeq b \land \gu(b') \geq \epoch(t)-1$.
        This, the fact that $\epoch(t)-1 = \epoch(t')-2$ and the synchrony assumption imply $\exists b' \in \viewattime[val=v',time=t']$ such that $b' \succeq b_o \land \votsource[blck=b',time=\epoch(t')] \geq \epoch(t')-2$.
    \end{description}
\end{proof}

\begin{lemma}\label{lem:if-restarted-bcand-in-filtered-during-e-e+1}
    Pick any $b_c \in  \varforvalattime[val=v,time=\slotstart(\slot(t))]{\bcands}$, any time $t'$ such that $\epoch(t') = \epoch(t)+1$ and any honest validator $v'$.
    If
    \begin{enumerate}
        \item $\slotstart(\slot(t)-1) \geq \GST$
        \item $\epoch(\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}) < \epoch(t)-1$
        \item $\epoch(b_c) \geq \epoch(t)-1$
    \end{enumerate},
    then
    \begin{enumerate}
        \item $b_c \in \filtered[val=v',time=t']$
    \end{enumerate}
\end{lemma}

\begin{proof}
    It must be that all conditions in \Cref{ln:start-conf-chain} are true, otherwise, it is impossible to satisfy the Lemma statement.
    Now by cases on the first line, in order of execution of the Fast Confirmation Rule algorithm at time $\slotstartslot{t}$, where $\bcand = b_c$. 
    \begin{description}
        \item[\Cref{ln:set-bcand-beginning-of-get-latest-confirmed}.] $\epoch(b_c) < \epoch(t)-1$ thus the Lemma is vacuously true.
        \item[\Cref{ln:set-bcand-to-fin}.] $\epoch(b_c) < \epoch(t)-1$ thus the Lemma is vacuously true.
        \item[\Cref{ln:set-bcan-on-start-conf-chain}.] Due to \Cref{lem:gu-e-1-canonical} $b_c \preceq \LMDGHOSTHFC(\viewattime[val=v',time=t'])$ which implies $b_c \in \filtered[val=v',time=t']$.
        \item[\Cref{ln:set-bcand-to-output-find-latest}.]
        Let $b_o := \varforvalattime[val=v]{\mathit{find\_latest\_confirmed\_descendant}}(b_c)$.
        By cases.
        \begin{description}
            \item[Case 1: {$b_o = b_c$}.] It must be that $b_o = \block(\guattime[val=v,time=\slotstart(\slot(t)-1)])$ in this case. Then apply \Cref{lem:gu-e-1-canonical}.
            \item[Case 2: {$b_o \neq b_c$}.] Due to \Cref{lem:find-latest-conf-desc-output-in-filtered-during-e+1} we know that $\exists b' \in \viewattime[val=v',time=t']$ such that $b' \succeq b_o \land \votsource[blck=b',time=\epoch(t')] \geq \epoch(t')-2$, then \Cref{lem:gj-does-not-conflict-during-e+1} concldues the proof for this case.
        \end{description}
    \end{description}
\end{proof}

\begin{lemma}\label{lem:bcand-in-filtered-during-e-e+1}
    Pick any $b_c \in  \varforvalattime[val=v,time=\slotstart(\slot(t))]{\bcands}$, any time $t' \geq \slotstartslot{t}$ such that $\epoch(t') \in \left\{\epoch(t), \epoch(t)+1\right\}$ and any honest validator $v'$.
    If
    \begin{enumerate}
        \item $\slotstart(\epoch(t)-1) \geq \GST$
        \item $\epoch(b_c) \geq \epoch(t)-1$
    \end{enumerate},
    then
    \begin{enumerate}
        \item $b_c \in \filtered[val=v',time=t']$
    \end{enumerate}
\end{lemma}

\begin{proof}
    By induction on $\slot(t)$. Let $s := \slot(t)$.
    \begin{description}
        \item[Base Case: {$s = \slot(\varforvalattime[val=v]{\tinit})$}.] The Lemma is vacuously true.
        \item[Inductive Case: {$s \geq \slot(\varforvalattime[val=v]{\tinit})$}.] We assume that the Lemma holds for slot $s$ and prove that it also holds for slot $s+1$.
        Pick any $b_c \in \varforvalattime[val=v,time=\slotstart(s+1)]{\bcands}$ such that $\epoch(b_c) \geq \epoch(s+1)-1$. By cases.
        \begin{description}
            \item[Case 1: {$\epoch(t') = \epoch(t)$}.] Apply \Cref{lem:bcand-in-filtered-during-e}.
            \item[Case 2: {$\epoch(t') = \epoch(t)+1$}.]
            By sub cases.
            \begin{description}
                \item[Case 2.1: {$\epoch(\varforvalattime[val=v,time=\slot(s)]{\bconfirmed}) < \epoch(s+1)-1$}.] Apply \Cref{lem:if-restarted-bcand-in-filtered-during-e-e+1}.
                \item[Case 2.2: {$\epoch(\varforvalattime[val=v,time=\slot(s)]{\bconfirmed}) \geq \epoch(s+1)-1$}.]
                Now by cases on the first line, in order of execution of the Fast Confirmation Rule algorithm at time $\slotstart(s+1)$, where $\bcand = b_c$. 
                \begin{description}
                    \item[\Cref{ln:set-bcand-beginning-of-get-latest-confirmed}.] Given that $b_c = \varforvalattime[val=v,time=\slot(s)]{\bconfirmed} \in \varforvalattime[val=v,time=\slotstart(s)]{\bcands}$ in this case, the inductive hypothesis concludes the proof.
                    \item[\Cref{ln:set-bcand-to-fin}.] Impossible, as at this line $\epoch(\varforvalattime[val=v,time=\slot(s)]{\bconfirmed}) < \epoch(s+1)-1$, but we assume $\epoch(\varforvalattime[val=v,time=\slot(s)]{\bconfirmed}) \geq \epoch(s+1)-1$.
                    \item[\Cref{ln:set-bcan-on-start-conf-chain}.] Impossible, as at this line $\epoch(\varforvalattime[val=v,time=\slot(s)]{\bconfirmed}) < \epoch(s+1)-1$, but we assume $\epoch(\varforvalattime[val=v,time=\slot(s)]{\bconfirmed}) \geq \epoch(s+1)-1$.
                    \item[\Cref{ln:set-bcand-to-output-find-latest}.]
                    Let $b_o := \varforvalattime[val=v]{\mathit{find\_latest\_confirmed\_descendant}}(b_c)$.
                    By sub cases again.
                    \begin{description}
                        \item[Case 2.2.1: {$b_o = b_c$}.] It must be that $b_o = \varforvalattime[val=v,time=\slot(s)]{\bconfirmed}$ in this case. Then apply the inductive hypothesis.
                        \item[Case 2.2.2: {$b_o \neq b_c$}.] Due to \Cref{lem:find-latest-conf-desc-output-in-filtered-during-e+1} we know that $\exists b' \in \viewattime[val=v',time=t']$ such that $b' \succeq b_o \land \votsource[blck=b',time=\epoch(t')] \geq \epoch(t')-2$, then \Cref{lem:gj-does-not-conflict-during-e+1} concldues the proof for this case.
                    \end{description}
                \end{description}
            \end{description}
        \end{description}
    \end{description}
\end{proof}

\begin{lemma}\label{lem:chkp-bcand-is-in-allu}
    Pick any $b_c \in  \varforvalattime[val=v,time=\slotstart(\slot(t))]{\bcands}$, any time $t'$ such that $t' < \slotstart(\epoch(t)+2)$ and any honest validator $v'$.
    If
    \begin{enumerate}
        \item $\slotstart(\epoch(t)-1) \geq \GST$
        \item $\epoch(b_c) \geq \epoch(t)-1$
    \end{enumerate},
    then
    \begin{enumerate}
        \item $\exists b' \in \viewattime[val=v',time=t']$ such that $b' \succeq b_c \land \chkp(b_c) \in \allU(b')$.
    \end{enumerate}
\end{lemma}

\begin{proof}
    By cases.
    \begin{description}
        \item[Case 1: {$\slot(t)=\firstslot(\epoch(t))$}.] Implies $\epoch(b_c) = \epoch(t)-1$. Apply \Cref{lem:if-firstslot-chkp-bcand-is-in-allu}.
        \item[Case 2: {$\slot(t) \neq \firstslot(\epoch(t))$}.] \Cref{lem:bcand-in-filtered-during-e-e+1} together with \Cref{lem:canonical-if-in-filtered} implies $b_c \preceq \LMDGHOSTHFC(\viewattime[val=v',time=t''])$ for any $t''$ such that $\epoch(t'') = \epoch(t)+1$. By sub cases.
        \begin{description}
            \item[Case 2.1: {$\epoch(b_c) = \epoch(t)-1$}.] Then \Cref{assm:bcand-chkp-in-allu} and \Cref{lem:no-prev-epochconflict-chkp-is-justified} together with the synchrony assumption concludes the proof.
            \item[Case 2.2: {$\epoch(b_c) \neq \epoch(t)-1$}.] Implies $\epoch(b_c)=\epoch(t)$. Then \Cref{assm:bcand-chkp-in-allu} and \Cref{lem:no-curr-epochconflict-chkp-is-justified} together with the synchrony assumption concludes the proof.
        \end{description}
    \end{description}
\end{proof}

\begin{lemma}\label{lem:bcand-canonical}
    Pick any $b_c \in  \varforvalattime[val=v,time=\slotstart(\slot(t))]{\bcands}$, any time $t' \geq \slotstartslot{t}$ and any honest validator $v'$.
    If
    \begin{enumerate}
        \item $\slotstart(\epoch(t)-1) \geq \GST$
        \item $\epoch(b_c) \geq \epoch(t)-1$
    \end{enumerate},
    then,
    \begin{enumerate}
        \item $b_c \preceq \LMDGHOSTHFC(\viewattime[val=v',time=t'])$.
    \end{enumerate}
\end{lemma}

\begin{proof}
    By induction on $t' \geq \slotstartslot{t}$.
    \begin{description}
        \item[Base case: {$\epoch(t') \in \left[\epoch(t),\epoch(t)+1\right]$}.]
        \Cref{lem:bcand-in-filtered-during-e-e+1} and \Cref{lem:canonical-if-in-filtered} conclude the proof for this case.
        \item[Inductive case: {$\epoch(t') > \epoch(t)+1$}.] We assume that the Lemma holds for any $t'' \geq t$ such that $\epoch(t'') < \epoch(t')$ and prove that it also holds for $t'$.
        From \Cref{lem:chkp-bcand-is-in-allu} we know that for at the time $t''' < \slotstart(\epoch(t)+1)$ $\exists b' \in \viewattime[val=v',time=t''']$ such that $b' \succeq b_c \land \chkp(b_c) \in \allU(b')$.
        This and the definition of the greatest justified checkpoint imply $\epoch(\gjattime[val=v',time=t']) \geq \epoch(\chkp(b_c))$. By cases.
        \begin{description}
            \item[Case 1: {$\epoch(\gjattime[val=v',time=t']) = \epoch(\chkp(b_c))$}.] Clearly, $\gjattime[val=v',time=t'] = \chkp(b_c)$ in this case. Also this and the definition of the greatest justified checkpoint implies $\gjblock(b') = \chkp(b_c)$ thus $b_c \in \filtered[val=v',time=t']$.
            \item[Case 2: {$\epoch(\gjattime[val=v',time=t']) \neq \epoch(\chkp(b_c))$}.]
            By the definition of the greatest justified checkpoint, $\epoch(\gjattime[val=v',time=t']) \leq \epoch(t')-1$ which implies $\epoch(\chkp(b_c)) < \epoch(\gjattime[val=v',time=t']) \leq \epoch(t'')$ for this case.
            From the inductive hypothesis we know that $b_c \preceq \LMDGHOSTHFC(\viewattime[val=v',time=t''])$ which implies that during each epoch $e \in \left[\epoch(t), \epoch(t'')\right]$ all honest validators cast their FFG votes in the support of $\chkp(b'',e)$ such that $b'' \succeq b$.
            Thus, given the synchrony assumption no checkpoint $\chkp'$ conflicting with $b_c$ such that $\epoch(\chkp') \in \left[\epoch(t), \epoch(t'')\right]$ can ever be justified.
            Given that, we conclude $b_c \prec \gjattime[val=v',time=t']$ which implies $b_c \in \filtered[val=v',time=t']$.
        \end{description}
        We have show that $b_c \in \filtered[val=v',time=t']$, then \Cref{lem:canonical-if-in-filtered} concludes the proof.
    \end{description}
\end{proof}

\begin{lemma}
    Take $b = \varforvalattime[val=v,time=\slotstartslot{t}]{\bconfirmed}$.
    If
    \begin{enumerate}
        \item $\slotstart(\epoch(t)-1) \geq \GST$
        \item $\epoch(b) \geq \epoch(t)-1$
    \end{enumerate},
    then,
    \begin{enumerate}
        \item $\canonical[blck=b,time=t]$
    \end{enumerate}
\end{lemma}

\begin{proof}
    Follows from \Cref{lem:bcand-canonical} and the fact that $\bconfirmed[val=v,time=\slotstart(\slot(t))] \in \varforvalattime[val=v,time=\slotstart(\slot(t))]{\bcands}$.
\end{proof}

\MK{Done till here. The rest of the lemmas must be revisited as might not be needed.}



\RS{Test}



\begin{lemma}\label{lem:bcand-prev-epoch-no-conflict-with-gj}
    Pick any $b_c \in  \varforvalattime[val=v,time=\slotstart(\slot(t))]{\bcands}$.
    If
    \begin{enumerate}
        \item $\slotstart(\firstslot(\epoch(t)-1)) \geq \GST$
        \item $\epoch(b_c) = \epoch(t)-1$
    \end{enumerate},
    then for any honest validator $v'$ and time $t' \geq \slotstartslot{t}$ such that $\epoch(t') \in \left\{\epoch(t), \epoch(t)+1\right\}$,
    \begin{enumerate}
        \item $b_c$ does not conflict with $\gjattime[val=v',time=t']$
    \end{enumerate}
\end{lemma}



\begin{proof}
    By induction on $t'$.
    \begin{description}
        \item[Base case: {$t' = \slotstartslot{t}$}.]
        Due to \Cref{lem:gj-does-not-conflict} for any $b_c \in \varforvalattime[val=v,time=\slotstart(\slot(t))]{\bcands}$, $\epoch(b_c) = \epoch(t)-1$, $b_c \succeq \gjattime[val=v',time=\slotstartslot{t}]$ which concludes the proof for the base case.
        \item[Inductive case: {$t' \geq \slotstartslot{t}$}.] We assume that the Lemma holds for any time $t''$ such that $t \leq t'' < t'$ and prove that it holds at time $t'$ as well.
        By cases.
        \begin{description}
            \item[Case 1: {$\epoch(\gjattime[val=v',time=t']) = \epoch(\gjattime[val=v',time=t''])$}.]
            It implies $\gjattime[val=v',time=t'] = \gjattime[val=v',time=t'']$ and then the inductive hypothesis concludes the proof for this case.
            \item[Case 2: {$\epoch(\gjattime[val=v',time=t']) \neq \epoch(\gjattime[val=v',time=t''])$}.]
            \Cref{lem:gj-at-least-e-2-alt} implies $\epoch(t)-2 \leq \epoch(\gjattime[val=v',time=t'']) < \epoch(\gjattime[val=v',time=t']) \leq \epoch(t)$.
            By sub cases.
            \begin{description}
                \item[Case 2.1: {$\epoch(\gjattime[val=v',time=t']) = \epoch(t)-1$}.]
                Apply \Cref{lem:bcand-prev-epoch-descendant-of-gj-eq-e-1}.
                \item[Case 2.2: {$\epoch(\gjattime[val=v',time=t']) \neq \epoch(t)-1$}.]
                Given that $\epoch(\gjattime[val=v',time=t']) \neq \epoch(\gjattime[val=v',time=t''])$ and $\epoch(t)-2 \leq \epoch(\gjattime[val=v',time=t'']) \leq \epoch(\gjattime[val=v',time=t']) \leq \epoch(t)$,
                it must be that $\epoch(\gjattime[val=v',time=t']) = \epoch(t)$, it implies $\exists b' \in \viewattime[val=v',time=t'], \chkp(b', \epoch(t)) \in \allU(\viewattime[val=v',time=t'])$. Then apply \Cref{lem:bcand-prev-epoch-descendant-of-gj-eq-e}.
            \end{description}
        \end{description}
    \end{description}
\end{proof}

\begin{lemma}\label{lem:gj-at-least-e-2}
    If
    \begin{enumerate}
        \item $\text{\slotstart}(\text{\lastslot}(\text{\epoch}(t) - 1)) \geq \GST$
        \item $\slot(t) > \text{\firstslot}(\epoch(t))$
        \item $\epoch(\varforvalattime[val=v,time=\slotstartslot{t}]{\bcand}) \geq \epoch(t)-1$
    \end{enumerate},
    then, for any honest validator $v'$,
    \begin{enumerate}
        \item $\epoch(\gjattime[val=v',time=\slotstart(\slot(t)-1)]) \geq \epoch(t)-2$
    \end{enumerate}
\end{lemma}

\begin{proof}
Given Condition 2 and 3 of the Lemma's statement we apply \Cref{lem:prev-conf-at-least-e-1} to conclude
$\epoch(\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}) \geq \epoch(t)-1$.
Thus $\epoch(\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bcand}) \geq \epoch(t)-1$.
With Condition 2 of the Lemma's statement we can also conclde that $\slotstart(\slot(t)-2) \geq \GST$.
Then, by following the same reasoning that is used to proof \Cref{lem:gj-at-least-e-2-alt}
but for $\slot(t)-1$ instead of $\slot(t)$ we conclude the proof.
\end{proof}

\begin{lemma}
    % Let $GU^{v,t-1} := GU(V^{v,\slotstart(\slot(t)-1)},\slotstart(\slot(t)-1))$.
    If
    \begin{enumerate}
        \item $\text{\slotstart}(\text{\lastslot}(\text{\epoch}(t) - 1)) \geq \GST$
        \item $t = \slotstart(\epoch(t))$
        \item $\epoch(\guattime[val=v,time=\slotstart(\slot(t)-1)]) = \epoch(t)-1$
    \end{enumerate},
    then for any honest validator $v'$ and time $t'$ such that $\epoch(t') \in \{\epoch(t),\epoch(t)+1\}$,
    \begin{enumerate}
        \item $\block(\guattime[val=v,time=\slotstart(\slot(t)-1)]) \in \filtered[time=t',val=v']$
    \end{enumerate}
\end{lemma}

\begin{proof}
    Consider time $t'', \epoch(t'') = \epoch(t)$.
    $\gjattime[val=v',time=t''] = \guattime[val=v,time=\slotstart(\slot(t)-1)]$
    follows from Conditions 1 and 3 of the Lemma's statement together with Definitions 1-3 of the paper.
    Clearly, $\block(\guattime[val=v,time=\slotstart(\slot(t)-1)]) \in \filtered[time=t'',val=v']$
    and $\canonical[blck={\block(\guattime[val=v,time=\slotstart(\slot(t)-1)])},time=t'']$.
    Due to Condition 2 of the Lemma's statement all honest validators in the committee of $\epoch(t)$
    will vote in the support of $\block(\guattime[val=v,time=\slotstart(\slot(t)-1)])$.
    Then, by the Property 1.6 from the paper, no checkpoint $\chkp$ conflicting with $\block(\guattime[val=v,time=\slotstart(\slot(t)-1)])$
    such that $\epoch(C) = \epoch(t)$ can ever be justified.
    Thus, either $\gjattime[val=v',time=t'''] = \guattime[val=v,time=\slotstart(\slot(t)-1)]$
    or $\gjattime[val=v',time=t'''] = \chkp(b', \epoch(t)), b' \succeq \block(\guattime[val=v,time=\slotstart(\slot(t)-1)])$,
    $\epoch(t''') = \epoch(t) + 1$. In either case $\block(\guattime[val=v,time=\slotstart(\slot(t)-1)]) \in \filtered[time=t''',val=v']$.
\end{proof}

\begin{lemma}
    Take an honest validator $v$ and a block $b$.
    If
    \begin{enumerate}
        \item $t = \slotstart(\epoch(t))$
        \item $\epoch(b) = \epoch(t)-1$
        \item $\varforvalattime[val=v,time=t]{\isOneConfirmed}(b, \gjattime[val=v,time=t])$
        \item $\epoch(\gu(b)) \geq \epoch(t)-2$
    \end{enumerate},
    then for any honest validator $v'$ and time $t'$ such that $\epoch(t') = \epoch(t)$,
    \begin{enumerate}
        \item $b \in \filtered[time=t',val=v']$
    \end{enumerate}
\end{lemma}

\begin{proof} (by Mikhail)
    From \Cref{lem:no-conflict-chkp-is-justified} we know that no checkpoint conflicting with
    $\chkp(\varforvalattime[val=v,time=\slotstartslot{t}]{\bcand})$ can be justified.
    Given this, Condition 4 of the Lemma's statement together with the synchrony assumption
    we know that $\varforvalattime[val=v,time=\slotstartslot{t}]{\bcand} \succeq \block(\gjattime[val=v',time=\slotstartslot{t}])$
    and $\votsource[blck={\varforvalattime[val=v,time=\slotstartslot{t}]{\bcand}},time=t] \geq \epoch(t)-2$.
    Thus, $\varforvalattime[val=v,time=\slotstartslot{t}]{\bcand} \in \filtered[time=t',val=v']$ for $\epoch(t')=\epoch(t)$.
    Given the fact that $\varforvalattime[val=v,time=\slotstartslot{t}]{\bcand}$ remains canonical during the whole $\epoch(t)$
    and Property 1.6 from the paper we know that no $\epoch(t)$ checkpoint conflicting with
    $\varforvalattime[val=v,time=\slotstartslot{t}]{\bcand}$ can be justified.
    Which concludes the proof for $\epoch(t') = \epoch(t)+1$.
\end{proof}

\begin{lemma}
    Take an honest validator $v$ and a block $b$.
    If
    \begin{enumerate}
        \item $t = \slotstart(\epoch(t))$
        \item $\epoch(b) = \epoch(t)-1$
        \item $\varforvalattime[val=v,time=t]{\isOneConfirmed}(b, \gjattime[val=v,time=t])$
        \item $b \preceq \LMDGHOST(\viewattime[val=v',time=t''])$ for any $t''$ such that $\epoch(t'') = \epoch(t)$
        \item $\epoch(\gu(b)) \geq \epoch(t)-2$
    \end{enumerate},
    then for any honest validator $v'$ and time $t'$ such that $\epoch(t') = \epoch(t)+1$,
    \begin{enumerate}
        \item $b \in \filtered[time=t',val=v']$
    \end{enumerate}
\end{lemma}

\begin{lemma}
    Take an honest validator $v$ and a block $b$.
    If
    \begin{enumerate}
        \item $t = \slotstartslot{t}$
        \item $\epoch(b) = \epoch(t)-1$
        \item $\exists b' \in \viewattime[val=v,time=\slotstart(\slot(t)-1)], b' \succeq b \land \epoch(\votsource[blck=b',time=t]) \geq \epoch(t)-2$
        \item $\exists b', b' \succeq b \land \epoch(\gu(b')) \geq \epoch(t)-1$
        \item $\exists C, C \succeq b \land \epoch(C) = \epoch(t) \land \text{will\_no\_conflicting\_checkpoint\_be\_justified}(C)$
    \end{enumerate},
    then for any honest validator $v'$ and time $t' \geq t$ such that $\epoch(t') \in \{\epoch(t),\epoch(t)+1\}$,
    \begin{enumerate}
        \item $b \in \filtered[time=t',val=v']$
    \end{enumerate}
\end{lemma}

\begin{lemma}
    If
    \begin{enumerate}
        \item $\varforvalattime[val=v,time=\slotstart(\slot(t))]{\isOneConfirmed}(b, \gjattime[val=v,time=\slotstart(\slot(t))])$
        \item $\epoch(b) = \epoch(t)$
    \end{enumerate},
    then, for any honest validator $v'$ and time $t' \geq t$ such that $\epoch(t') = \epoch(t)$
    \begin{enumerate}
        \item $b \in \filtered[time=t',val=v']$
    \end{enumerate}
\end{lemma}

\begin{proof}(Sketch)
    At least one honest validator $v'$ voted for $b$ in the previous \slot.
    This also implies that $\slot(t) > first_slot(\epoch(t))$. 
    Given, \Cref{lem:gj-at-least-e-2} and that $\epoch(\slot(t)-1) = \epoch(t)$,  it must be that $v'$'s view includes a block $b' \succeq b$ such that $\epoch(\votsource[blck=b',time=\slotstart(\slot(t)-1)]) \geq \epoch(t)-2$.
    By $\slotstart(\slot(t))$, $b'$ is in the view of any honest validator.
    Hence, $b'$ is not filtered out by any honest validator at time $\slotstart(\slot(t))$ or after during epoch $\epoch(t)$.
\end{proof}

\begin{lemma}
    % Let $GU^{v,t-1} := GU(V^{v,\slotstart(\slot(t)-1)},\slotstart(\slot(t)-1))$.
    If
    \begin{enumerate}
        \item $t = \slotstart(\epoch(t))$
        \item $\epoch(\guattime[val=v,time=\slotstart(\slot(t)-1)]) = \epoch(t)-1$
    \end{enumerate},
    then, $\canonical[time=t,blck={\block(\guattime[val=v,time=\slotstart(\slot(t)-1)])}]$
\end{lemma}

\begin{lemma}
    If
    \begin{enumerate}
        \item $t = \slotstart(\epoch(t))$
        \item $\epoch(b) = \epoch(t)-1$
        \item $\epoch(\gu(b)) \geq \epoch(t)-2$
        \item $\canonical[time=t,blck=b_c]$
        \item $\forall b': b_c \prec b' \preceq b \implies \varforvalattime[val=v,time=t]{\isOneConfirmed}(b', \gjattime[val=v,time=\slotstart(\slot(t)-1)])$
    \end{enumerate},
    then $\canonical[time=t,blck=b]$
\end{lemma}

\begin{lemma}
    Take an honest validator $v$ and a block $b$.
    If
    \begin{enumerate}
        \item $t = \slotstartslot{t}$
        \item $\epoch(b) = \epoch(t)-1$
        \item $\exists b' \in \viewattime[val=v,time=\slotstart(\slot(t)-1)], b' \succeq b \land \epoch(\votsource[blck=b',time=t]) \geq \epoch(t)-2$
        \item $\exists b', b' \succeq b \land \epoch(\gu(b')) \geq \epoch(t)-1$
        \item $\exists C, C \succeq b \land \epoch(C) = \epoch(t) \land \text{will\_no\_conflicting\_checkpoint\_be\_justified}(C)$
        \item $\canonical[time=t,blck=b_c]$
        \item $\forall b': b_c \prec b' \preceq b \implies \varforvalattime[val=v,time=t]{\isOneConfirmed}(b', \gjattime[val=v,time=\slotstart(\slot(t)-1)])$        
    \end{enumerate},
    then $\canonical[time=t,blck=b]$
\end{lemma}

\begin{lemma}
    If
    \begin{enumerate}
        \item $\epoch(b) = \epoch(t)$
        \item $\canonical[time=t,blck=b_c]$
        \item $\forall b': b_c \prec b' \preceq b \implies \varforvalattime[val=v,time=t]{\isOneConfirmed}(b', \gjattime[val=v,time=\slotstart(\slot(t)-1)])$  
    \end{enumerate},
    then, $\canonical[time=t,blck=b]$.
\end{lemma}

\begin{lemma}
    $\canonical[time=t,blck={\varforvalattime[val=v,time=\slotstartslot{t}]{\bcand}}]$
\end{lemma}



\begin{lemma}
    If
    \begin{enumerate}
        \item $\firstslot(\epoch(t)-1) \geq \GST$
        \item $\epoch(\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}) = \epoch(t)-1$
        \item $\slot(t) = \firstslot(\epoch(t))$
    \end{enumerate},
    then,
    \begin{enumerate}
        \item $\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed} \succeq \guattime[val=v,time=\slotstart(\slot(t)-1)]$
    \end{enumerate}
\end{lemma}

\begin{proof}
    Given that $\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed} \in \varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bcands}$,
    from \Cref{lem:conf-current-epoch-then-gu-curr-epoch} we know that $\exists b' \in \viewattime[val=v,time=\slotstart(\slot(t)-1)], b' \succeq \varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed} \land \epoch(\gu(b')) \geq \epoch(\slot(t)-1)-1 \geq \epoch(t)-2$.
    This also implies $\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed} \succeq \gu(b')$.
    By cases.
    \begin{description}
        \item[Case 1: {$\epoch(\guattime[val=v,time=\slotstart(\slot(t)-1)]) = \epoch(\gu(b'))$}.] Implies $\guattime[val=v,time=\slotstart(\slot(t)-1)] = \gu(b') \preceq \varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}$.
        \item[Case 2: {$\epoch(\guattime[val=v,time=\slotstart(\slot(t)-1)]) \neq \epoch(\gu(b'))$}.] Given the definition of the greatest unrealized checkpoint we have $\epoch(\gu(b')) = \epoch(t)-2 < \epoch(\guattime[val=v,time=\slotstart(\slot(t)-1)]) = \epoch(t)-1$ for this case.
        Due to \Cref{lem:no-curr-epochconflict-chkp-is-justified} together with \Cref{lem:} and the synchrony assumption no checkpoint $\chkp'$ such that $\epoch(\chkp') = \epoch(t)-1$ conflicting with $\chkp(\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed})$ can ever be justified.
        Thus $\guattime[val=v,time=\slotstart(\slot(t)-1)] = \chkp(\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}) \preceq \varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}$ in this case.
    \end{description}
    % We have shown that in either case $\guattime[val=v,time=\slotstart(\slot(t)-1)] \preceq \varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed}$.
    % Now by cases on the first line, in order of execution of the Fast Confirmation Rule algorithm at time $\slotstartslot{t}$, where $\bcand = b_c$. 
    % \begin{description}
    %     \item[\Cref{ln:set-bcand-beginning-of-get-latest-confirmed}.] $b_c = \varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed} \succeq \guattime[val=v,time=\slotstart(\slot(t)-1)]$.
    %     \item[\Cref{ln:set-bcand-to-fin}.] Impossible, as at this line $\epoch(\bcand) < \epoch(t)-1$, but we assume $\epoch(b_c) = \epoch(t) -1$.
    %     \item[\Cref{ln:set-bcan-on-start-conf-chain}.] Impossible, as at this line $\epoch(\bcand) < \epoch(t)-1$, but we assume $\epoch(b_c) = \epoch(t) -1$.
    %     \item[\Cref{ln:set-bcand-to-output-find-latest}.] \Cref{lem:out-find-latest-conf-descendant-output} implies $\varforvalattime[val=v,time=\slotstart(\slot(t)-1)]{\bconfirmed} \preceq b_c$ which concludes the proof.
    % \end{description}
\end{proof}

\end{document}